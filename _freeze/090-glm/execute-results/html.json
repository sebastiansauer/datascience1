{
  "hash": "6409eeae00d1657b77edcd0bb3c1e19b",
  "result": {
    "markdown": "\n# Logistische Regression\n\n\n\n\n\n\n::: {.cell hash='090-glm_cache/html/unnamed-chunk-1_e75ed9bfde450aa5c0d009793751f31f'}\n\n:::\n\n\n\n## Lernsteuerung\n\n### Vorbereitung\n\nFrischen Sie Ihr Wissen zur logistischen Regression auf bzw. machen Sie sich mit den Grundlagen des Verfahrens vertraut.\n    \n### Lernziele\n\nSie verstehen den Zusammenhang von linearen und logistischen Modellen\nSie können die logistische Regression mit Methoden von tidymodels anwenden\n \n###  Literatur\n\nRhys, Kap. 4\n\n\n### Benötigte R-Pakete\n\n\n::: {.cell hash='090-glm_cache/html/unnamed-chunk-2_ba1b93a11a4cae90fa903eaf964a584b'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(easystats)\n```\n:::\n\n\n\n`{easystats}` ist, wie Tidymodels und Tidyverse, ein Metapaket,\nein R-Paket also, das mehrere Pakete verwaltet und startet.\n[Hier](https://easystats.github.io/easystats/) findet sich mehr Info zu Easystats.\n\n\n\n\nEinen flotten Spruch bekommen wir von Easystats gratis dazu:\n\n\n::: {.cell hash='090-glm_cache/html/unnamed-chunk-3_05419e8b15e2e9ed452c63d42053fddc'}\n\n```{.r .cell-code}\neasystats_zen()\n## [1] \"Patience you must have my young padawan.\"\n```\n:::\n\n::: {.cell hash='090-glm_cache/html/unnamed-chunk-4_75c11b463fe7b64017e58c9f6bde7152'}\n\n:::\n\n\n\n\n\n## Intuitive Erklärung\n\nDie *logistische Reression* ist ein Spezialfall des linearen Modells (lineare Regression),\nder für *binäre* (dichotom) AV eingesetzt wird (es gibt auch eine Variante für multinominale AV). \nEs können eine oder mehrere UV in eine logistische Regression einfließen,\nmit beliebigem Skalenniveau.\n\nBeispiele für  Forschungsfragen, die mit der logistischen Regression modelliert werden sind:\n\n- Welche Faktoren sind prädiktiv, um vorherzusagen, ob jemand einen Kredit zurückzahlen kann oder nicht?\n- Haben weibliche Passagiere aus der 1. Klasse eine höhere Überlebenschance als andere Personen auf der Titanic?\n- Welche Faktoren hängen damit zusammen, ob ein Kunde eine Webseite verlässt, bevor er einen Kauf abschließt?\n\n\n\nDer Name stammt von der [logistischen Funktion](https://en.wikipedia.org/wiki/Logistic_function),\ndie man in der einfachsten Form so darstellen kann:\n\n$$f(x) = \\frac{x}{1+e^{-x}}$$\n\nDa die AV als dichotom modelliert wird, spricht man von einer *Klassifikation*.\n\n\nAllerdings ist das Modell reichhaltiger als eine bloße Klassifikation,\ndie (im binären Fall) nur 1 Bit Information liefert: \"ja\" vs. \"nein\" bzw. 0 vs. 1.\n\nDas Modell liefert nämlich nicht nur eine Klassifikation zurück,\nsondern auch eine *Indikation der Stärke* (epistemologisch) der Klassenzugehörigkeit.\n\nEinfach gesagt heißt das, \ndass die logistische Regression eine Wahrscheinlichkeit der Klassenzugehörigkeit zurückliefert.\n\n\n\n\n\n```{mermaid}\n%%| label: fig-klass\n%%| fig-cap: Ablauf einer Klassifikation\n\n\nflowchart LR\n  Daten --> Modell --> Wskt --> Klasse\n\n```\n\n\n## Profil\n\nDas Profil des Modells kann man wie folgt charakterisieren, vgl. Tab. @tbl-tabprof-logist.\n\n\n\n::: {#tbl-tabprof-logist .cell tbl-cap='Profil der logistischen Regression' hash='090-glm_cache/html/tbl-tabprof-logist_910c21d74ef4d6c2bc5745f6cd269572'}\n::: {.cell-output-display}\n```{=html}\n<div id=\"awkucnqehv\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#awkucnqehv .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#awkucnqehv .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#awkucnqehv .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#awkucnqehv .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#awkucnqehv .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#awkucnqehv .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#awkucnqehv .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#awkucnqehv .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#awkucnqehv .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#awkucnqehv .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#awkucnqehv .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#awkucnqehv .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#awkucnqehv .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#awkucnqehv .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#awkucnqehv .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#awkucnqehv .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#awkucnqehv .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#awkucnqehv .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#awkucnqehv .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#awkucnqehv .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#awkucnqehv .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#awkucnqehv .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#awkucnqehv .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#awkucnqehv .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#awkucnqehv .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#awkucnqehv .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#awkucnqehv .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#awkucnqehv .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#awkucnqehv .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#awkucnqehv .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#awkucnqehv .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#awkucnqehv .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#awkucnqehv .gt_left {\n  text-align: left;\n}\n\n#awkucnqehv .gt_center {\n  text-align: center;\n}\n\n#awkucnqehv .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#awkucnqehv .gt_font_normal {\n  font-weight: normal;\n}\n\n#awkucnqehv .gt_font_bold {\n  font-weight: bold;\n}\n\n#awkucnqehv .gt_font_italic {\n  font-style: italic;\n}\n\n#awkucnqehv .gt_super {\n  font-size: 65%;\n}\n\n#awkucnqehv .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#awkucnqehv .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#awkucnqehv .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#awkucnqehv .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#awkucnqehv .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#awkucnqehv .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#awkucnqehv .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Merkmal\">Merkmal</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Logistische Regression\">Logistische Regression</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Merkmal\" class=\"gt_row gt_left\">Klassifikation</td>\n<td headers=\"Logistische Regression\" class=\"gt_row gt_left\">ja</td></tr>\n    <tr><td headers=\"Merkmal\" class=\"gt_row gt_left\">Regression</td>\n<td headers=\"Logistische Regression\" class=\"gt_row gt_left\">nein</td></tr>\n    <tr><td headers=\"Merkmal\" class=\"gt_row gt_left\">Lerntyp</td>\n<td headers=\"Logistische Regression\" class=\"gt_row gt_left\">überwacht</td></tr>\n    <tr><td headers=\"Merkmal\" class=\"gt_row gt_left\">parametrisch</td>\n<td headers=\"Logistische Regression\" class=\"gt_row gt_left\">ja</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\n\n\n## Warum nicht die lineare Regression verwenden?\n\n\n*Forschungsfrage*: Kann man anhand des Spritverbrauchs vorhersagen, ob ein Auto eine Automatik- bzw. ein manuelle Schaltung hat? Anders gesagt: Hängen Spritverbrauch und Getriebeart, s. @fig-mtcars? (Datensatz `mtcars`)\n\n\n::: {.cell hash='090-glm_cache/html/unnamed-chunk-6_26e68ea2790b0a1e474e2b7d8f63c68a'}\n\n```{.r .cell-code}\ndata(mtcars)\nd <-\n  mtcars %>% \n  mutate(mpg_z = standardize(mpg),\n         iv = mpg_z,\n         dv = am)\n\nm81 <- lm(dv ~ iv, data = d)\ncoef(m81)\n## (Intercept)          iv \n##   0.4062500   0.2993109\n```\n:::\n\n::: {.cell hash='090-glm_cache/html/fig-mtcars_340e28f1cdf8e78fe550001a3ef532cc'}\n::: {.cell-output-display}\n![Klassifikation von am](090-glm_files/figure-html/fig-mtcars-1.png){#fig-mtcars width=672}\n:::\n:::\n\n\n\n$Pr(\\text{am}=1|m91,\\text{mpg_z}=0) = 0.46$: \nDie Wahrscheinlichkeit einer manuelle Schaltung, \ngegeben einem durchschnittlichen Verbrauch (und dem Modell `m81`) liegt bei knapp 50%.\n\n\n\n### Lineare Modelle running wild\n\nWie groß ist die Wahrscheinlichkeit für eine manuelle Schaltung ...\n\n\n\n- ... bei `mpg_z = -2`?\n\n\n::: {.cell hash='090-glm_cache/html/unnamed-chunk-8_a3cb7631e74c361d278e1afab7d45f4c'}\n\n```{.r .cell-code}\npredict(m81, newdata = data.frame(iv = -2))\n##          1 \n## -0.1923719\n```\n:::\n\n\n$Pr(\\hat{y})<0$ macht keinen Sinn. ⚡ \n\n\n- ... bei `mpg_z = +2`?\n\n\n::: {.cell hash='090-glm_cache/html/unnamed-chunk-9_e2fe0bb7b9015f6e38cdc19c4ded1f48'}\n\n```{.r .cell-code}\npredict(m81, newdata = data.frame(iv = +2))\n##        1 \n## 1.004872\n```\n:::\n\n\n\n\n\n\n$Pr(\\hat{y})>1$ macht keinen Sinn. ⚡ \n\n\n\nSchauen Sie sich mal die Vorhersage an für `mpg_z=5` 🤯 \n\n\n### Wir müssen die Regressionsgerade umbiegen\n\n... wenn der vorhergesagte Wert eine Wahrscheinlichkeit, $p_i$, ist, s. @fig-biegen.\n\n\n\n::: {.cell hash='090-glm_cache/html/fig-biegen_dab2dc982758c46a489274c1749e94c9'}\n::: {.cell-output-display}\n![Wir biegen die Regressionsgeraden in eine S-Form](090-glm_files/figure-html/fig-biegen-1.png){#fig-biegen width=672}\n:::\n:::\n\n\n\nDie *schwarze* Gerade verlässt den Wertebereich der Wahrscheinlichkeit.\nDie *blaue* Kurve, $\\mathcal{f}$, bleibt im erlaubten Bereich, $Pr(y) \\in [0,1]$.\nWir müssen also die linke oder die rechte Seite des linearen Modells transformieren:\n$p_i = f(\\alpha + \\beta \\cdot x)$ bzw.:\n\n$f(p) = \\alpha + \\beta \\cdot x$\n\n$\\mathcal{f}$ nennt man eine *Link-Funktion*.\n\n\n\n\n\n### Verallgemeinerte lineare Modelle zur Rettung\n\nFür metrische AV mit theoretisch unendlichen Grenzen des Wertebereichs haben wir bisher eine Normalverteilung verwendet:\n\n$$y_i \\sim \\mathcal{N}(\\mu_i, \\sigma)$$\n\nDann ist die Normalverteilung eine voraussetzungsarme Wahl (maximiert die Entropie).\n\nAber wenn die AV *binär* ist bzw. *Häufigkeiten* modelliert, \nbraucht man eine Variable die nur positive Werte zulässt.\n\nDiese Verallgemeinerung des linearen Modells bezeichnet man als *verallgemeinertes lineares Modell* (generalized linear model, GLM).\n\nIm Falle einer binären (bzw. dichotomen) AV liegt eine bestimmte Form des GLM vor,\ndie man als *logistische Regression* bezeichnet.\n\n\n\n\n\n\n## Der Logit-Link\n\nDer *Logit-Link* wird auch $\\mathcal{L}$, `logit`, Log-Odds oder Logit-Funktion genannt.\n\nEr \"biegt\" die lineare Funktion in die richtige Form.\n\nDer Logit-Link ordnet einen Parameter, der als Wahrscheinlichkeitsmasse definiert ist (und daher im Bereich von 0 bis 1 liegt), einem linearen Modell zu (das jeden beliebigen reellen Wert annehmen kann):\n\n$$\n\\begin{align}\n    \\text{logit}(p_i) &= \\alpha + \\beta x_i\n\\end{align}\n$$\n\n\n\n\n\n- Die Logit-Funktion $\\mathcal{L}$ ist definiert als der (natürliche) Logarithmus des Verhältnisses der Wahrscheinlichkeit zu Gegenwahrscheinlichkeit:\n\n$$\\mathcal{L} = \\text{log} \\frac{p_i}{1-p_i}$$\n\n- Das Verhältnis der Wahrscheinlichkeit zu Gegenwahrscheinlichkeit nennt man auch *Odds*.\n\n- Also:\n\n$$\\mathcal{L} = \\text{log} \\frac{p_i}{1-p_i} = \\alpha + \\beta x_i$$\n\n\n## Aber warum?\n\n*Forschungsfrage*: Hängt das Überleben (statistisch) auf der Titanic vom Geschlecht ab?\n\n\nWie war eigentlich *insgesamt*, also ohne auf einen (oder mehrere) Prädiktoren zu bedingen, die Überlebenswahrscheinlichkeit?\n\n\n::: {.cell hash='090-glm_cache/html/m82_ec05101333a6c6c747a270f8340f7a34'}\n\n```{.r .cell-code}\ndata(titanic_train, package = \"titanic\")\n\nm82 <- lm(Survived ~ 1, data = titanic_train)\ncoef(m82)\n## (Intercept) \n##   0.3838384\n```\n:::\n\n\nDie Wahrscheinlichkeit zu Überleben $Pr(y=1)$ lag bei einem guten Drittel (0.38).\n\nDas hätte man auch so ausrechnen:\n\n\n::: {.cell hash='090-glm_cache/html/unnamed-chunk-11_10e6156757b171c608be3171220cae67'}\n\n```{.r .cell-code}\ntitanic_train %>% \n  count(Survived) %>% \n   mutate(prop = n/sum(n))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Survived\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"n\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"prop\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"0\",\"2\":\"549\",\"3\":\"0.6161616\"},{\"1\":\"1\",\"2\":\"342\",\"3\":\"0.3838384\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nAnders gesagt: $p(y=1) = \\frac{549}{549+342} \\approx 0.38$\n\n\n### tidymodels, m83\n\n\nBerechnen wir jetzt ein lineares Modell für die AV `Survived` mit dem Geschlecht als Pädiktor:\n\n\n::: {.cell hash='090-glm_cache/html/d_fecad2a769dcf2d6c075ec8d2e5bd456'}\n\n```{.r .cell-code}\nd <-\n  titanic_train %>% \n  filter(Fare > 0) %>% \n  mutate(iv = log(Fare),\n         dv = factor(Survived))\n```\n:::\n\n\n\nDie Faktorstufen, genannt `levels` von `Survived` sind:\n\n\n::: {.cell hash='090-glm_cache/html/unnamed-chunk-12_6809231f1831dd85129e0fbdcdd92cac'}\n\n```{.r .cell-code}\nlevels(d$dv)\n## [1] \"0\" \"1\"\n```\n:::\n\n\nUnd zwar genau in dieser Reihenfolge.\n\n\n## lm83, glm\n\nDie klassische Methoden in R, ein logistisches Modell zu berechnen, ist\nmit der Funktion `glm()`.\nTidymodels greift intern auf diese Funktion zurück.\nDaher sind die Ergebnisse numerisch identisch.\n\n\n::: {.cell hash='090-glm_cache/html/m83-glm_d3a5840fb784dbff632c8d3450f66db5'}\n\n```{.r .cell-code}\nlm83 <- glm(dv ~ iv, data = d, family = \"binomial\")\ncoef(lm83)\n## (Intercept)          iv \n##  -2.6827432   0.7479317\n```\n:::\n\n\n\n- AV: Überleben (binär/Faktor)\n- UV: Ticketpreis\n\n\n\nMit `{easystats}` kann man sich `model_parameter()` einfach ausgeben lassen:\n\n\n\n::: {.cell hash='090-glm_cache/html/unnamed-chunk-13_bb3b2b8b966dc6a6d646d0b4298c10fe'}\n\n```{.r .cell-code}\nlibrary(easystats)\n\n\nmodel_parameters(lm83)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Parameter\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Coefficient\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"SE\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"CI\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"CI_low\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"CI_high\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"z\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"df_error\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"(Intercept)\",\"2\":\"-2.6827432\",\"3\":\"0.25637475\",\"4\":\"0.95\",\"5\":\"-3.1937167\",\"6\":\"-2.1879712\",\"7\":\"-10.464147\",\"8\":\"Inf\",\"9\":\"1.262075e-25\"},{\"1\":\"iv\",\"2\":\"0.7479317\",\"3\":\"0.08192316\",\"4\":\"0.95\",\"5\":\"0.5898869\",\"6\":\"0.9113064\",\"7\":\"9.129674\",\"8\":\"Inf\",\"9\":\"6.870612e-20\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nUnd auch visualisieren lassen:\n\n\n::: {.cell hash='090-glm_cache/html/unnamed-chunk-14_a37a53966f8e773c4baec1226fbaf771'}\n\n```{.r .cell-code}\nplot(model_parameters(lm83))\n```\n\n::: {.cell-output-display}\n![](090-glm_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\n## m83, tidymodels\n\n\n*Achtung*! Bei tidymodels muss bei einer Klassifikation die AV vom Type `factor` sein.\nAußerdem wird bei `tidymodels`, im Gegensatz zu `(g)lm` nicht die zweite,\nsondern die *erste* als Ereignis modelliert wird.\n\n\n\nDaher wechseln wir die *ref*erenzkategorie, wir \"re-leveln\", mit `relevel()`:\n\n\n::: {.cell hash='090-glm_cache/html/unnamed-chunk-15_aab7609ccaf664671980c0217fe4aeb8'}\n\n```{.r .cell-code}\nd2 <-\n  d %>% \n  mutate(dv = relevel(dv, ref = \"1\"))\n```\n:::\n\n\n\nCheck:\n\n\n::: {.cell hash='090-glm_cache/html/unnamed-chunk-16_23da8d3bca144a39b5ae2acc7f20fce1'}\n\n```{.r .cell-code}\nlevels(d2$dv)\n## [1] \"1\" \"0\"\n```\n:::\n\n\n\nPasst.\n\n\n\nDie erste Stufe ist jetzt `1`, also Überleben.\n\n\nJetzt berechnen wir das Modell in gewohnter Weise mit `tidymodels`.\n\n\n::: {.cell hash='090-glm_cache/html/unnamed-chunk-17_1c66baae88cb34930998a274216b174e'}\n\n```{.r .cell-code}\nm83_mod <-\n  logistic_reg()\n\nm83_rec <-\n  recipe(dv ~ iv, data = d2)\n\nm83_wf <-\n  workflow() %>% \n  add_model(m83_mod) %>% \n  add_recipe(m83_rec)\n\nm83_fit <-\n  fit(m83_wf, data = d2)\n```\n:::\n\n\n\nHier sind die Koeffizienten, die kann man sich aus `m83_fit` herausziehen:\n\n\n::: {.cell hash='090-glm_cache/html/m83-coefs_8d60fc877d101f28ef4d29c769470b81'}\n::: {.cell-output-display}\n```{=html}\n<div id=\"hquhmttaju\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#hquhmttaju .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#hquhmttaju .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#hquhmttaju .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#hquhmttaju .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#hquhmttaju .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#hquhmttaju .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hquhmttaju .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#hquhmttaju .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#hquhmttaju .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#hquhmttaju .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#hquhmttaju .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#hquhmttaju .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#hquhmttaju .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#hquhmttaju .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#hquhmttaju .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#hquhmttaju .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#hquhmttaju .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#hquhmttaju .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hquhmttaju .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#hquhmttaju .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#hquhmttaju .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hquhmttaju .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#hquhmttaju .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#hquhmttaju .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hquhmttaju .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hquhmttaju .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#hquhmttaju .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#hquhmttaju .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hquhmttaju .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#hquhmttaju .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hquhmttaju .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#hquhmttaju .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hquhmttaju .gt_left {\n  text-align: left;\n}\n\n#hquhmttaju .gt_center {\n  text-align: center;\n}\n\n#hquhmttaju .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#hquhmttaju .gt_font_normal {\n  font-weight: normal;\n}\n\n#hquhmttaju .gt_font_bold {\n  font-weight: bold;\n}\n\n#hquhmttaju .gt_font_italic {\n  font-style: italic;\n}\n\n#hquhmttaju .gt_super {\n  font-size: 65%;\n}\n\n#hquhmttaju .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#hquhmttaju .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#hquhmttaju .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#hquhmttaju .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#hquhmttaju .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#hquhmttaju .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#hquhmttaju .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"term\">term</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"estimate\">estimate</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"std.error\">std.error</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"statistic\">statistic</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"p.value\">p.value</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"term\" class=\"gt_row gt_left\">(Intercept)</td>\n<td headers=\"estimate\" class=\"gt_row gt_right\">2.68</td>\n<td headers=\"std.error\" class=\"gt_row gt_right\">0.26</td>\n<td headers=\"statistic\" class=\"gt_row gt_right\">10.46</td>\n<td headers=\"p.value\" class=\"gt_row gt_right\">0.00</td></tr>\n    <tr><td headers=\"term\" class=\"gt_row gt_left\">iv</td>\n<td headers=\"estimate\" class=\"gt_row gt_right\">−0.75</td>\n<td headers=\"std.error\" class=\"gt_row gt_right\">0.08</td>\n<td headers=\"statistic\" class=\"gt_row gt_right\">−9.13</td>\n<td headers=\"p.value\" class=\"gt_row gt_right\">0.00</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n\n```\n## [1]  2.6827432 -0.7479317\n```\n:::\n\n::: {.cell hash='090-glm_cache/html/unnamed-chunk-18_5001ca5eb64cf3c1d02ebddf5144eb93'}\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"term\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"estimate\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"std.error\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"statistic\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"(Intercept)\",\"2\":\"2.6827432\",\"3\":\"0.25637475\",\"4\":\"10.464147\",\"5\":\"1.262075e-25\"},{\"1\":\"iv\",\"2\":\"-0.7479317\",\"3\":\"0.08192316\",\"4\":\"-9.129674\",\"5\":\"6.870612e-20\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nDie Koeffizienten werden in Logits angegeben.\n\n\nIn @fig-m83-plot ist das Modell und die Daten visualisiert.\n\n\n\n::: {.cell hash='090-glm_cache/html/fig-m83-plot_07eae1a464de0ad99f2d27e05ec3e125'}\n::: {.cell-output-display}\n![Modell m83 und die Titanic-Daten](090-glm_files/figure-html/fig-m83-plot-1.png){#fig-m83-plot width=672}\n:::\n:::\n\n\n\n\nDefinieren wir als $y=1$ das zu modellierende Ereignis, hier \"Überleben auf der Titanic\" (hat also überlebt). \n\n\nWie wir oben schon gesehen haben, funktioniert die lineare Regression nicht einwandfrei bei binären (oder dichotomen) AV.\n\n\n\n\n### Wahrscheinlichkeit in Odds\n\nProbieren wir Folgendes: Rechnen wir die Wahrscheinlichkeit zu Überlegen für $y$, kurz $p$, in *Odds* (Chancen) um.\n\n$odds = \\frac{p}{1-p}$\n\nIn R:\n\n\n::: {.cell hash='090-glm_cache/html/unnamed-chunk-19_90921a454fbde3166fff08d6277fabbf'}\n\n```{.r .cell-code}\nodds <- 0.38 / 0.62\nodds\n## [1] 0.6129032\n```\n:::\n\n\nBildlich gesprochen sagen die Odds: für 38 Menschen, die überlebt haben, kommen (ca.) 62 Menschen, die nicht überlebt haben, s. @fig-odds1.\n\n\n\n::: {.cell hash='090-glm_cache/html/fig-odds1_d8efece36aaf3494aae0c044bdf4008c'}\n::: {.cell-output-display}\n![Odds: 38 zu 62](090-glm_files/figure-html/fig-odds1-1.png){#fig-odds1 width=672}\n:::\n:::\n\n\n\nPlotten wir die Odds als Funktion der UV, s. @fig-odds2.\n\n\n::: {.cell hash='090-glm_cache/html/unnamed-chunk-20_c117e5f90b92beb3ff259dcc3c4944d2'}\n\n:::\n\n::: {.cell hash='090-glm_cache/html/fig-odds2_8d50c8d9b038aa98ac19083a35d28a30'}\n::: {.cell-output-display}\n![Odds als Funktion der UV](090-glm_files/figure-html/fig-odds2-1.png){#fig-odds2 width=672}\n:::\n:::\n\n\n\nWir sind noch nicht am Ziel;\ndie Variable ist noch nicht \"richtig gebogen\".\n\n\n### Von Odds zu Log-Odds\n\nWenn wir jetzt den Logarithmus (der Odds) berechnen bekommen wir eine \"brav gebogenen\" Funktion, die Log-Odds, $\\mathcal{L}$, als Funktion der UV, s. @fig-logit2.\n\n\n$$\\mathcal{L} = log (odds) = log \\left(\\frac{p}{1-p}\\right)$$\n\n\n::: {.cell hash='090-glm_cache/html/fig-logit2_6b56e2e05a73be4040a079373645b630'}\n::: {.cell-output-display}\n![Logit als Funktion der UV](090-glm_files/figure-html/fig-logit2-1.png){#fig-logit2 width=672}\n:::\n:::\n\n\nLinear!\n\n\nEs gilt also:\n\n$$\\text {log-odds} = b_0 + b_1x$$\n\n\n\n\nLog-Odds (Log-Odds) bezeichnet man auch als *Logits*.\n\n\n\n## Inverser Logit\n\nUm nach $p$ aufzulösen, müssen wir einige Algebra bemühen:\n\n$$\n\\begin{align}\n\\text{log} \\frac{p}{1-p} &= \\alpha + \\beta x & & \\text{Exponentieren}\\\\\n\\frac{p}{1-p} &= e^{\\alpha + \\beta x} \\\\\np_i &= e^{\\alpha + \\beta x_i} (1-p) & & \\text{Zur Vereinfachung: } x := e^{\\alpha + \\beta x_i} \\\\\np_i &= x (1-p) \\\\\n&= x - xp \\\\\np + px &= x \\\\\np(1+x) &= x \\\\\np &= \\frac{x} {1+x} & & \\text{Lösen wir x wieder auf.} \\\\\np &= \\frac{e^{\\alpha + \\beta x_i}}{1 + e^{\\alpha + \\beta x_i}} = \\mathcal{L}^{-1}\n\\end{align}\n$$\n\n\n\nDiese Funktion nennt man auch *inverser Logit*, $\\text{logit}^{-1}, \\mathcal{L}^{-1}$.\n\n\nZum Glück macht das alles die Rechenmaschine für uns 😄.\n\n\n\n### Vom Logit zur Klasse\n\n\nPraktisch können wir uns die Logits und ihre zugehörige Wahrscheinlichkeit einfach ausgeben lassen mit R. Und die vorhergesagte Klasse (`.pred_class`) auch:\n\n\n\n::: {.cell hash='090-glm_cache/html/d3_009e0cdd44b2b44b33f97f637eee9d67'}\n\n```{.r .cell-code}\nd3 <-\n  d2 %>% \n  bind_cols(predict(m83_fit, new_data = d2, type = \"prob\")) %>% \n  bind_cols(predict(m83_fit, new_data = d2)) %>%  # Klasse\n  bind_cols(logits = predict(m83_fit, new_data = d2, type = \"raw\"))  # Logits\n  \nd3 %>% \n  slice_head(n = 3) %>% \n  select(Name, last_col())\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"logits\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Braund, Mr. Owen Harris\",\"2\":\"1.2010894\"},{\"1\":\"Cumings, Mrs. John Bradley (Florence Briggs Thayer)\",\"2\":\"-0.5084287\"},{\"1\":\"Heikkinen, Miss. Laina\",\"2\":\"1.1345079\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n### Grenzwert wechseln\n\nIm Standard wird 50% als Grenzwert für die vorhergesagte Klasse $c$ genommen:\n\n- wenn $p <= .5 \\rightarrow c = 0$\n- wenn $p > .5 \\rightarrow c = 1$\n\nMan kann aber den Grenzwert beliebig wählen, um Kosten-Nutzen-Abwägungen zu optimieren;\nmehr dazu findet sich z.B. [hier](https://probably.tidymodels.org/articles/where-to-use.html).\n\n\n## Logit und Inverser Logit\n\n\n\n### Logit\n$(0,1) \\rightarrow (-\\infty, +\\infty)$\n\n@fig-logit-invlogit zeigt die Veränderung des Wertebereichs bei Umrechnung von Wahrscheinlichkeit zu Logit.\n\n\n::: {.cell hash='090-glm_cache/html/fig-logit-invlogit_cacc1c22500d2552924dc565e09cec29'}\n::: {.cell-output-display}\n![Der Wertebereich der Wahrscheinlichkeit ist [0,1]; der Wertebereich des Logits [-Inf,+Inf].](090-glm_files/figure-html/fig-logit-invlogit-1.png){#fig-logit-invlogit width=2100}\n:::\n:::\n\n\n\n\n\nPraktisch, um Wahrscheinlichkeit zu modellieren.\n\n$$p \\rightarrow \\fbox{logit} \\rightarrow \\alpha + \\beta x$$\n\n\n### Inv-Logit\n\nBeim Inversen Logit (Inv-Logit) ist es genau umgekehrt wie beim Logit.\n@fig-inv-logit-prob zeigt die Veränderung des Wertebereichs des Inv-Logits.\n\n$(-\\infty, +\\infty) \\rightarrow (0,1)$\n\n\n::: {.cell hash='090-glm_cache/html/fig-inv-logit-prob_3a153492dad5be36e29645c8d8dc02d2'}\n::: {.cell-output-display}\n![Veränderung der Wertebereichs durch die Inv-Logit-Umrechnung](090-glm_files/figure-html/fig-inv-logit-prob-1.png){#fig-inv-logit-prob width=672}\n:::\n:::\n\n\nPraktisch, um in Wahrscheinlichkeiten umzurechnen.\n\n$$p \\leftarrow \\fbox{inv-logit} \\leftarrow \\alpha + \\beta x$$\n\n\n## Logistische Regression im Überblick\n\n- Eine Regression mit binomial verteilter AV und Logit-Link nennt man *logistische Regression*.\n\n- Man verwendet die logistische Regression um binomial verteilte AV zu modellieren, z.B.\n    - Wie hoch ist die Wahrscheinlichkeit, dass ein Kunde das Produkt kauft?\n    - Wie hoch ist die Wahrscheinlichkeit, dass ein Mitarbeiter kündigt?\n    - Wie hoch ist die Wahrscheinlichkeit, die Klausur zu bestehen?\n    \n- Die logistische Regression ist eine normale, lineare Regression für den Logit von $Pr(y=1)$, wobei $y$ (AV) binomialvereteilt mit $n=1$ angenommen wird:\n\n\n$$\n\\begin{align}\ny_i &\\sim \\mathcal{B}(1, p_i) \\\\\n\\text{logit}(p_i) &= \\alpha + \\beta x_i\n\\end{align}\n$$\n\n\n\n- Da es sich um eine normale, lineare Regression handelt, sind alle bekannten Methoden und Techniken der linearen Regression zulässig.\n\n- Da Logits nicht einfach zu interpretieren sind, rechnet man nach der Berechnung des Modells den Logit häufig in Wahrscheinlichkeiten um.\n\n\n\n### Die Koeffizienten sind schwer zu interpretieren\n\nPuhhh, s. @fig-logit-convert-plot\n\n\n::: {.cell fig.asp='0.4' hash='090-glm_cache/html/fig-logit-convert-plot_49e5855f00d750463900b0002e87e016'}\n::: {.cell-output-display}\n![Die Koeffizienten der logistischen Regression sind nicht normal - im additiven Sinne - zu interpretieren.](090-glm_files/figure-html/fig-logit-convert-plot-1.png){#fig-logit-convert-plot width=672}\n:::\n:::\n\n\n\n\n\n- In der logistischen Regression gilt *nicht* mehr, dass eine konstante Veränderung in der UV mit einer konstanten Veränderung in der AV einhergeht.\n- Stattdessen geht eine konstante Veränderung in der UV mit einer konstanten Veränderung im *Logit* der AV einher.\n- Beim logistischen Modell hier gilt, dass in der Nähe von $x=0$ die größte Veränderung in $p$ von statten geht; je weiter weg von $x=0$, desto geringer ist die Veränderung in $p$.\n\n\n### Logits vs. Wahrscheinlichkeiten \n\n\n::: {#tbl-logit-konvert .cell tbl-cvap='Tabelle zur Umrechnung von Logit zu Wahrscheinlichkeit (p)' hash='090-glm_cache/html/tbl-logit-konvert_ac18308ee0fffbcd1cae3ee63f8ceb30'}\n::: {.cell-output-display}\n```{=html}\n<div id=\"syjbbmyzuw\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#syjbbmyzuw .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#syjbbmyzuw .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#syjbbmyzuw .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#syjbbmyzuw .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#syjbbmyzuw .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#syjbbmyzuw .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#syjbbmyzuw .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#syjbbmyzuw .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#syjbbmyzuw .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#syjbbmyzuw .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#syjbbmyzuw .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#syjbbmyzuw .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#syjbbmyzuw .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#syjbbmyzuw .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#syjbbmyzuw .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#syjbbmyzuw .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#syjbbmyzuw .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#syjbbmyzuw .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#syjbbmyzuw .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#syjbbmyzuw .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#syjbbmyzuw .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#syjbbmyzuw .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#syjbbmyzuw .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#syjbbmyzuw .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#syjbbmyzuw .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#syjbbmyzuw .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#syjbbmyzuw .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#syjbbmyzuw .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#syjbbmyzuw .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#syjbbmyzuw .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#syjbbmyzuw .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#syjbbmyzuw .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#syjbbmyzuw .gt_left {\n  text-align: left;\n}\n\n#syjbbmyzuw .gt_center {\n  text-align: center;\n}\n\n#syjbbmyzuw .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#syjbbmyzuw .gt_font_normal {\n  font-weight: normal;\n}\n\n#syjbbmyzuw .gt_font_bold {\n  font-weight: bold;\n}\n\n#syjbbmyzuw .gt_font_italic {\n  font-style: italic;\n}\n\n#syjbbmyzuw .gt_super {\n  font-size: 65%;\n}\n\n#syjbbmyzuw .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#syjbbmyzuw .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#syjbbmyzuw .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#syjbbmyzuw .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#syjbbmyzuw .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#syjbbmyzuw .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#syjbbmyzuw .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"logit\">logit</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"p\">p</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"logit\" class=\"gt_row gt_right\">−10.00</td>\n<td headers=\"p\" class=\"gt_row gt_right\">0.00</td></tr>\n    <tr><td headers=\"logit\" class=\"gt_row gt_right\">−3.00</td>\n<td headers=\"p\" class=\"gt_row gt_right\">0.05</td></tr>\n    <tr><td headers=\"logit\" class=\"gt_row gt_right\">−2.00</td>\n<td headers=\"p\" class=\"gt_row gt_right\">0.12</td></tr>\n    <tr><td headers=\"logit\" class=\"gt_row gt_right\">−1.00</td>\n<td headers=\"p\" class=\"gt_row gt_right\">0.27</td></tr>\n    <tr><td headers=\"logit\" class=\"gt_row gt_right\">−0.50</td>\n<td headers=\"p\" class=\"gt_row gt_right\">0.38</td></tr>\n    <tr><td headers=\"logit\" class=\"gt_row gt_right\">−0.25</td>\n<td headers=\"p\" class=\"gt_row gt_right\">0.44</td></tr>\n    <tr><td headers=\"logit\" class=\"gt_row gt_right\">0.00</td>\n<td headers=\"p\" class=\"gt_row gt_right\">0.50</td></tr>\n    <tr><td headers=\"logit\" class=\"gt_row gt_right\">0.25</td>\n<td headers=\"p\" class=\"gt_row gt_right\">0.56</td></tr>\n    <tr><td headers=\"logit\" class=\"gt_row gt_right\">0.50</td>\n<td headers=\"p\" class=\"gt_row gt_right\">0.62</td></tr>\n    <tr><td headers=\"logit\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"p\" class=\"gt_row gt_right\">0.73</td></tr>\n    <tr><td headers=\"logit\" class=\"gt_row gt_right\">2.00</td>\n<td headers=\"p\" class=\"gt_row gt_right\">0.88</td></tr>\n    <tr><td headers=\"logit\" class=\"gt_row gt_right\">3.00</td>\n<td headers=\"p\" class=\"gt_row gt_right\">0.95</td></tr>\n    <tr><td headers=\"logit\" class=\"gt_row gt_right\">10.00</td>\n<td headers=\"p\" class=\"gt_row gt_right\">1.00</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\n\n\n\n\n\n\n\n## Aufgaben\n\n\n- [Fallstudien zu Studiengebühren](https://juliasilge.com/blog/tuition-resampling/)\n- [1. Modell der Fallstudie Hotel Bookings](https://www.tidymodels.org/start/case-study/)\n- [Aufgaben zur logistischen Regression, PDF](https://github.com/sebastiansauer/datascience1/blob/main/Aufgaben/Thema8-Loesungen1.pdf)\n\n\n##  Vertiefung\n\n[Fallstudie Diabetes mit logististischer Regression](https://medium.com/the-researchers-guide/modelling-binary-logistic-regression-using-tidymodels-library-in-r-part-1-c1bdce0ac055)\n    \n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}