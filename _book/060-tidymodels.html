<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.247">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Grundlagen der Prognosemodellierung 🔮🧰 - 6&nbsp; tidymodels</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./070-knn.html" rel="next">
<link href="./050-R-Vertiefung.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Keine Treffer",
    "search-matching-documents-text": "Treffer",
    "search-copy-link-title": "Link in die Suche kopieren",
    "search-hide-matches-text": "Zusätzliche Treffer verbergen",
    "search-more-match-text": "weitere Treffer in diesem Dokument",
    "search-more-matches-text": "weitere Treffer in diesem Dokument",
    "search-clear-button-title": "Zurücksetzen",
    "search-detached-cancel-button-title": "Abbrechen",
    "search-submit-button-title": "Abschicken"
  }
}</script><meta name="mermaid-theme" content="neutral">
<script src="site_libs/quarto-diagram/mermaid.min.js"></script><script src="site_libs/quarto-diagram/mermaid-init.js"></script><link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="site_libs/es6shim-0.35.6/es6shim.js"></script><script src="site_libs/es7shim-6.0.0/es7shim.js"></script><script src="site_libs/graphre-0.1.3/graphre.js"></script><script src="site_libs/nomnoml-1.5.3/nomnoml.js"></script><script src="site_libs/nomnoml-binding-0.2.6/nomnoml.js"></script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./060-tidymodels.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">tidymodels</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Suchen" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Grundlagen der Prognosemodellierung 🔮🧰</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Dunkelmodus umschalten"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Suchen"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Zu diesem Buch</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010-Hinweise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Hinweise</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./030-Pruefung.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Prüfung</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./040-Statistisches-Lernen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Statistisches Lernen</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./050-R-Vertiefung.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">R, zweiter Blick</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./060-tidymodels.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">tidymodels</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./070-knn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">kNN</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./080-Resampling-Tuning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Resampling und Tuning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./090-glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Logistische Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./100-baeume.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Entscheidungsbäume</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./110-ensemble.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Ensemble Lerner</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./120-regularisierte-modelle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Regularisierte Modelle</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./125-feature-engineeering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Feature Engineering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./130-kaggle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Kaggle</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./140-faden.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Der rote Faden</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./150-fallstudien.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Fallstudien</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./160-e.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Staunen mit e</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Inhaltsverzeichnis</h2>
   
  <ul>
<li>
<a href="#lernsteuerung" id="toc-lernsteuerung" class="nav-link active" data-scroll-target="#lernsteuerung"><span class="header-section-number">6.1</span> Lernsteuerung</a>
  <ul class="collapse">
<li><a href="#lernziele" id="toc-lernziele" class="nav-link" data-scroll-target="#lernziele"><span class="header-section-number">6.1.1</span> Lernziele</a></li>
  </ul>
</li>
  <li>
<a href="#vorbereitung" id="toc-vorbereitung" class="nav-link" data-scroll-target="#vorbereitung"><span class="header-section-number">6.2</span> Vorbereitung</a>
  <ul class="collapse">
<li><a href="#ben%C3%B6tigte-r-pakete" id="toc-benötigte-r-pakete" class="nav-link" data-scroll-target="#ben%C3%B6tigte-r-pakete"><span class="header-section-number">6.2.1</span> Benötigte R-Pakete</a></li>
  </ul>
</li>
  <li><a href="#daten" id="toc-daten" class="nav-link" data-scroll-target="#daten"><span class="header-section-number">6.3</span> Daten</a></li>
  <li><a href="#train--vs-test-datensatz-aufteilen" id="toc-train--vs-test-datensatz-aufteilen" class="nav-link" data-scroll-target="#train--vs-test-datensatz-aufteilen"><span class="header-section-number">6.4</span> Train- vs Test-Datensatz aufteilen</a></li>
  <li>
<a href="#grundlagen-der-modellierung-mit-tidymodels" id="toc-grundlagen-der-modellierung-mit-tidymodels" class="nav-link" data-scroll-target="#grundlagen-der-modellierung-mit-tidymodels"><span class="header-section-number">6.5</span> Grundlagen der Modellierung mit tidymodels</a>
  <ul class="collapse">
<li><a href="#modelle-spezifizieren" id="toc-modelle-spezifizieren" class="nav-link" data-scroll-target="#modelle-spezifizieren"><span class="header-section-number">6.5.1</span> Modelle spezifizieren</a></li>
  <li><a href="#modelle-berechnen" id="toc-modelle-berechnen" class="nav-link" data-scroll-target="#modelle-berechnen"><span class="header-section-number">6.5.2</span> Modelle berechnen</a></li>
  <li><a href="#vorhersagen" id="toc-vorhersagen" class="nav-link" data-scroll-target="#vorhersagen"><span class="header-section-number">6.5.3</span> Vorhersagen</a></li>
  <li><a href="#vorhersagen-im-train-datensatz" id="toc-vorhersagen-im-train-datensatz" class="nav-link" data-scroll-target="#vorhersagen-im-train-datensatz"><span class="header-section-number">6.5.4</span> Vorhersagen im Train-Datensatz</a></li>
  <li><a href="#modellkoeffizienten-im-train-datensatz" id="toc-modellkoeffizienten-im-train-datensatz" class="nav-link" data-scroll-target="#modellkoeffizienten-im-train-datensatz"><span class="header-section-number">6.5.5</span> Modellkoeffizienten im Train-Datensatz</a></li>
  <li><a href="#parsnip-rstudio-add-in" id="toc-parsnip-rstudio-add-in" class="nav-link" data-scroll-target="#parsnip-rstudio-add-in"><span class="header-section-number">6.5.6</span> Parsnip RStudio add-in</a></li>
  </ul>
</li>
  <li>
<a href="#workflows" id="toc-workflows" class="nav-link" data-scroll-target="#workflows"><span class="header-section-number">6.6</span> Workflows</a>
  <ul class="collapse">
<li><a href="#konzept-des-workflows-in-tidymodels" id="toc-konzept-des-workflows-in-tidymodels" class="nav-link" data-scroll-target="#konzept-des-workflows-in-tidymodels"><span class="header-section-number">6.6.1</span> Konzept des Workflows in Tidymodels</a></li>
  <li><a href="#einfaches-beispiel" id="toc-einfaches-beispiel" class="nav-link" data-scroll-target="#einfaches-beispiel"><span class="header-section-number">6.6.2</span> Einfaches Beispiel</a></li>
  <li><a href="#vorhersage-mit-einem-workflow" id="toc-vorhersage-mit-einem-workflow" class="nav-link" data-scroll-target="#vorhersage-mit-einem-workflow"><span class="header-section-number">6.6.3</span> Vorhersage mit einem Workflow</a></li>
  <li><a href="#modellg%C3%BCte" id="toc-modellgüte" class="nav-link" data-scroll-target="#modellg%C3%BCte"><span class="header-section-number">6.6.4</span> Modellgüte</a></li>
  <li><a href="#vorhersage-von-hand" id="toc-vorhersage-von-hand" class="nav-link" data-scroll-target="#vorhersage-von-hand"><span class="header-section-number">6.6.5</span> Vorhersage von Hand</a></li>
  </ul>
</li>
  <li>
<a href="#rezepte-zur-vorverarbeitung" id="toc-rezepte-zur-vorverarbeitung" class="nav-link" data-scroll-target="#rezepte-zur-vorverarbeitung"><span class="header-section-number">6.7</span> Rezepte zur Vorverarbeitung</a>
  <ul class="collapse">
<li><a href="#was-ist-rezept-und-wozu-ist-es-gut" id="toc-was-ist-rezept-und-wozu-ist-es-gut" class="nav-link" data-scroll-target="#was-ist-rezept-und-wozu-ist-es-gut"><span class="header-section-number">6.7.1</span> Was ist Rezept und wozu ist es gut?</a></li>
  <li><a href="#workflows-mit-rezepten" id="toc-workflows-mit-rezepten" class="nav-link" data-scroll-target="#workflows-mit-rezepten"><span class="header-section-number">6.7.2</span> Workflows mit Rezepten</a></li>
  <li><a href="#spaltenrollen" id="toc-spaltenrollen" class="nav-link" data-scroll-target="#spaltenrollen"><span class="header-section-number">6.7.3</span> Spaltenrollen</a></li>
  <li><a href="#preppen-und-backen" id="toc-preppen-und-backen" class="nav-link" data-scroll-target="#preppen-und-backen"><span class="header-section-number">6.7.4</span> Preppen und Backen</a></li>
  <li><a href="#fazit" id="toc-fazit" class="nav-link" data-scroll-target="#fazit"><span class="header-section-number">6.7.5</span> Fazit</a></li>
  </ul>
</li>
  <li><a href="#aufgaben" id="toc-aufgaben" class="nav-link" data-scroll-target="#aufgaben"><span class="header-section-number">6.8</span> Aufgaben</a></li>
  <li><a href="#fallstudien" id="toc-fallstudien" class="nav-link" data-scroll-target="#fallstudien"><span class="header-section-number">6.9</span> Fallstudien</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">6</span>&nbsp; <span class="chapter-title">tidymodels</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><section id="lernsteuerung" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="lernsteuerung">
<span class="header-section-number">6.1</span> Lernsteuerung</h2>
<section id="lernziele" class="level3" data-number="6.1.1"><h3 data-number="6.1.1" class="anchored" data-anchor-id="lernziele">
<span class="header-section-number">6.1.1</span> Lernziele</h3>
<ul>
<li>Sie sind in der Lage, Regressionsmodelle mit dem tidymodels-Ansatz zu spezifizieren.</li>
<li>Sie können Begriffe des statistischen Lernens in das Vokabular von tidymodels übersetzen.</li>
</ul></section></section><section id="vorbereitung" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="vorbereitung">
<span class="header-section-number">6.2</span> Vorbereitung</h2>
<ul>
<li>Lesen Sie <a href="https://www.tmwr.org/software-modeling.html">TMWR, Kapitel 1</a>
</li>
<li>Lesen Sie übrige Literatur zu diesem Thema: TMWR, Kap. 1, 5, 6, 7, 8, 9</li>
</ul>
<section id="benötigte-r-pakete" class="level3" data-number="6.2.1"><h3 data-number="6.2.1" class="anchored" data-anchor-id="benötigte-r-pakete">
<span class="header-section-number">6.2.1</span> Benötigte R-Pakete</h3>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-3_c53fc8e08afb3394c114506b50c9e5f2">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://tidymodels.tidymodels.org">tidymodels</a> ist ein <em>Metapaket</em>: Ein (R-)Paket, das mehrere andere Paket startet und uns damit das Leben einfacher macht, analog zu <code>tidyverse</code>. Eine Liste der R-Pakete, die durch <code>tidymodels</code> gestartet werden, findet sich <a href="https://www.tidymodels.org/packages/">hier</a>. Probieren Sie auch mal <code><a href="https://tidymodels.tidymodels.org/reference/tidymodels-package.html">?tidymodels</a></code>.</p>
<p>Eine Liste aller Pakete, die in Tidymodels benutzt werden, die <code>dependencies</code>, kann man sich so ausgeben lassen:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-4_8428365fa56dd9c0b32636bc62f86675">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tidymodels.tidymodels.org/reference/pkg_deps.html">pkg_deps</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"tidymodels"</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="daten" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="daten">
<span class="header-section-number">6.3</span> Daten</h2>
<p>Dieser Abschnitt bezieht sich auf <a href="https://www.tmwr.org/ames.html">Kapitel 4</a> in <span class="citation" data-cites="silge_tidy_2022">Silge und Kuhn (<a href="references.html#ref-silge_tidy_2022" role="doc-biblioref">2022</a>)</span>.</p>
<p>Wir benutzen den Datensatz zu Immobilienpreise aus dem <a href="https://en.wikipedia.org/wiki/Ames,_Iowa">Ames County</a> in Iowa, USA, gelegen im Zentrum des Landes.</p>
<div class="cell" data-hash="060-tidymodels_cache/html/load-ames-data_96b418b131c6ad8b4811adbdc0a1b818">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">ames</span><span class="op">)</span>  <span class="co"># Daten wurden über tidymodels mit geladen</span></span>
<span><span class="va">ames</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">ames</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Sale_Price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hier wurde die AV log-transformiert. Das hat zwei (wichtige) Effekte:</p>
<ol type="1">
<li>Die Verteilung ist symmetrischer, näher an der Normalverteilung. Damit gibt es mehr Daten im Hauptbereich des Ranges von <code>Sale_Price</code>, was die Vorhersagen stabiler machen dürfte.</li>
<li>Logarithmiert man die Y-Variable, so kommt dies <a href="https://sebastiansauer.github.io/2021-sose/QuantMeth1/Vertiefung/Log-Log-Regression.html#19">einem multiplikativen Modell gleich</a>, s. auch <a href="https://data-se.netlify.app/2021/06/17/ein-beispiel-zum-nutzen-einer-log-transformation/">hier</a>.</li>
</ol></section><section id="train--vs-test-datensatz-aufteilen" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="train--vs-test-datensatz-aufteilen">
<span class="header-section-number">6.4</span> Train- vs Test-Datensatz aufteilen</h2>
<p>Dieser Abschnitt bezieht sich auf <a href="https://www.tmwr.org/splitting.html">Kapitel 5</a> in <span class="citation" data-cites="silge_tidy_2022">Silge und Kuhn (<a href="references.html#ref-silge_tidy_2022" role="doc-biblioref">2022</a>)</span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hinweis
</div>
</div>
<div class="callout-body-container callout-body">
<p>Das Aufteilen in Train- und Test-Datensatz ist einer der wesentlichen Grundsätze im maschinellen Lernen. Das Ziel ist, Overfitting abzuwenden. Im Train-Datensatz werden alle Modelle berechnet. Der Test-Datensatz wird nur <em>einmal</em> verwendet, und zwar zur Überprüfung der Modellgüte.</p>
</div>
</div>
<!-- [![](https://mermaid.ink/img/pako:eNo9jDEOwjAMRa9ieW4RYkKZ4QTt6MVqDERK0ip1KqGqd8e0Ak_fz-97xWH0gg6nIKBBo0BfOOQWlvkEvczadpymKJTBhnC_EoKD6_nPTNvRxRBlbDBJSRy8_V2_EqG-JAmhs-jlwTVagfJmap08q9x90LGg01KlQa46du88_PbDuQV-Fk4H3D5jVDy8)](https://mermaid.live/edit#pako:eNo9jDEOwjAMRa9ieW4RYkKZ4QTt6MVqDERK0ip1KqGqd8e0Ak_fz-97xWH0gg6nIKBBo0BfOOQWlvkEvczadpymKJTBhnC_EoKD6_nPTNvRxRBlbDBJSRy8_V2_EqG-JAmhs-jlwTVagfJmap08q9x90LGg01KlQa46du88_PbDuQV-Fk4H3D5jVDy8) -->
<!-- [Quelle](https://gist.github.com/sebastiansauer/be53bfc193fd3c144a430b7d3b922310) -->
<p>Eine Faustregel ist es, 70-80% der Daten in das Train-Sample und die übrigen 20-30% in das Test-Sample zu stecken, s. <a href="#fig-train-pie">Abbildung&nbsp;<span>6.1</span></a></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-train-pie" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><div>
<pre class="mermaid mermaid-js" data-label="fig-train-pie">pie title Train-Test-Aufteilung
    "Train" : 80
    "Test" : 19
    "The Unkown God": 1
</pre>
</div>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;6.1: 80-20-Aufteilung der Daten in Train- bzw. Test-Sample</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Praktisch funktioniert das in <span class="citation" data-cites="silge_tidy_2022">Silge und Kuhn (<a href="references.html#ref-silge_tidy_2022" role="doc-biblioref">2022</a>)</span> wie folgt.</p>
<p>Wir laden die Daten und erstellen einen Index, der jeder Beobachtung die Zuteilung zu Train- bzw. zum Test-Datensatz zuweist.</p>
<p>Das kann, mit <code>tidymodels</code> so aussehen:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-6_d511f42b7571deb7867862e6cfb2f3f0">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">ames</span>, prop <span class="op">=</span> <span class="fl">0.80</span>, strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>initial_split()</code> speichert für spätere komfortable Verwendung auch die Daten. Aber eben auch der Index, der bestimmt, welche Beobachtung im Train-Set landet:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-7_3271a8b8d0ad97a7aac5a848b6d5bd70">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_split</span><span class="op">$</span><span class="va">in_id</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">##  [1] 28 30 31 32 33 35 79 83 84 87</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ames_split</span><span class="op">$</span><span class="va">in_id</span><span class="op">)</span></span>
<span><span class="co">## [1] 2342</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Praktisch ist auch, dass die AV-Verteilung in beiden Datensätzen ähnlich gehalten wird (Stratifizierung), das besorgt das Argument <code>strata</code>.</p>
<p>Die eigentlich Aufteilung in die zwei Datensätze geht dann so:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/train-test-ames_1f5f4ef8fdff54dc015a19f75c23d5e9">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span>
<span><span class="va">ames_test</span>  <span class="op">&lt;-</span>  <span class="fu">testing</span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="grundlagen-der-modellierung-mit-tidymodels" class="level2" data-number="6.5"><h2 data-number="6.5" class="anchored" data-anchor-id="grundlagen-der-modellierung-mit-tidymodels">
<span class="header-section-number">6.5</span> Grundlagen der Modellierung mit tidymodels</h2>
<p>Dieser Abschnitt bezieht sich auf <a href="https://www.tmwr.org/models.html">Kapitel 6</a> in <span class="citation" data-cites="silge_tidy_2022">Silge und Kuhn (<a href="references.html#ref-silge_tidy_2022" role="doc-biblioref">2022</a>)</span>.</p>
<p><code>tidymodels</code> ist eine Sammlung mehrerer, zusammengehöriger Pakete, eben zum Thema statistische Modellieren.</p>
<p>Das kann man analog zur Sammlung <code>tidyverse</code> verstehen, zu der z.B. das R-Paket <code>dplyr</code> gehört.</p>
<p>Das R-Paket innerhalb von <code>tidymodels</code>, das zum “Fitten” von Modellen zuständig ist, heißt <a href="https://parsnip.tidymodels.org/">parsnip</a>.</p>
<p>Eine Liste der verfügbaren Modelltypen, Modellimplementierungen und Modellparameter, die in Parsnip aktuell unterstützt werden, findet sich <a href="https://www.tidymodels.org/find/parsnip/">hier</a>.</p>
<section id="modelle-spezifizieren" class="level3" data-number="6.5.1"><h3 data-number="6.5.1" class="anchored" data-anchor-id="modelle-spezifizieren">
<span class="header-section-number">6.5.1</span> Modelle spezifizieren</h3>
<p>Ein (statistisches) Modell wird in Tidymodels mit drei Elementen spezifiziert, vgl. <a href="#fig-tidymodels-def">Abbildung&nbsp;<span>6.2</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-tidymodels-def" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><div>
<pre class="mermaid mermaid-js" data-label="fig-tidymodels-def">flowchart LR
   
  

  subgraph Modus
  r2[regresssion]
  classification
  end
  
  subgraph Implementierung
  lm
  stan_glm
  div2[...]
  end
  
  subgraph Algorithmus
  R[Regression]
  NN[Neuronale Netze]
  div[...]
  end 
  

</pre>
</div>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;6.2: Definition eines Models in tidymodels</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Die Definition eines Modells in tidymodels folgt diesen Ideen:</p>
<ol type="1">
<li>Das Modell sollte unabhängig von den Daten spezifiziert sein</li>
<li>Das Modell sollte unabhängig von den Variablen (AV, UVs) spezifiziert sein</li>
<li>Das Modell sollte unabhängig von etwaiger Vorverarbeitung (z.B. z-Transformation) spezifiziert sein</li>
</ol>
<p>Da bei einer linearen Regression nur der Modus “Regression” möglich ist, muss der Modus in diesem Fall nicht angegeben werden. Tidymodels erkennt das automatisch.</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-9_c6f0584896f0d5d39e9025685c022bd5">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_model</span> <span class="op">&lt;-</span>   </span>
<span>  <span class="fu">linear_reg</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>   <span class="co"># Algorithmus, Modelltyp</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"lm"</span><span class="op">)</span>  <span class="co"># Implementierung</span></span>
<span>  <span class="co"># Modus hier nicht nötig, da lineare Modelle immer numerisch klassifizieren</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="modelle-berechnen" class="level3" data-number="6.5.2"><h3 data-number="6.5.2" class="anchored" data-anchor-id="modelle-berechnen">
<span class="header-section-number">6.5.2</span> Modelle berechnen</h3>
<p>Nach <span class="citation" data-cites="rhys">Rhys (<a href="references.html#ref-rhys" role="doc-biblioref">2020</a>)</span> ist ein Modell sogar erst ein Modell, wenn die Koeffizienten berechnet sind. Tidymodels kennt diese Unterscheidung nicht. Stattdessen spricht man in Tidymodels von einem “gefitteten” Modell, sobald es berechnet ist. Ähnlich fancy könnte man von einem “instantiierten” Modell sprechen.</p>
<p>Für das Beispiel der einfachen linearen Regression heißt das, das Modell ist gefittet, sobald die Steigung und der Achsenabschnitt (sowie die Residualstreuung) berechnet sind.</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-10_bb9d4a82f55a35e82777a852b3833f45">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_form_fit</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">lm_model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">fit</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Longitude</span> <span class="op">+</span> <span class="va">Latitude</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="vorhersagen" class="level3" data-number="6.5.3"><h3 data-number="6.5.3" class="anchored" data-anchor-id="vorhersagen">
<span class="header-section-number">6.5.3</span> Vorhersagen</h3>
<p>Im maschinellen Lernen ist man primär an den Vorhersagen interessiert, häufig nur an Punktschätzungen. Schauen wir uns also zunächst diese an.</p>
<p>Vorhersagen bekommt man recht einfach mit der <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> Methode von tidymodels<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-11_dfdf76613c827eb38343564a4a31d6d7">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">lm_form_fit</span>, new_data <span class="op">=</span> <span class="va">ames_test</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".pred"],"name":[1],"type":["dbl"],"align":["right"]}],"data":[{"1":"5.223329"},{"1":"5.267239"},{"1":"5.269027"},{"1":"5.259346"},{"1":"5.243253"},{"1":"5.240116"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Die Syntax zum Vorhersagen lautet also: <code>predict(modell, daten_zum_vorhersagen)</code>.</p>
</section><section id="vorhersagen-im-train-datensatz" class="level3" data-number="6.5.4"><h3 data-number="6.5.4" class="anchored" data-anchor-id="vorhersagen-im-train-datensatz">
<span class="header-section-number">6.5.4</span> Vorhersagen im Train-Datensatz</h3>
<p>Vorhersagen im Train-Datensatz machen kaum Sinn, da sie nicht gegen Overfitting geschützt sind und daher deutlich zu optimistisch sein können.</p>
<p>Bei einer linearen Regression ist diese Gefahr nicht so hoch, aber bei anderen, flexibleren Modellen, ist diese Gefahr absurd groß.</p>
</section><section id="modellkoeffizienten-im-train-datensatz" class="level3" data-number="6.5.5"><h3 data-number="6.5.5" class="anchored" data-anchor-id="modellkoeffizienten-im-train-datensatz">
<span class="header-section-number">6.5.5</span> Modellkoeffizienten im Train-Datensatz</h3>
<p>Gibt man den Namen des Modellobjekts ein, so wird ein Überblick an relevanten Modellergebnissen am Bildschirm gedruckt:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-12_492b28cee73cbeaab58abacf8ba12bb1">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_form_fit</span></span>
<span><span class="co">## parsnip model object</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## stats::lm(formula = Sale_Price ~ Longitude + Latitude, data = data)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## (Intercept)    Longitude     Latitude  </span></span>
<span><span class="co">##    -314.955       -2.134        2.863</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Innerhalb des Ergebnisobjekts findet sich eine Liste namens <code>fit</code>, in der die Koeffizienten (der “Fit”) abgelegt sind:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-13_12789ff6276a473791cc3b890e021dfd">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_form_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="st">"fit"</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## stats::lm(formula = Sale_Price ~ Longitude + Latitude, data = data)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## (Intercept)    Longitude     Latitude  </span></span>
<span><span class="co">##    -314.955       -2.134        2.863</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Zum Herausholen dieser Infos kann man auch alternativ die Funktion <code>extract_fit_engine()</code> verwenden:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-14_134e1e0738b53405f6c8451bfdce2657">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_fit</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">lm_form_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">extract_fit_engine</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_fit</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## stats::lm(formula = Sale_Price ~ Longitude + Latitude, data = data)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## (Intercept)    Longitude     Latitude  </span></span>
<span><span class="co">##    -314.955       -2.134        2.863</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hinweis
</div>
</div>
<div class="callout-body-container callout-body">
<p>Möchten Sie wissen, was sich in <code>lm_form_fit</code> alles verbirgt, bietet sich die Funktion <code>str</code> an. Alternativ können Sie in RStudio unter <code>Environment</code> das Objekt “aufklappen”.</p>
</div>
</div>
<p>Das extrahierte Objekt ist, in diesem Fall, das typische <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> Objekt. Entsprechend kann man daruaf <code><a href="https://rdrr.io/r/stats/coef.html">coef()</a></code> oder <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> anwenden.</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-15_bafec50348595fe24d76ffc968262db3">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span></span>
<span><span class="co">## (Intercept)   Longitude    Latitude </span></span>
<span><span class="co">## -314.954598   -2.133832    2.863270</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## stats::lm(formula = Sale_Price ~ Longitude + Latitude, data = data)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">## -1.02404 -0.09525 -0.01574  0.09584  0.54193 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept) -314.9546    14.3978  -21.88   &lt;2e-16 ***</span></span>
<span><span class="co">## Longitude     -2.1338     0.1274  -16.75   &lt;2e-16 ***</span></span>
<span><span class="co">## Latitude       2.8633     0.1804   15.87   &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.1588 on 2339 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.1794, Adjusted R-squared:  0.1787 </span></span>
<span><span class="co">## F-statistic: 255.6 on 2 and 2339 DF,  p-value: &lt; 2.2e-16</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Schicker sind die Pendant-Befehle aus <code>broom</code>, die jeweils einen Tibble zuückliefern:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-16_11b2714d22ee76ed1cc99f3ffd3e9ac1">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span> <span class="co"># Koeffizienten</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"-314.954598","3":"14.3978344","4":"-21.87514","5":"1.154907e-96"},{"1":"Longitude","2":"-2.133832","3":"0.1273526","4":"-16.75530","5":"1.344922e-59"},{"1":"Latitude","2":"2.863270","3":"0.1804094","4":"15.87096","5":"5.951199e-54"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html">glance</a></span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span> <span class="co"># Modellgüte</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["r.squared"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["adj.r.squared"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sigma"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["logLik"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["BIC"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["deviance"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["df.residual"],"name":[11],"type":["int"],"align":["right"]},{"label":["nobs"],"name":[12],"type":["int"],"align":["right"]}],"data":[{"1":"0.179376","2":"0.1786743","3":"0.1588285","4":"255.6351","5":"3.905206e-101","6":"2","7":"987.4633","8":"-1966.927","9":"-1943.892","10":"59.00478","11":"2339","12":"2342"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Eine weitere Alternative sind die Befehle zur Modell-Performance von <code>easystats´^[Paket</code>performance`]:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-17_5cd4f3dfad0df0dfec3bef1e5e18c4f9">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/easystats/">easystats</a></span><span class="op">)</span></span>
<span><span class="fu">parameters</span><span class="op">(</span><span class="va">lm_form_fit</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Parameter"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Coefficient"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["CI"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["CI_low"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["CI_high"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["t"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["df_error"],"name":[8],"type":["int"],"align":["right"]},{"label":["p"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"-314.954598","3":"14.3978344","4":"0.95","5":"-343.188445","6":"-286.720751","7":"-21.87514","8":"2339","9":"4.481650e-106"},{"1":"Longitude","2":"-2.133832","3":"0.1273526","4":"0.95","5":"-2.383568","6":"-1.884096","7":"-16.75530","8":"2339","9":"5.179886e-63"},{"1":"Latitude","2":"2.863270","3":"0.1804094","4":"0.95","5":"2.509491","6":"3.217049","7":"15.87096","8":"2339","9":"1.006959e-56"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">r2</span><span class="op">(</span><span class="va">lm_form_fit</span><span class="op">)</span></span>
<span><span class="co">## # R2 for Linear Regression</span></span>
<span><span class="co">##        R2: 0.179</span></span>
<span><span class="co">##   adj. R2: 0.179</span></span>
<span><span class="fu">mae</span><span class="op">(</span><span class="va">lm_form_fit</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.1211582</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="parsnip-rstudio-add-in" class="level3" data-number="6.5.6"><h3 data-number="6.5.6" class="anchored" data-anchor-id="parsnip-rstudio-add-in">
<span class="header-section-number">6.5.6</span> Parsnip RStudio add-in</h3>
<p>Mit dem Add-in von Parsnip kann man sich eine Modellspezifikation per Klick ausgeben lassen. Nett!</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-18_5461edc3fed63a2e765e8de15ff41e21">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">parsnip_addin</span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="workflows" class="level2" data-number="6.6"><h2 data-number="6.6" class="anchored" data-anchor-id="workflows">
<span class="header-section-number">6.6</span> Workflows</h2>
<p>Dieser Abschnitt bezieht sich auf <a href="https://www.tmwr.org/workflows.html">Kapitel 7</a> in <span class="citation" data-cites="silge_tidy_2022">Silge und Kuhn (<a href="references.html#ref-silge_tidy_2022" role="doc-biblioref">2022</a>)</span>.</p>
<section id="konzept-des-workflows-in-tidymodels" class="level3" data-number="6.6.1"><h3 data-number="6.6.1" class="anchored" data-anchor-id="konzept-des-workflows-in-tidymodels">
<span class="header-section-number">6.6.1</span> Konzept des Workflows in Tidymodels</h3>
<div class="cell" data-hash="060-tidymodels_cache/html/tidymodels-workflow_f6043036379ae454ee4f3f7d227a247c">
<div class="cell-output-display">
<div id="htmlwidget-f40327fcf1d8b6eb40c9" style="width:100%;height:500px;" class="nomnoml html-widget "></div>
<script type="application/json" data-for="htmlwidget-f40327fcf1d8b6eb40c9">{"x":{"code":"\n#fill: #FEFEFF\n#lineWidth: 1\n#zoom: 4\n#direction: right\n\n\n[Workflow|\n  [preprocessing|\n   Vorverarbeitung;\n   Imputation;\n   Transformation;\n   Prädiktorwahl\n   AV-Wahl\n   ...\n  \n  ]\n  [fitting |\n    Modell berechnen\n    ...\n  ]\n  [postprocessing|\n    Grenzwerte für Klass. festlegen\n    ...\n  ]\n]\n","svg":false,"png":null},"evals":[],"jsHooks":[]}</script><p>Definition eines Models in tidymodels</p>
</div>
</div>
</section><section id="einfaches-beispiel" class="level3" data-number="6.6.2"><h3 data-number="6.6.2" class="anchored" data-anchor-id="einfaches-beispiel">
<span class="header-section-number">6.6.2</span> Einfaches Beispiel</h3>
<p>Wir initialisieren einen Workflow, verzichten auf Vorverarbeitung und fügen ein Modell hinzu:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-19_1978bea147a7f89895b465b8454569b5">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_workflow</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># init</span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">lm_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>   <span class="co"># Modell hinzufügen</span></span>
<span>  <span class="fu">add_formula</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Longitude</span> <span class="op">+</span> <span class="va">Latitude</span><span class="op">)</span>  <span class="co"># Modellformel hinzufügen</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Werfen wir einen Blick in das Workflow-Objekt:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-20_1d4c5ea6d69ecacee8bc0b2d5ec60b10">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_workflow</span></span>
<span><span class="co">## ══ Workflow ════════════════════════════════════════════════════════════════════</span></span>
<span><span class="co">## Preprocessor: Formula</span></span>
<span><span class="co">## Model: linear_reg()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Preprocessor ────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">## Sale_Price ~ Longitude + Latitude</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Model ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">## Linear Regression Model Specification (regression)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Computational engine: lm</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wie man sieht, gehört die <em>Modellformel</em> (<code>y ~ x</code>) zur Vorverarbeitung aus Sicht von Tidymodels.</p>
<p>Was war nochmal im Objekt <code>lm_model</code> enthalten?</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-21_caf385baf5ab2fa3cd304a4f5156285e">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_model</span></span>
<span><span class="co">## Linear Regression Model Specification (regression)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Computational engine: lm</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Jetzt können wir das Modell berechnen (fitten):</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-22_6037ab4bba8455bc8ec8a6df642921d7">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_fit</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">lm_workflow</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">fit</span><span class="op">(</span><span class="va">ames_train</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Natürlich kann man synonym auch schreiben:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-23_56b934da8dac87e9ffc770984234f2da">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_fit</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">lm_wflow</span>, <span class="va">ames_train</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Schauen wir uns das Ergebnis an:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-24_5ff8934b79de07c40b1a7eadf28036fe">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_fit</span></span>
<span><span class="co">## ══ Workflow [trained] ══════════════════════════════════════════════════════════</span></span>
<span><span class="co">## Preprocessor: Formula</span></span>
<span><span class="co">## Model: linear_reg()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Preprocessor ────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">## Sale_Price ~ Longitude + Latitude</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Model ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## stats::lm(formula = ..y ~ ., data = data)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## (Intercept)    Longitude     Latitude  </span></span>
<span><span class="co">##    -314.955       -2.134        2.863</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="vorhersage-mit-einem-workflow" class="level3" data-number="6.6.3"><h3 data-number="6.6.3" class="anchored" data-anchor-id="vorhersage-mit-einem-workflow">
<span class="header-section-number">6.6.3</span> Vorhersage mit einem Workflow</h3>
<p>Die Vorhersage mit einem Tidymodels-Workflow ist einerseits komfortabel, da man einfach sagen kann:</p>
<p>“Nimm die richtigen Koeffizienten des Modells aus dem Train-Set und wende sie auf das Test-Sample an. Berechne mir die Vorhersagen und die Modellgüte.”</p>
<p>So sieht das aus:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-25_d8ae8afc5d1424996338d1b110e3dbd7">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">final_lm_res</span> <span class="op">&lt;-</span> <span class="fu">last_fit</span><span class="op">(</span><span class="va">lm_workflow</span>, <span class="va">ames_split</span><span class="op">)</span></span>
<span><span class="va">final_lm_res</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["splits"],"name":[1],"type":["list"],"align":["right"]},{"label":["id"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".metrics"],"name":[3],"type":["list"],"align":["right"]},{"label":[".notes"],"name":[4],"type":["list"],"align":["right"]},{"label":[".predictions"],"name":[5],"type":["list"],"align":["right"]},{"label":[".workflow"],"name":[6],"type":["list"],"align":["right"]}],"data":[{"1":"<S3: initial_split>","2":"train/test split","3":"<tibble[,4]>","4":"<tibble[,3]>","5":"<tibble[,4]>","6":"<S3: workflow>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Also, <code>last_fit</code> kümmert sich um Folgendes:</p>
<ol type="1">
<li>Berechne Modell im (kompletten) Train-Sample</li>
<li>Sage Daten im Test-Sample vorher</li>
<li>Berechne Modellgüte im Test-Sample</li>
</ol>
<p>Es wird ein recht komplexes Objekt zurückgeliefert, das man erst mal durchschauen muss.</p>
<p>Wie man sieht, gibt es mehrere Listenspalten in <code>final_lm_res</code>. Besonders interessant erscheinen natürlich die Listenspalten <code>.metrics</code> und <code>.predictions</code>.</p>
<p>Schauen wir uns die Vorhersagen an. Diese finden sich im resultierenden Objekt von <code>last_fit</code>, zusammen mit anderen Informationen wie MOdellgüte. Die <code>.predictions</code> sind selber ein Tibble, wo in der ersten Spalte die Vorhersagen stehen.</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-26_75b72efe4bb3690fe2c8cee944d41f9f">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_preds</span> <span class="op">&lt;-</span> <span class="va">final_lm_res</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="st">".predictions"</span>, <span class="fl">1</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Es gibt auch eine Funktion, die obige Zeile vereinfacht (also synonym ist):</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-27_27b27dd18975786558fa8dda3dd3792a">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_preds</span> <span class="op">&lt;-</span> <span class="fu">collect_predictions</span><span class="op">(</span><span class="va">final_lm_res</span><span class="op">)</span></span>
<span><span class="va">lm_preds</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".pred"],"name":[2],"type":["dbl"],"align":["right"]},{"label":[".row"],"name":[3],"type":["int"],"align":["right"]},{"label":["Sale_Price"],"name":[4],"type":["dbl"],"align":["right"]},{"label":[".config"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"train/test split","2":"5.223329","3":"2","4":"5.021189","5":"Preprocessor1_Model1"},{"1":"train/test split","2":"5.267239","3":"14","4":"5.234264","5":"Preprocessor1_Model1"},{"1":"train/test split","2":"5.269027","3":"15","4":"5.326336","5":"Preprocessor1_Model1"},{"1":"train/test split","2":"5.259346","3":"18","4":"5.595972","5":"Preprocessor1_Model1"},{"1":"train/test split","2":"5.243253","3":"24","4":"5.173186","5":"Preprocessor1_Model1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="modellgüte" class="level3" data-number="6.6.4"><h3 data-number="6.6.4" class="anchored" data-anchor-id="modellgüte">
<span class="header-section-number">6.6.4</span> Modellgüte</h3>
<p>Dieser Abschnitt bezieht sich auf <a href="https://www.tmwr.org/performance.html">Kapitel 9</a> in <span class="citation" data-cites="silge_tidy_2022">Silge und Kuhn (<a href="references.html#ref-silge_tidy_2022" role="doc-biblioref">2022</a>)</span>.</p>
<p>Die Vorhersagen bilden die Basis für die Modellgüte (“Metriken”), die schon fertig berechnet im Objekt <code>final_lm_res</code> liegen und mit <code>collect_metrics</code> herausgenommen werden können:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-28_718b1db45ac7267dc5e57239c7e4d194">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_metrics</span> <span class="op">&lt;-</span> <span class="fu">collect_metrics</span><span class="op">(</span><span class="va">final_lm_res</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternativ kommt man mit <code>pluck(final_lm_res, ".metrics")</code> an die gleichen Informationen.</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-29_22e05afeb601402af67c578a5f4e1c83">
<div class="cell-output-display">

<div id="udhrywlajh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#udhrywlajh table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#udhrywlajh thead, #udhrywlajh tbody, #udhrywlajh tfoot, #udhrywlajh tr, #udhrywlajh td, #udhrywlajh th {
  border-style: none;
}

#udhrywlajh p {
  margin: 0;
  padding: 0;
}

#udhrywlajh .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#udhrywlajh .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#udhrywlajh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#udhrywlajh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#udhrywlajh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#udhrywlajh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#udhrywlajh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#udhrywlajh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#udhrywlajh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#udhrywlajh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#udhrywlajh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#udhrywlajh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#udhrywlajh .gt_spanner_row {
  border-bottom-style: hidden;
}

#udhrywlajh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#udhrywlajh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#udhrywlajh .gt_from_md > :first-child {
  margin-top: 0;
}

#udhrywlajh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#udhrywlajh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#udhrywlajh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#udhrywlajh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#udhrywlajh .gt_row_group_first td {
  border-top-width: 2px;
}

#udhrywlajh .gt_row_group_first th {
  border-top-width: 2px;
}

#udhrywlajh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#udhrywlajh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#udhrywlajh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#udhrywlajh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#udhrywlajh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#udhrywlajh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#udhrywlajh .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#udhrywlajh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#udhrywlajh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#udhrywlajh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#udhrywlajh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#udhrywlajh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#udhrywlajh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#udhrywlajh .gt_left {
  text-align: left;
}

#udhrywlajh .gt_center {
  text-align: center;
}

#udhrywlajh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#udhrywlajh .gt_font_normal {
  font-weight: normal;
}

#udhrywlajh .gt_font_bold {
  font-weight: bold;
}

#udhrywlajh .gt_font_italic {
  font-style: italic;
}

#udhrywlajh .gt_super {
  font-size: 65%;
}

#udhrywlajh .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#udhrywlajh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#udhrywlajh .gt_indent_1 {
  text-indent: 5px;
}

#udhrywlajh .gt_indent_2 {
  text-indent: 10px;
}

#udhrywlajh .gt_indent_3 {
  text-indent: 15px;
}

#udhrywlajh .gt_indent_4 {
  text-indent: 20px;
}

#udhrywlajh .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=".metric">.metric</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=".estimator">.estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id=".estimate">.estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=".config">.config</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td headers=".metric" class="gt_row gt_left">rmse</td>
<td headers=".estimator" class="gt_row gt_left">standard</td>
<td headers=".estimate" class="gt_row gt_right">1.70 × 10<sup style="font-size: 65%;">−1</sup>
</td>
<td headers=".config" class="gt_row gt_left">Preprocessor1_Model1</td>
</tr>
<tr>
<td headers=".metric" class="gt_row gt_left">rsq</td>
<td headers=".estimator" class="gt_row gt_left">standard</td>
<td headers=".estimate" class="gt_row gt_right">1.48 × 10<sup style="font-size: 65%;">−1</sup>
</td>
<td headers=".config" class="gt_row gt_left">Preprocessor1_Model1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Man kann auch angeben, welche Metriken der Modellgüte man bekommen möchte:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-30_404c2aaeb3cd68beab4b3fc22568899d">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_metrics</span> <span class="op">&lt;-</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">rmse</span>, <span class="va">rsq</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ames_metrics</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lm_preds</span>, </span>
<span>             truth <span class="op">=</span> <span class="va">Sale_Price</span>, </span>
<span>             estimate <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="vorhersage-von-hand" class="level3" data-number="6.6.5"><h3 data-number="6.6.5" class="anchored" data-anchor-id="vorhersage-von-hand">
<span class="header-section-number">6.6.5</span> Vorhersage von Hand</h3>
<p>Man kann sich die Metriken auch von Hand ausgeben lassen, wenn man direktere Kontrolle haben möchte als mit <code>last_fit</code> und <code>collect_metrics</code>.</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-31_441e4282a4d5d5fb974d7e70956e4f84">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_test_small</span> <span class="op">&lt;-</span> <span class="va">ames_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">lm_form_fit</span>, new_data <span class="op">=</span> <span class="va">ames_test_small</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".pred"],"name":[1],"type":["dbl"],"align":["right"]}],"data":[{"1":"5.223329"},{"1":"5.267239"},{"1":"5.269027"},{"1":"5.259346"},{"1":"5.243253"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Jetzt binden wir die Spalten zusammen, also die “Wahrheit” (<span class="math inline">\(y\)</span>, die beobachteten, tatsächlichen Y-Werte) und die Vorhersagen (<span class="math inline">\(\hat{y}\)</span>):</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-32_79235cc00037d025e7953ccfc878d116">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_test_small2</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">ames_test_small</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">lm_form_fit</span>, <span class="va">ames_test_small</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Add 95% prediction intervals to the results:</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">lm_form_fit</span>, <span class="va">ames_test_small</span>, type <span class="op">=</span> <span class="st">"pred_int"</span><span class="op">)</span><span class="op">)</span> </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-33_247f6bb0ce73f7ed185da6df22437496">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">rsq</span><span class="op">(</span><span class="va">ames_test_small2</span>, </span>
<span>   truth <span class="op">=</span> <span class="va">Sale_Price</span>,</span>
<span>   estimate <span class="op">=</span> <span class="va">.pred</span></span>
<span>   <span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"rsq","2":"standard","3":"0.4340432"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Andere Koeffizienten der Modellgüte können mit <code>rmse</code> oder <code>mae</code><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> abgerufen werden.</p>
</section></section><section id="rezepte-zur-vorverarbeitung" class="level2" data-number="6.7"><h2 data-number="6.7" class="anchored" data-anchor-id="rezepte-zur-vorverarbeitung">
<span class="header-section-number">6.7</span> Rezepte zur Vorverarbeitung</h2>
<p>Dieser Abschnitt bezieht sich auf <a href="https://www.tmwr.org/recipes.html">Kapitel 8</a> in <span class="citation" data-cites="silge_tidy_2022">Silge und Kuhn (<a href="references.html#ref-silge_tidy_2022" role="doc-biblioref">2022</a>)</span>.</p>
<section id="was-ist-rezept-und-wozu-ist-es-gut" class="level3" data-number="6.7.1"><h3 data-number="6.7.1" class="anchored" data-anchor-id="was-ist-rezept-und-wozu-ist-es-gut">
<span class="header-section-number">6.7.1</span> Was ist Rezept und wozu ist es gut?</h3>
<p>So könnte ein typischer Aufruf von <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> aussehen:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-34_38dd5680b9be7f30c5df42a7f67531d6">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Neighborhood</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">Gr_Liv_Area</span><span class="op">)</span> <span class="op">+</span> <span class="va">Year_Built</span> <span class="op">+</span> <span class="va">Bldg_Type</span>, </span>
<span>   data <span class="op">=</span> <span class="va">ames</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Neben dem Fitten des Modells besorgt die Formel-Schreibweise noch einige zusätzliche nützliche Vorarbeitung:</p>
<ol type="1">
<li>Definition von AV und AV</li>
<li>Log-Transformation von <code>Gr_Liv_Area</code>
</li>
<li>Transformation der nominalen Variablen in Dummy-Variablen</li>
</ol>
<p>Das ist schön und nützlich, hat aber auch Nachteile:</p>
<ol type="1">
<li>Das Modell wird nicht nur spezifiziert, sondern auch gleich berechnet. Das ist unpraktisch, weil man die Modellformel vielleicht in anderen Modell wiederverwenden möchte. Außerdem kann das Berechnen lange dauern.</li>
<li>Die Schritte sind ineinander vermengt, so dass man nicht einfach und übersichtlich die einzelnen Schritte bearbeiten kann.</li>
</ol>
<p>Praktischer wäre also, die Schritte der Vorverarbeitung zu ent-flechten. Das geht mit einem “Rezept” aus Tidymodels:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-35_ce584763586a67db49c631edd5cca25c">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">simple_ames</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Neighborhood</span> <span class="op">+</span> <span class="va">Gr_Liv_Area</span> <span class="op">+</span> <span class="va">Year_Built</span> <span class="op">+</span> <span class="va">Bldg_Type</span>,</span>
<span>         data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">step_log</span><span class="op">(</span><span class="va">Gr_Liv_Area</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">step_dummy</span><span class="op">(</span><span class="fu">all_nominal_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">simple_ames</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hinweis
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ein Rezept berechnet kein Modell. Es macht nichts außer die Vorverarbeitung des Modells zu spezifizieren (inklusive der Modellformel).</p>
</div>
</div>
</section><section id="workflows-mit-rezepten" class="level3" data-number="6.7.2"><h3 data-number="6.7.2" class="anchored" data-anchor-id="workflows-mit-rezepten">
<span class="header-section-number">6.7.2</span> Workflows mit Rezepten</h3>
<p>Jetzt definieren wir den Workflow nicht nur mit einer Modellformel, sondern mit einem Rezept:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-36_e5364e4c078befd4c2303d9da5c9cc5b">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_workflow</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">lm_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">simple_ames</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sonst hat sich nichts geändert.</p>
<p>Wie vorher, können wir jetzt das Modell berechnen und uns im Test-Set die Vorhersagen berechnen lassen:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-37_b37ceae6e57e2ed7d55d2049f20911c3">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">final_lm_res</span> <span class="op">&lt;-</span> <span class="fu">last_fit</span><span class="op">(</span><span class="va">lm_workflow</span>, <span class="va">ames_split</span><span class="op">)</span></span>
<span><span class="va">final_lm_res</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["splits"],"name":[1],"type":["list"],"align":["right"]},{"label":["id"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".metrics"],"name":[3],"type":["list"],"align":["right"]},{"label":[".notes"],"name":[4],"type":["list"],"align":["right"]},{"label":[".predictions"],"name":[5],"type":["list"],"align":["right"]},{"label":[".workflow"],"name":[6],"type":["list"],"align":["right"]}],"data":[{"1":"<S3: initial_split>","2":"train/test split","3":"<tibble[,4]>","4":"<tibble[,3]>","5":"<tibble[,4]>","6":"<S3: workflow>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Hier ist die Modellgüte:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-38_a452a1432f971f227cdfe5e4f90ea6a0">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_metrics</span> <span class="op">&lt;-</span> <span class="fu">collect_metrics</span><span class="op">(</span><span class="va">final_lm_res</span><span class="op">)</span></span>
<span><span class="va">lm_metrics</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":[".config"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"rmse","2":"standard","3":"0.0824877","4":"Preprocessor1_Model1"},{"1":"rsq","2":"standard","3":"0.7995790","4":"Preprocessor1_Model1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="spaltenrollen" class="level3" data-number="6.7.3"><h3 data-number="6.7.3" class="anchored" data-anchor-id="spaltenrollen">
<span class="header-section-number">6.7.3</span> Spaltenrollen</h3>
<p>Eine praktische Funktion ist es, bestimmte Spalten nicht als Prädiktor, sondern als ID-Variable zu nutzen. Das kann man in Tidymodels komfortabel wie folgt angeben:</p>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-39_a89c0b81826c8a9ef26fb1b16584046a">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_recipe</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">simple_ames</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">update_role</span><span class="op">(</span><span class="va">Neighborhood</span>, new_role <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_recipe</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="preppen-und-backen" class="level3" data-number="6.7.4"><h3 data-number="6.7.4" class="anchored" data-anchor-id="preppen-und-backen">
<span class="header-section-number">6.7.4</span> Preppen und Backen</h3>
<p>Ein Rezept ist erstmal nur, ja, ein Rezept: Eine Beschreibung von Schritten und Zutaten. Es ist noch nichts gebacken. Um aus einen Rezept einen “Kuchen” - den transformierten Datensatz - zu bekommen, sind zwei Schritte nötig:</p>
<ol type="1">
<li>
<em>Vorbereiten</em> (to prep): Die Parameter des Rezeptschritte berechnen. So muss der Schritt <code>step_center(var)</code> den Mittelwert von <code>var</code> wissen, sonst kann der Schritt nicht durchgeführt werden.</li>
<li>
<em>Backen</em> ist das Rezept vorbereitet, kann der Datensatz damit gebacken werden.</li>
</ol>
<p>Praktischerweise erledigt Tidymodels das alles automatisch für uns, wir haben da nichts zu tun.</p>
<p>Allerdings ist es manchmal praktisch, den durch das Rezept “gebackenen” (transformierten) Datensatz zu sehen, daher sollte man wissen, wie man das “preppen” und “backen” von Hand erledigt.</p>
<ol type="1">
<li>Preppen:</li>
</ol>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-40_d67b9fd91fc977dd88787691c0555760">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_recipe_prepped</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ames_recipe</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">prep</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_recipe_prepped</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Backen:</li>
</ol>
<div class="cell" data-hash="060-tidymodels_cache/html/unnamed-chunk-41_319b7490c517785ed695e5dd92763bac">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_train_baked</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">ames_recipe_prepped</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">bake</span><span class="op">(</span>new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">ames_train_baked</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Neighborhood"],"name":[1],"type":["fct"],"align":["left"]},{"label":["Gr_Liv_Area"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Year_Built"],"name":[3],"type":["int"],"align":["right"]},{"label":["Sale_Price"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Bldg_Type_TwoFmCon"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Bldg_Type_Duplex"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["Bldg_Type_Twnhs"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Bldg_Type_TwnhsE"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"North_Ames","2":"2.936514","3":"1971","4":"5.060698","5":"0","6":"0","7":"0","8":"0"},{"1":"Briardale","2":"2.994317","3":"1971","4":"4.982271","5":"0","6":"0","7":"1","8":"0"},{"1":"Briardale","2":"3.038223","3":"1971","4":"5.023252","5":"0","6":"0","7":"1","8":"0"},{"1":"Briardale","2":"3.038223","3":"1971","4":"4.944483","5":"0","6":"0","7":"1","8":"0"},{"1":"Northpark_Villa","2":"3.028978","3":"1977","4":"5.105510","5":"0","6":"0","7":"0","8":"1"},{"1":"Northpark_Villa","2":"2.922206","3":"1975","4":"5.079181","5":"0","6":"0","7":"1","8":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="fazit" class="level3" data-number="6.7.5"><h3 data-number="6.7.5" class="anchored" data-anchor-id="fazit">
<span class="header-section-number">6.7.5</span> Fazit</h3>
<p>Mehr zu Rezepten findet sich <a href="https://recipes.tidymodels.org/">hier</a>. Ein Überblick zu allen Schritten der Vorverarbeitung findet sich <a href="https://www.tidymodels.org/find/recipes/">hier</a>.</p>
</section></section><section id="aufgaben" class="level2" data-number="6.8"><h2 data-number="6.8" class="anchored" data-anchor-id="aufgaben">
<span class="header-section-number">6.8</span> Aufgaben</h2>
<ol type="1">
<li><a href="https://datenwerk.netlify.app/posts/tidymodels-ames-01/tidymodels-ames-01.html">tidymodels-ames-01</a></li>
<li><a href="https://datenwerk.netlify.app/posts/tidymodels-ames-02/tidymodels-ames-02.html">tidymodels-ames-02</a></li>
<li><a href="https://datenwerk.netlify.app/posts/tidymodels-ames-03/tidymodels-ames-03.html">tidymodels-ames-03</a></li>
<li><a href="https://datenwerk.netlify.app/posts/tidymodels-ames-04/tidymodels-ames-04.html">tidymodels-ames-04</a></li>
<li><a href="https://datenwerk.netlify.app/posts/bike01/bike01.html">bike01</a></li>
</ol></section><section id="fallstudien" class="level2" data-number="6.9"><h2 data-number="6.9" class="anchored" data-anchor-id="fallstudien">
<span class="header-section-number">6.9</span> Fallstudien</h2>
<ul>
<li><a href="https://www.tidymodels.org/start/models/">Fallstudie Seegurken</a></li>
<li><a href="https://juliasilge.com/blog/student-debt/">Sehr einfache Fallstudie zur Modellierung einer Regression mit tidymodels</a></li>
<li><a href="https://www.gmudatamining.com/lesson-10-r-tutorial.html">Fallstudie zur linearen Regression mit Tidymodels</a></li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-rhys" class="csl-entry" role="listitem">
Rhys, Hefin. 2020. <em>Machine Learning with R, the tidyverse, and mlr</em>. Shelter Island, <span>NY</span>: Manning publications.
</div>
<div id="ref-silge_tidy_2022" class="csl-entry" role="listitem">
Silge, Julia, und Max Kuhn. 2022. <em>Tidy <span>Modeling</span> with <span>R</span></em>. <a href="https://www.tmwr.org/">https://www.tmwr.org/</a>.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>im Gegensatz zum <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> von <code>lm</code> mit Unterstrich bei <code>new_data</code>, also <em>nicht</em> <code>newdata</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Achtung: Die Funktion <code>mae</code> gibt es sowohl in tidymodels auch in easystats, hier kann es zu Konflikten kommen.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./050-R-Vertiefung.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">R, zweiter Blick</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./070-knn.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">kNN</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>