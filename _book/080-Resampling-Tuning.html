<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.247">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Grundlagen der Prognosemodellierung ğŸ”®ğŸ§° - 8&nbsp; Resampling und Tuning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./090-glm.html" rel="next">
<link href="./070-knn.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Keine Treffer",
    "search-matching-documents-text": "Treffer",
    "search-copy-link-title": "Link in die Suche kopieren",
    "search-hide-matches-text": "ZusÃ¤tzliche Treffer verbergen",
    "search-more-match-text": "weitere Treffer in diesem Dokument",
    "search-more-matches-text": "weitere Treffer in diesem Dokument",
    "search-clear-button-title": "ZurÃ¼cksetzen",
    "search-detached-cancel-button-title": "Abbrechen",
    "search-submit-button-title": "Abschicken"
  }
}</script><meta name="mermaid-theme" content="neutral">
<script src="site_libs/quarto-diagram/mermaid.min.js"></script><script src="site_libs/quarto-diagram/mermaid-init.js"></script><link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./080-Resampling-Tuning.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Resampling und Tuning</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Suchen" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Grundlagen der Prognosemodellierung ğŸ”®ğŸ§°</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Suchen"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Zu diesem Buch</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010-Hinweise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Hinweise</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./030-Pruefung.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">PrÃ¼fung</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./040-Statistisches-Lernen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Statistisches Lernen</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./050-R-Vertiefung.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">R, zweiter Blick</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./060-tidymodels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">tidymodels</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./070-knn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">kNN</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./080-Resampling-Tuning.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Resampling und Tuning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./090-glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Logistische Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./100-baeume.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">EntscheidungsbÃ¤ume</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./110-ensemble.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Ensemble Lerner</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./120-regularisierte-modelle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Regularisierte Modelle</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./130-kaggle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Kaggle</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./140-faden.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Der rote Faden</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./150-fallstudien.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Fallstudien</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./160-e.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Staunen mit e</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Inhaltsverzeichnis</h2>
   
  <ul>
<li>
<a href="#lernsteuerung" id="toc-lernsteuerung" class="nav-link active" data-scroll-target="#lernsteuerung"><span class="header-section-number">8.1</span> Lernsteuerung</a>
  <ul class="collapse">
<li><a href="#lernziele" id="toc-lernziele" class="nav-link" data-scroll-target="#lernziele"><span class="header-section-number">8.1.1</span> Lernziele</a></li>
  <li><a href="#vorbereitung" id="toc-vorbereitung" class="nav-link" data-scroll-target="#vorbereitung"><span class="header-section-number">8.1.2</span> Vorbereitung</a></li>
  <li><a href="#literatur" id="toc-literatur" class="nav-link" data-scroll-target="#literatur"><span class="header-section-number">8.1.3</span> Literatur</a></li>
  <li><a href="#ben%C3%B6tigte-r-pakete" id="toc-benÃ¶tigte-r-pakete" class="nav-link" data-scroll-target="#ben%C3%B6tigte-r-pakete"><span class="header-section-number">8.1.4</span> BenÃ¶tigte R-Pakete</a></li>
  </ul>
</li>
  <li><a href="#%C3%BCberblick" id="toc-Ã¼berblick" class="nav-link" data-scroll-target="#%C3%BCberblick"><span class="header-section-number">8.2</span> Ãœberblick</a></li>
  <li>
<a href="#tidymodels" id="toc-tidymodels" class="nav-link" data-scroll-target="#tidymodels"><span class="header-section-number">8.3</span> tidymodels</a>
  <ul class="collapse">
<li><a href="#datensatz-aufteilen" id="toc-datensatz-aufteilen" class="nav-link" data-scroll-target="#datensatz-aufteilen"><span class="header-section-number">8.3.1</span> Datensatz aufteilen</a></li>
  <li><a href="#rezept-modell-und-workflow-definieren" id="toc-rezept-modell-und-workflow-definieren" class="nav-link" data-scroll-target="#rezept-modell-und-workflow-definieren"><span class="header-section-number">8.3.2</span> Rezept, Modell und Workflow definieren</a></li>
  </ul>
</li>
  <li><a href="#resampling" id="toc-resampling" class="nav-link" data-scroll-target="#resampling"><span class="header-section-number">8.4</span> Resampling</a></li>
  <li>
<a href="#illustration-des-resampling" id="toc-illustration-des-resampling" class="nav-link" data-scroll-target="#illustration-des-resampling"><span class="header-section-number">8.5</span> Illustration des Resampling</a>
  <ul class="collapse">
<li><a href="#einfache-v-fache-kreuzvalidierung" id="toc-einfache-v-fache-kreuzvalidierung" class="nav-link" data-scroll-target="#einfache-v-fache-kreuzvalidierung"><span class="header-section-number">8.5.1</span> Einfache v-fache Kreuzvalidierung</a></li>
  <li><a href="#wiederholte-kreuzvalidierung" id="toc-wiederholte-kreuzvalidierung" class="nav-link" data-scroll-target="#wiederholte-kreuzvalidierung"><span class="header-section-number">8.5.2</span> Wiederholte Kreuzvalidierung</a></li>
  <li><a href="#resampling-passiert-im-train-sample" id="toc-resampling-passiert-im-train-sample" class="nav-link" data-scroll-target="#resampling-passiert-im-train-sample"><span class="header-section-number">8.5.3</span> Resampling passiert im Train-Sample</a></li>
  <li><a href="#andere-illustrationen" id="toc-andere-illustrationen" class="nav-link" data-scroll-target="#andere-illustrationen"><span class="header-section-number">8.5.4</span> Andere Illustrationen</a></li>
  </ul>
</li>
  <li><a href="#gesetz-der-gro%C3%9Fen-zahl" id="toc-gesetz-der-groÃŸen-zahl" class="nav-link" data-scroll-target="#gesetz-der-gro%C3%9Fen-zahl"><span class="header-section-number">8.6</span> Gesetz der groÃŸen Zahl</a></li>
  <li><a href="#%C3%BCber--und-unteranpassung-an-einem-beispiel" id="toc-Ã¼ber--und-unteranpassung-an-einem-beispiel" class="nav-link" data-scroll-target="#%C3%BCber--und-unteranpassung-an-einem-beispiel"><span class="header-section-number">8.7</span> Ãœber- und Unteranpassung an einem Beispiel</a></li>
  <li>
<a href="#cv-in-tidymodels" id="toc-cv-in-tidymodels" class="nav-link" data-scroll-target="#cv-in-tidymodels"><span class="header-section-number">8.8</span> CV in tidymodels</a>
  <ul class="collapse">
<li><a href="#cv-definieren" id="toc-cv-definieren" class="nav-link" data-scroll-target="#cv-definieren"><span class="header-section-number">8.8.1</span> CV definieren</a></li>
  <li><a href="#resamples-fitten" id="toc-resamples-fitten" class="nav-link" data-scroll-target="#resamples-fitten"><span class="header-section-number">8.8.2</span> Resamples fitten</a></li>
  </ul>
</li>
  <li>
<a href="#tuning" id="toc-tuning" class="nav-link" data-scroll-target="#tuning"><span class="header-section-number">8.9</span> Tuning</a>
  <ul class="collapse">
<li><a href="#tuning-auszeichnen" id="toc-tuning-auszeichnen" class="nav-link" data-scroll-target="#tuning-auszeichnen"><span class="header-section-number">8.9.1</span> Tuning auszeichnen</a></li>
  <li><a href="#grid-search-vs.-iterative-search" id="toc-grid-search-vs.-iterative-search" class="nav-link" data-scroll-target="#grid-search-vs.-iterative-search"><span class="header-section-number">8.9.2</span> Grid Search vs.&nbsp;Iterative Search</a></li>
  </ul>
</li>
  <li>
<a href="#tuning-mit-tidymodels" id="toc-tuning-mit-tidymodels" class="nav-link" data-scroll-target="#tuning-mit-tidymodels"><span class="header-section-number">8.10</span> Tuning mit Tidymodels</a>
  <ul class="collapse">
<li><a href="#datenabh%C3%A4ngige-tuningparameter" id="toc-datenabhÃ¤ngige-tuningparameter" class="nav-link" data-scroll-target="#datenabh%C3%A4ngige-tuningparameter"><span class="header-section-number">8.10.1</span> DatenabhÃ¤ngige Tuningparameter</a></li>
  <li><a href="#modelle-mit-tuning-berechnen" id="toc-modelle-mit-tuning-berechnen" class="nav-link" data-scroll-target="#modelle-mit-tuning-berechnen"><span class="header-section-number">8.10.2</span> Modelle mit Tuning berechnen</a></li>
  <li><a href="#vorhersage-im-test-sample" id="toc-vorhersage-im-test-sample" class="nav-link" data-scroll-target="#vorhersage-im-test-sample"><span class="header-section-number">8.10.3</span> Vorhersage im Test-Sample</a></li>
  </ul>
</li>
  <li><a href="#aufgaben" id="toc-aufgaben" class="nav-link" data-scroll-target="#aufgaben"><span class="header-section-number">8.11</span> Aufgaben</a></li>
  <li><a href="#vertiefung" id="toc-vertiefung" class="nav-link" data-scroll-target="#vertiefung"><span class="header-section-number">8.12</span> Vertiefung</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Resampling und Tuning</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><section id="lernsteuerung" class="level2" data-number="8.1"><h2 data-number="8.1" class="anchored" data-anchor-id="lernsteuerung">
<span class="header-section-number">8.1</span> Lernsteuerung</h2>
<section id="lernziele" class="level3" data-number="8.1.1"><h3 data-number="8.1.1" class="anchored" data-anchor-id="lernziele">
<span class="header-section-number">8.1.1</span> Lernziele</h3>
<ul>
<li>Sie verstehen den Nutzen von Resampling und Tuning im maschinellen Nutzen.</li>
<li>Sie kÃ¶nnen Methoden des Resampling und Tunings mit Hilfe von Tidymodels anwenden.</li>
</ul></section><section id="vorbereitung" class="level3" data-number="8.1.2"><h3 data-number="8.1.2" class="anchored" data-anchor-id="vorbereitung">
<span class="header-section-number">8.1.2</span> Vorbereitung</h3>
<ul>
<li>Lesen Sie die Literatur.</li>
</ul></section><section id="literatur" class="level3" data-number="8.1.3"><h3 data-number="8.1.3" class="anchored" data-anchor-id="literatur">
<span class="header-section-number">8.1.3</span> Literatur</h3>
<ul>
<li>Rhys, Kap. 3</li>
<li>TMWR, Kap. 10, 12</li>
</ul></section><section id="benÃ¶tigte-r-pakete" class="level3" data-number="8.1.4"><h3 data-number="8.1.4" class="anchored" data-anchor-id="benÃ¶tigte-r-pakete">
<span class="header-section-number">8.1.4</span> BenÃ¶tigte R-Pakete</h3>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/libs-resampling-tuning_7b991e6c2516e8f0a997958e23d5ae2e">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tune.tidymodels.org/">tune</a></span><span class="op">)</span>  <span class="co">#  wird nicht autaomtisch mit tidymodels gestartet</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="Ã¼berblick" class="level2" data-number="8.2"><h2 data-number="8.2" class="anchored" data-anchor-id="Ã¼berblick">
<span class="header-section-number">8.2</span> Ãœberblick</h2>
<p>Der Standardablauf des maschinellen Lernens ist in <a href="#fig-process1">Abbildung&nbsp;<span>8.1</span></a> dargestellt. Eine alternative, hilfreich Abbildung findet sich <a href="https://www.tmwr.org/resampling.html">hier</a> in Kap. 10.2 in <span class="citation" data-cites="silge_tidy_2022">Silge und Kuhn (<a href="references.html#ref-silge_tidy_2022" role="doc-biblioref">2022</a>)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-process1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><div>
<pre class="mermaid mermaid-js" data-label="fig-process1">flowchart TD
   
Gesamtdatensatz --&gt; Split[In Train- und Test aufteilen]
subgraph Fit[FÃ¼r jeden Modellkandidaten i]
  subgraph Kand[Modellkandidat i]
  F[Fitte im Train-S] --&gt; T[Teste im Assessment-S]
  end
end
Split --&gt; Fit
Fit --&gt; Best[Bestimmte besten Kandidaten]
Best --&gt; lastFit[Fitte ihn im ganzen Train-S]
lastFit --&gt; test[Teste im Tes-S]
</pre>
</div>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;8.1: Standardablauf des maschinellen Lernens mit Tuning und Resampling</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section><section id="tidymodels" class="level2" data-number="8.3"><h2 data-number="8.3" class="anchored" data-anchor-id="tidymodels">
<span class="header-section-number">8.3</span> tidymodels</h2>
<section id="datensatz-aufteilen" class="level3" data-number="8.3.1"><h3 data-number="8.3.1" class="anchored" data-anchor-id="datensatz-aufteilen">
<span class="header-section-number">8.3.1</span> Datensatz aufteilen</h3>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/ames-split_a5df97c83b871b3e743eb1c3456bad56">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">ames</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">4595</span><span class="op">)</span></span>
<span><span class="va">data_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">ames</span>, strata <span class="op">=</span> <span class="st">"Sale_Price"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span></span>
<span><span class="va">ames_test</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="rezept-modell-und-workflow-definieren" class="level3" data-number="8.3.2"><h3 data-number="8.3.2" class="anchored" data-anchor-id="rezept-modell-und-workflow-definieren">
<span class="header-section-number">8.3.2</span> Rezept, Modell und Workflow definieren</h3>
<p>In gewohnter Weise definieren wir den Workflow mit einem kNN-Modell.</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/ames-wf_56d506a0044e16443a75ff3baa26c0d7">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_rec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">step_log</span><span class="op">(</span><span class="va">Sale_Price</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">step_other</span><span class="op">(</span><span class="va">Neighborhood</span>, threshold <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">step_dummy</span><span class="op">(</span><span class="fu">all_nominal</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">step_zv</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">knn_model</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">nearest_neighbor</span><span class="op">(</span></span>
<span>    mode <span class="op">=</span> <span class="st">"regression"</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"kknn"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_wflow</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">ames_rec</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">knn_model</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Das kNN-Modell ist noch <em>nicht</em> <em>berechnet</em>, es ist nur ein â€œRezeptâ€ erstellt:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-3_2b67a03ba6eb05a11365727e433c2b1c">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">knn_model</span></span>
<span><span class="co">## K-Nearest Neighbor Model Specification (regression)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Computational engine: kknn</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-4_c96d699304eea6b8e7a6b4d643323350">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_wflow</span></span>
<span><span class="co">## â•â• Workflow â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span>
<span><span class="co">## Preprocessor: Recipe</span></span>
<span><span class="co">## Model: nearest_neighbor()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span>
<span><span class="co">## 4 Recipe Steps</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## â€¢ step_log()</span></span>
<span><span class="co">## â€¢ step_other()</span></span>
<span><span class="co">## â€¢ step_dummy()</span></span>
<span><span class="co">## â€¢ step_zv()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span>
<span><span class="co">## K-Nearest Neighbor Model Specification (regression)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Computational engine: kknn</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="resampling" class="level2" data-number="8.4"><h2 data-number="8.4" class="anchored" data-anchor-id="resampling">
<span class="header-section-number">8.4</span> Resampling</h2>
<p>Vergleichen Sie die drei FÃ¤lle, die sich in der Nutzung von Train- und Test-Sample unterscheiden:</p>
<ol type="1">
<li>Wir fitten ein Klassifikationsmodell in einer Stichprobe, sagen die Y-Werte dieser Stichprobe â€œvorherâ€. Wir finden eine Gesamtgenauigkeit von 80%.</li>
<li>Wir fitten ein Klassifikationsmodell in einem Teil der ursprÃ¼nglichen Stichprobe (Train-Sample) und sagen Y-die Werte im verbleibenden Teil der ursprÃ¼nglichen Stichprobe vorher (Test-Sample). Wir finden eine Gesamtgenauigkeit von 70%.</li>
<li>Wir wiederholen Fall 2 noch drei Mal mit jeweils anderer Zuweisung der FÃ¤lle zum Train- bzw. zum Test-Sample. Wir finden insgesamt folgende Werte an Gesamtgenauigkeit: 70%, 70%, 65%, 75%.</li>
</ol>
<p>Welchen der drei FÃ¤lle finden Sie am sinnvollsten? Warum?</p>
</section><section id="illustration-des-resampling" class="level2" data-number="8.5"><h2 data-number="8.5" class="anchored" data-anchor-id="illustration-des-resampling">
<span class="header-section-number">8.5</span> Illustration des Resampling</h2>
<p><em>Resampling</em> stellt einen Oberbegriff dar; <em>Kreuzvalidierung</em> ist ein Unterbegriff dazu. Es gibt noch andere Arten des Resampling, etwa <em>Bootstrapping</em> oder <em>Leave-One-Out-Cross-Validation</em> (LOOCV).</p>
<p>Im Folgenden ist nur die Kreuzvalidierung dargestellt, da es eines der wichtigsten und vielleicht das Wichtigste ist. In vielen Quellen finden sich ErlÃ¤uterungen anderer Verfahren dargestellt, etwa in <span class="citation" data-cites="silge_tidy_2022">Silge und Kuhn (<a href="references.html#ref-silge_tidy_2022" role="doc-biblioref">2022</a>)</span>, <span class="citation" data-cites="islr">James u.&nbsp;a. (<a href="references.html#ref-islr" role="doc-biblioref">2021</a>)</span> oder <span class="citation" data-cites="rhys">Rhys (<a href="references.html#ref-rhys" role="doc-biblioref">2020</a>)</span>.</p>
<section id="einfache-v-fache-kreuzvalidierung" class="level3" data-number="8.5.1"><h3 data-number="8.5.1" class="anchored" data-anchor-id="einfache-v-fache-kreuzvalidierung">
<span class="header-section-number">8.5.1</span> Einfache v-fache Kreuzvalidierung</h3>
<p><a href="#fig-resampling">Abbildung&nbsp;<span>8.2</span></a> illustriert die zufÃ¤llige Aufteilung von <span class="math inline">\(n=10\)</span> FÃ¤llen der Originalstrichprobe auf eine Train- bzw. Test-Stichpobe. Man spricht von <em>Kreuzvalidierung</em> (cross validation, CV).</p>
<p>In diesem Fall wurden 70% der (<span class="math inline">\(n=10\)</span>) FÃ¤lle der Train-Stichprobe zugewiesen (der Rest der Test-Stichprobe); ein willkÃ¼rlicher, aber nicht unÃ¼blicher Anteil. Diese Aufteilung wurde <span class="math inline">\(v=3\)</span> Mal vorgenommen, es resultieren drei â€œResampling-Stichprobenâ€, die manchmal auch als â€œFaltungenâ€ bezeichnet werden.</p>
<div class="cell" data-messagen="false" data-hash="080-Resampling-Tuning_cache/html/fig-resampling_1b39eb81b6c542698cd170d9cfb81257">
<div class="cell-output-display">
<div id="fig-resampling" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="080-Resampling-Tuning_files/figure-html/fig-resampling-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;8.2: Resampling: Eine Stichprobe wird mehrfach (hier 3 Mal) zu 70% in ein Train- und zu 30% in die Test-Stichprobe aufgeteilt</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><span class="citation" data-cites="modar">Sauer (<a href="references.html#ref-modar" role="doc-biblioref">2019</a>)</span> stellt das Resampling so dar (S. 259), s. <a href="#fig-cvmodar">Abbildung&nbsp;<span>8.3</span></a>.</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/fig-cvmodar_d53146a97b478773a81f015de9ef1f19">
<div class="cell-output-display">
<div id="fig-cvmodar" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="img/crossval.png" class="img-fluid figure-img" width="861"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;8.3: Kreuzvalidierung, Aufteilung in Train- vs.&nbsp;Testsample</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Der Gesamtfehler der Vorhersage wird als Mittelwerte der Vorhersagefehler in den einzelnen Faltungen berechnet.</p>
<p>Warum ist die Vorhersage besser, wenn man mehrere Faltungen, mehrere SchÃ¤tzungen fÃ¼r <span class="math inline">\(y\)</span> also, vornimmt?</p>
<p>Der Grund ist das Gesetz der groÃŸen Zahl, nachdem sich eine SchÃ¤tzung in Mittelwert und VariabilitÃ¤t stabilisiert mit steigendem Stichprobenumfang, dem wahren Mittelwert also prÃ¤ziser schÃ¤tzt. Bei Normalverteilungen klappt das gut, bei randlastigen Verteilungen leider nicht mehr <span class="citation" data-cites="fattails">(<a href="references.html#ref-fattails" role="doc-biblioref">Taleb 2019</a>)</span>.</p>
<p>HÃ¤ufig werden <span class="math inline">\(v=10\)</span> Faltungen verwendet, was sich empirisch als guter Kompromiss von Rechenaufwand und Fehlerreduktion herausgestellt hat.</p>
</section><section id="wiederholte-kreuzvalidierung" class="level3" data-number="8.5.2"><h3 data-number="8.5.2" class="anchored" data-anchor-id="wiederholte-kreuzvalidierung">
<span class="header-section-number">8.5.2</span> Wiederholte Kreuzvalidierung</h3>
<p>Die <span class="math inline">\(r\)</span>-fach wiederholte Kreuzvalidierung wiederholte die einfache Kreuzvalidierung mehrfach (nÃ¤mlich <span class="math inline">\(r=4\)</span> mal), <span class="citation" data-cites="modar">Sauer (<a href="references.html#ref-modar" role="doc-biblioref">2019</a>)</span> stellt das Resampling so dar (S. 259), s. <a href="#fig-cvrep">Abbildung&nbsp;<span>8.4</span></a>.</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/fig-cvrep_c9fae0c3bbdfc82690b35729aae4bf33">
<div class="cell-output-display">
<div id="fig-cvrep" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="img/crossval_repeated.png" class="img-fluid figure-img" width="916"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;8.4: Wiederholte Kreuzvalidierung</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Die wiederholte Kreuzvalidierung reduziert den Standardfehler der Vorhersagen.</p>
<p><span class="citation" data-cites="silge_tidy_2022">Silge und Kuhn (<a href="references.html#ref-silge_tidy_2022" role="doc-biblioref">2022</a>)</span> zeigen die Verringerung des SchÃ¤tzfehlers als Funktion der <span class="math inline">\(r\)</span> Wiederholungen dar, s. <a href="#fig-repcvred">Abbildung&nbsp;<span>8.5</span></a>.</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/fig-repcvred_0dc4a9002cf6d8b9edec77e8711509b8">
<div class="cell-output-display">
<div id="fig-repcvred" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="https://www.tmwr.org/figures/variance-reduction-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;8.5: Reduktion des SchÃ¤tzfehlers als Funktion der r Wiederhoulugen der Kreuzvalidierung</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Warum ist die Wiederholung der Kreuzvalidierung nÃ¼tzlich?</p>
<p>Die Kreuvalidierung liefert einen SchÃ¤tzwert der Modellparameter, die wahren Modellparameter werden also anhand einer Stichprobe von <span class="math inline">\(n=1\)</span> geschÃ¤tzt. Mit hÃ¶herem Stichprobenumfang kann diese SchÃ¤tzung natÃ¼rlich prÃ¤zisiert werden.</p>
<p>Da jede Stichprobenverteilung bei <span class="math inline">\(n \rightarrow \infty\)</span> normalverteilt ist - ein zentrales Theorem der Statistik, der <em>Zentrale Grenzwertsatz</em> (Central Limit Theorem) - kann man hoffen, dass sich eine bestimmte Stichprobenverteilung bei kleinerem <span class="math inline">\(n\)</span> ebenfalls annÃ¤hernd normalverteilt<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Dann sind die Quantile bekannt und man kann die Streuung der SchÃ¤tzers, <span class="math inline">\({\sigma }_{\bar {x}}\)</span>, z.B. fÃ¼r den Mittelwert, einfach schÃ¤tzen:</p>
<p><span class="math display">\[{\displaystyle {\sigma }_{\bar {x}}\ ={\frac {\sigma }{\sqrt {n}}}}\]</span></p>
</section><section id="resampling-passiert-im-train-sample" class="level3" data-number="8.5.3"><h3 data-number="8.5.3" class="anchored" data-anchor-id="resampling-passiert-im-train-sample">
<span class="header-section-number">8.5.3</span> Resampling passiert im Train-Sample</h3>
<p>Wichtig zu beachten ist, dass die Resampling nur im Train-Sample stattfindet. Das Test-Sample bleibt unangerÃ¼hrt. Dieser Sachverhalt ist in <a href="#fig-initialsplit">Abbildung&nbsp;<span>8.6</span></a>, aus <span class="citation" data-cites="silge_tidy_2022">Silge und Kuhn (<a href="references.html#ref-silge_tidy_2022" role="doc-biblioref">2022</a>)</span>, illustriert.</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/fig-initialsplit_d96efecaf6968b46dcb18c5445ede02d">
<div class="cell-output-display">
<div id="fig-initialsplit" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="https://www.tmwr.org/premade/resampling.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;8.6: Resampling im Train-, nicht im Test-Sample</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Wie in <a href="#fig-initialsplit">Abbildung&nbsp;<span>8.6</span></a> dargestellt, wird das Modell im <em>Analyse-Sample</em> berechnet (gefittet), und im <em>Assessment-Sample</em> auf ModellgÃ¼te hin Ã¼berprÃ¼ft.</p>
<p>Die letztliche ModellgÃ¼te ist dann die Zusammenfassung (Mittelwert) der einzelnen Resamples.</p>
</section><section id="andere-illustrationen" class="level3" data-number="8.5.4"><h3 data-number="8.5.4" class="anchored" data-anchor-id="andere-illustrationen">
<span class="header-section-number">8.5.4</span> Andere Illustrationen</h3>
<p>Es gibt eine Reihe vergleichbarer Illustrationen in anderen BÃ¼chern:</p>
<ul>
<li><a href="https://datasciencebook.ca/img/cv.png">Timbers, Campbell &amp; Lee, 2022, Kap. 6</a></li>
<li><a href="https://datasciencebook.ca/img/cv.png">Silge &amp; Kuhn, 2022, 10.1</a></li>
<li><a href="https://www.tmwr.org/premade/three-CV.svg">Silge &amp; Kuhn, 2022, 10.2</a></li>
<li><a href="https://www.tmwr.org/premade/three-CV-iter.svg">Silge &amp; Kuhn, 2022, 10.3</a></li>
<li>James, Witten, hastie &amp; Tishirani, 2021, 5.3</li>
</ul></section></section><section id="gesetz-der-groÃŸen-zahl" class="level2" data-number="8.6"><h2 data-number="8.6" class="anchored" data-anchor-id="gesetz-der-groÃŸen-zahl">
<span class="header-section-number">8.6</span> Gesetz der groÃŸen Zahl</h2>
<p>Nach dem <em>Gesetz der groÃŸen Zahl</em> (Law of Large Numbers) sollte sich der Mittelwert einer groÃŸen Stichprobe dem theoretischen Mittelwert der zugrundeliegenden Verteilung (Population, datengeneriender Prozess) sehr nahe kommen.</p>
<p><span class="math display">\[\displaystyle \lim _{n\to \infty }\sum _{i=1}^{n}{\frac {X_{i}}{n}}={\overline {X}}\]</span></p>
<p>David Salazar visualisiert das folgendermaÃŸen in <a href="https://david-salazar.github.io/2020/04/17/fat-vs-thin-does-lln-work/">diesem Post</a> seines lesenswerten <a href="https://david-salazar.github.io/">Blogs</a>, s. <a href="#fig-lln">Abbildung&nbsp;<span>8.7</span></a>).</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/fig-lln_116dd9cc6960879ce9c7b09f1f28276d">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># source: https://david-salazar.github.io/2020/04/17/fat-vs-thin-does-lln-work/</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="va">thin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">samples</span>, sd <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cumulative_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">numbers</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">numbers</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">cum_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">numbers</span><span class="op">)</span><span class="op">/</span><span class="va">x</span> </span>
<span>    <span class="va">cum_mean</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">thin_cum_mean</span> <span class="op">&lt;-</span> <span class="fu">cumulative_mean</span><span class="op">(</span><span class="va">thin</span><span class="op">)</span></span>
<span></span>
<span><span class="va">thin_cum_mean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>running_mean <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/add_rownames.html">add_rownames</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">'number_samples'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>number_samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="va">number_samples</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">number_samples</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">number_samples</span>, y <span class="op">=</span> <span class="va">running_mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'dodgerblue4'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">hrbrthemes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/hrbrthemes/man/theme_ipsum_rc.html">theme_ipsum_rc</a></span><span class="op">(</span>grid <span class="op">=</span> <span class="st">'Y'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/comma.html">comma</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"StichprobengrÃ¶ÃŸe"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Gesetz der groÃŸen Zahl"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Kumulierter Mittelwert aus einer Normalverteilung mit sd=20"</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-lln" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="080-Resampling-Tuning_files/figure-html/fig-lln-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;8.7: Gesetz der groÃŸen Zahl</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Wie man sieht, nÃ¤hert sich der empirische Mittelwert (also in der Stichprobe) immer mehr dem theoretischen Mittelwert, 0, an.</p>
<p>Achtung: Bei randlastigen Verteilungen darf man dieses schÃ¶ne, wohlerzogene Verhalten nicht erwarten <span class="citation" data-cites="fattails">(<a href="references.html#ref-fattails" role="doc-biblioref">Taleb 2019</a>)</span>.</p>
</section><section id="Ã¼ber--und-unteranpassung-an-einem-beispiel" class="level2" data-number="8.7"><h2 data-number="8.7" class="anchored" data-anchor-id="Ã¼ber--und-unteranpassung-an-einem-beispiel">
<span class="header-section-number">8.7</span> Ãœber- und Unteranpassung an einem Beispiel</h2>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/fig-overfitting-4-plots_53adb86192f1fc826682da08dd250bda">
<div class="cell-output-display">
<div id="fig-overfitting-4-plots" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="080-Resampling-Tuning_files/figure-html/fig-overfitting-4-plots-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;8.8: Welches Modell (Teile C-E) passt am besten zu den Daten (Teil B)? Die â€˜wahre Funktionâ€™, der datengenerierende Prozess ist im Teil A dargestellt</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><a href="#fig-overfitting-4-plots">Abbildung&nbsp;<span>8.8</span></a> zeigt:</p>
<ul>
<li>Teil <em>A</em>: Die â€˜wahre Funktionâ€™, <span class="math inline">\(f\)</span>, die die Daten erzeugt. Man spricht auch von der â€œdatengenerierenden Funktionâ€. Wir gehen gemeinhin davon aus, dass es eine wahre Funktion gibt. Das heiÃŸt nicht, dass die wahre Funktion die Daten perfekt erklÃ¤rt, schlieÃŸlich kann die Funktion zwar wahr, aber unvollstÃ¤ndig sein oder unsere Messinstrumente sind nicht perfekt prÃ¤zise.</li>
<li>Teil <em>B:</em> Die Daten, erzeugt aus A plus etwas zufÃ¤lliges Fehler (Rauschen).</li>
<li>Teil <em>C</em>: Ein zu einfaches Modell: Unteranpassung. Vorhersagen in einer neuen Stichprobe (basierend auf dem datengenerierenden Prozess aus A) werden nicht so gut sein.</li>
<li>Teil <em>D</em>: Ein zu komplexes Modell: Ãœberanpassung. Vorhersagen in einer neuen Stichprobe (basierend auf dem datengenerierenden Prozess aus A) werden nicht so gut sein.</li>
<li>Teil <em>E</em>: Ein Modell mittlerer KomplexitÃ¤t. Keine Ãœberanpassung, keine Unteranpassung. Vorhersagen in einer neuen Stichprobe (basierend auf dem datengenerierenden Prozess aus A) werden gut sein.</li>
</ul></section><section id="cv-in-tidymodels" class="level2" data-number="8.8"><h2 data-number="8.8" class="anchored" data-anchor-id="cv-in-tidymodels">
<span class="header-section-number">8.8</span> CV in tidymodels</h2>
<section id="cv-definieren" class="level3" data-number="8.8.1"><h3 data-number="8.8.1" class="anchored" data-anchor-id="cv-definieren">
<span class="header-section-number">8.8.1</span> CV definieren</h3>
<p>So kann man eine <em>einfache</em> v-fache Kreuzvalidierung in Tidymodels auszeichnen:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-7_5c2a1082a16dc57d6ac1a33ef6c1df56">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2453</span><span class="op">)</span></span>
<span><span class="va">ames_folds</span> <span class="op">&lt;-</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="va">ames_train</span>, strata <span class="op">=</span> <span class="st">"Sale_Price"</span><span class="op">)</span></span>
<span><span class="va">ames_folds</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["splits"],"name":[1],"type":["list"],"align":["right"]},{"label":["id"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"<S3: vfold_split>","2":"Fold01"},{"1":"<S3: vfold_split>","2":"Fold02"},{"1":"<S3: vfold_split>","2":"Fold03"},{"1":"<S3: vfold_split>","2":"Fold04"},{"1":"<S3: vfold_split>","2":"Fold05"},{"1":"<S3: vfold_split>","2":"Fold06"},{"1":"<S3: vfold_split>","2":"Fold07"},{"1":"<S3: vfold_split>","2":"Fold08"},{"1":"<S3: vfold_split>","2":"Fold09"},{"1":"<S3: vfold_split>","2":"Fold10"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Werfen wir einen Blick in die Spalte <code>splits</code>, erste Zeile:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-8_3e749cb21cbd332b9a45673bd0fe5346">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_folds</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">## &lt;Analysis/Assess/Total&gt;</span></span>
<span><span class="co">## &lt;1976/221/2197&gt;</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>MÃ¶chte man die Defaults vpn <code>vfold_cv</code> wissen, schaut man in der Hilfe nach: <code>?vfold_cv</code>:</p>
<p><code>vfold_cv(data, v = 10, repeats = 1, strata = NULL, breaks = 4, pool = 0.1, ...)</code></p>
<p>Probieren wir <span class="math inline">\(v=5\)</span> und <span class="math inline">\(r=2\)</span>:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-9_a6fcf0bf92ed704d36c181d6ec980a4b">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_folds_rep</span> <span class="op">&lt;-</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="va">ames_train</span>, </span>
<span>                           strata <span class="op">=</span> <span class="st">"Sale_Price"</span>, </span>
<span>                           v <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                           repeats <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">ames_folds_rep</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["splits"],"name":[1],"type":["list"],"align":["right"]},{"label":["id"],"name":[2],"type":["chr"],"align":["left"]},{"label":["id2"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"<S3: vfold_split>","2":"Repeat1","3":"Fold1"},{"1":"<S3: vfold_split>","2":"Repeat1","3":"Fold2"},{"1":"<S3: vfold_split>","2":"Repeat1","3":"Fold3"},{"1":"<S3: vfold_split>","2":"Repeat1","3":"Fold4"},{"1":"<S3: vfold_split>","2":"Repeat1","3":"Fold5"},{"1":"<S3: vfold_split>","2":"Repeat2","3":"Fold1"},{"1":"<S3: vfold_split>","2":"Repeat2","3":"Fold2"},{"1":"<S3: vfold_split>","2":"Repeat2","3":"Fold3"},{"1":"<S3: vfold_split>","2":"Repeat2","3":"Fold4"},{"1":"<S3: vfold_split>","2":"Repeat2","3":"Fold5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="resamples-fitten" class="level3" data-number="8.8.2"><h3 data-number="8.8.2" class="anchored" data-anchor-id="resamples-fitten">
<span class="header-section-number">8.8.2</span> Resamples fitten</h3>
<p>Hat unser Computer mehrere Rechenkerne, dann kÃ¶nnen wir diese nutzen und die Berechnungen beschleunigen. Im Standard wird sonst nur ein Kern verwendet.</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-10_85e675fcf613092f61b3a4d96ba5b1fd">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mycores</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span>logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">mycores</span></span>
<span><span class="co">## [1] 4</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Auf Unix/MacOC-Systemen kann man dann die Anzahl der parallen Kerne so einstellen<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-11_c2c4e07673b264acc17b271561b444e5">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">doMC</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/doMC/man/registerDoMC.html">registerDoMC</a></span><span class="op">(</span>cores <span class="op">=</span> <span class="va">mycores</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So, und jetzt fitten wir die Resamples und trachten die ModellgÃ¼te in den Resamples:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-12_375c3442c36475423e6645dc36aa43cc">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_resamples_fit</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">ames_wflow</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tune.tidymodels.org/reference/fit_resamples.html">fit_resamples</a></span><span class="op">(</span><span class="va">ames_folds</span><span class="op">)</span></span>
<span></span>
<span> <span class="va">ames_resamples_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tune.tidymodels.org/reference/collect_predictions.html">collect_metrics</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":["mean"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[4],"type":["int"],"align":["right"]},{"label":["std_err"],"name":[5],"type":["dbl"],"align":["right"]},{"label":[".config"],"name":[6],"type":["chr"],"align":["left"]}],"data":[{"1":"rmse","2":"standard","3":"0.09281732","4":"10","5":"0.001871143","6":"Preprocessor1_Model1"},{"1":"rsq","2":"standard","3":"0.72161155","4":"10","5":"0.008644440","6":"Preprocessor1_Model1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>NatÃ¼rlich interessiert uns primÃ¤r die ModellgÃ¼te im Test-Sample:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-13_844070c735242fce0cd72cb9519558b9">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">final_ames</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tune.tidymodels.org/reference/last_fit.html">last_fit</a></span><span class="op">(</span><span class="va">ames_wflow</span>, <span class="va">data_split</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-14_cf7e101883238c44c455330b4c85dbfe">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">final_ames</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tune.tidymodels.org/reference/collect_predictions.html">collect_metrics</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":[".config"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"rmse","2":"standard","3":"0.1029721","4":"Preprocessor1_Model1"},{"1":"rsq","2":"standard","3":"0.6783940","4":"Preprocessor1_Model1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section></section><section id="tuning" class="level2" data-number="8.9"><h2 data-number="8.9" class="anchored" data-anchor-id="tuning">
<span class="header-section-number">8.9</span> Tuning</h2>
<section id="tuning-auszeichnen" class="level3" data-number="8.9.1"><h3 data-number="8.9.1" class="anchored" data-anchor-id="tuning-auszeichnen">
<span class="header-section-number">8.9.1</span> Tuning auszeichnen</h3>
<p>In der Modellspezifikation des Modells kÃ¶nnen wir mit <code><a href="https://hardhat.tidymodels.org/reference/tune.html">tune()</a></code> auszeichnen, welche Parameter wir tunen mÃ¶chten. Wir kÃ¶nenn</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-15_5b87132ddfd7d60ad06c35e9be2722b8">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">knn_model</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">nearest_neighbor</span><span class="op">(</span></span>
<span>    mode <span class="op">=</span> <span class="st">"regression"</span>,</span>
<span>    neighbors <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"kknn"</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wir kÃ¶nnen dem Tuningparameter auch einen Namen (ID/Laben) geben, z.B. â€œKâ€:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-16_507372555fb1c7c46a5eacca77711a04">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">knn_model</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">nearest_neighbor</span><span class="op">(</span></span>
<span>    mode <span class="op">=</span> <span class="st">"regression"</span>,</span>
<span>    neighbors <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html">tune</a></span><span class="op">(</span><span class="st">"K"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"kknn"</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="grid-search-vs.-iterative-search" class="level3" data-number="8.9.2"><h3 data-number="8.9.2" class="anchored" data-anchor-id="grid-search-vs.-iterative-search">
<span class="header-section-number">8.9.2</span> Grid Search vs.&nbsp;Iterative Search</h3>
<p>Im K-NÃ¤chste-Nachbarn-Modell ist der vorhergesagt Wert, <span class="math inline">\(\hat{y}\)</span> fÃ¼r eine neue Beobachtung <span class="math inline">\(x_0\)</span> wie folgt definiert:</p>
<p><span class="math display">\[
\hat y = \frac{1}{K}\sum_{\ell = 1}^K x_\ell^*,
\]</span></p>
<p>wobei <span class="math inline">\(K\)</span> die Anzahl der zu berÃ¼cksichtigen nÃ¤chsten Nachbarn darstellt und <span class="math inline">\(x_\ell^*\)</span> die Werte dieser berÃ¼cksichtiggten Nachbarn.</p>
<p>Die Wahl von <span class="math inline">\(K\)</span> hat einen gewaltigen Einfluss auf die Vorhersagen und damit auf die VorhersagegÃ¼te. Allerdings wird <span class="math inline">\(K\)</span> nicht vom Modell geschÃ¤tzt. Es liegt an den Nutzi, diesen Wert zu wÃ¤hlen.</p>
<p>Parameter dieser Art (die von den Nutzi zu bestimmen sind, nicht vom Algorithmus), nennt man <em>Tuningparameter</em>.</p>
<p>Abbildung <a href="#fig-nnoverfit">Abbildung&nbsp;<span>8.9</span></a> aus <span class="citation" data-cites="silge_tidy_2022">Silge und Kuhn (<a href="references.html#ref-silge_tidy_2022" role="doc-biblioref">2022</a>)</span> stellt exemplarisch dar, welchen groÃŸen Einfluss die Wahl des Werts eines Tuningparameters auf die Vorhersagen eines Modells haben.</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/fig-nnoverfit_183c3e636ebe31bad469328b9aa8f9b7">
<div class="cell-output-display">
<div id="fig-nnoverfit" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="https://www.tmwr.org/figures/two-class-boundaries-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;8.9: Overfitting als Funktion der Modellparameter und insofern als Problem de Wahl der Tuningparameter</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Aber wie wÃ¤hlt man â€œguteâ€ Werte der Tuningparater? Zwei AnsÃ¤tze, grob gesprochen, bieten sich an.</p>
<ol type="1">
<li><p><em>Grid Search:</em> Probiere viele Werte aus und schaue, welcher der beste ist. Dabei musst du hoffen, dass du die Werte erwischt, die nicht nur im Train-, sondern auch im Test-Sample gut funktionieren werden.</p></li>
<li><p><em>Iterative Search:</em> Wenn du einen Wert eines Tuningparameters hast, nutze diesen, um intelligenter einen neuen Wert eines Tuningparameters zu finden.</p></li>
</ol>
<p>Der Unterschied beider AnsÃ¤tze ist in <span class="citation" data-cites="silge_tidy_2022">Silge und Kuhn (<a href="references.html#ref-silge_tidy_2022" role="doc-biblioref">2022</a>)</span> wie in <a href="#fig-tuning1">Abbildung&nbsp;<span>8.10</span></a> dargestellt.</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/fig-tuning1_f8dc718950a2926ec7554abf9ab3d59b">
<div class="cell-output-display">
<div id="fig-tuning1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="https://www.tmwr.org/figures/tuning-strategies-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;8.10: Links: Grid Search. Rechts: Iterative Search2</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>In <code>tidymodels</code> kann man mit <code><a href="https://hardhat.tidymodels.org/reference/tune.html">tune()</a></code> angeben, dass man einen bestimmten Parameter tunen mÃ¶chte. <code>tidymodels</code> fÃ¼hrt das dann ohne weiteres Federlesens fÃ¼r uns durch.</p>
</section></section><section id="tuning-mit-tidymodels" class="level2" data-number="8.10"><h2 data-number="8.10" class="anchored" data-anchor-id="tuning-mit-tidymodels">
<span class="header-section-number">8.10</span> Tuning mit Tidymodels</h2>
<section id="tuningparameter-betrachten" class="level4" data-number="8.10.0.1"><h4 data-number="8.10.0.1" class="anchored" data-anchor-id="tuningparameter-betrachten">
<span class="header-section-number">8.10.0.1</span> Tuningparameter betrachten</h4>
<p>MÃ¶chte man wissen, welche und wie viele Tuningparameter tidymodels in einem Modell berÃ¼cksichtigt, kann man <code><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html">extract_parameter_set_dials()</a></code> aufrufen:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-17_ef485a84e22048c6fbbf48327ae57f2c">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html">extract_parameter_set_dials</a></span><span class="op">(</span><span class="va">knn_model</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["id"],"name":[2],"type":["chr"],"align":["left"]},{"label":["source"],"name":[3],"type":["chr"],"align":["left"]},{"label":["component"],"name":[4],"type":["chr"],"align":["left"]},{"label":["component_id"],"name":[5],"type":["chr"],"align":["left"]},{"label":["object"],"name":[6],"type":["list"],"align":["right"]}],"data":[{"1":"neighbors","2":"K","3":"model_spec","4":"nearest_neighbor","5":"main","6":"<S3: quant_param>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Die Ausgabe informiert uns, dass es nur einen Tuningparameter gibt in diesem Modell und dass der Name (Label, ID) des Tuningparameters â€œKâ€ ist. AuÃŸerdem sollen die Anzahl der Nachbarn getunt werden. Der Tuningparameter ist numerisch; das sieht man an <code>nparam[+]</code>.</p>
<p>Schauen wir uns mal an, auf welchen Wertebereich <code>tidymodels</code> den Parameter <span class="math inline">\(K\)</span> begrenzt hat:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-18_857e726b6f4e7d2612a85a7e0e23fc73">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">knn_model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">extract_parameter_dials</span><span class="op">(</span><span class="st">"K"</span><span class="op">)</span></span>
<span><span class="co">## # Nearest Neighbors (quantitative)</span></span>
<span><span class="co">## Range: [1, 15]</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Aktualisieren wir mal unseren Workflow entsprechend:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-19_4b2185091c6d35066b7d13457053c332">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_wflow</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ames_wflow</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">update_model</span><span class="op">(</span><span class="va">knn_model</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wir kÃ¶nnen auch Einfluss nehmen und angeben, dass die Grenzen des Wertebereichs zwischen 1 und 50 liegen soll (fÃ¼r den Tuningparameter <code>neighbors</code>):</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/ames-update_eb8cab012a3569ca6e1f908a48bcf0bb">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_set</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html">extract_parameter_set_dials</a></span><span class="op">(</span><span class="va">ames_wflow</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span>K <span class="op">=</span> <span class="fu">neighbors</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_set</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["id"],"name":[2],"type":["chr"],"align":["left"]},{"label":["source"],"name":[3],"type":["chr"],"align":["left"]},{"label":["component"],"name":[4],"type":["chr"],"align":["left"]},{"label":["component_id"],"name":[5],"type":["chr"],"align":["left"]},{"label":["object"],"name":[6],"type":["list"],"align":["right"]}],"data":[{"1":"neighbors","2":"K","3":"model_spec","4":"nearest_neighbor","5":"main","6":"<S3: quant_param>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="datenabhÃ¤ngige-tuningparameter" class="level3" data-number="8.10.1"><h3 data-number="8.10.1" class="anchored" data-anchor-id="datenabhÃ¤ngige-tuningparameter">
<span class="header-section-number">8.10.1</span> DatenabhÃ¤ngige Tuningparameter</h3>
<p>Manche Tuningparameter kann man nur bestimmen, wenn man den Datensatz kennt. So ist die Anzahl der PrÃ¤diktoren, <code>mtry</code> in einem Random-Forest-Modell sinnvollerweise als Funktion der PrÃ¤diktorenzahl zu wÃ¤hlen. Der Workflow kennt aber den Datensatz nicht. Daher muss der Workflow noch â€œfinalisiertâ€ oder â€œaktualisiertâ€ werden, um den Wertebereich (Unter- und Obergrenze) eines Tuningparameters zu bestimmen.</p>
<p>Wenn wir im Rezept aber z.B. die Anzahl der PrÃ¤diktoren verÃ¤ndert haben, mÃ¶chten wir die Grenzen des Wertebereichs fÃ¼r <code>mtry</code> (oder andere Tuningparameter) vielleicht nicht hÃ¤ndisch, â€œhartverdrahtetâ€ selber bestimmen, sondern lieber den Computer anweisen, und sinngemÃ¤ÃŸ sagen: â€œWarte mal mit der Bestimmung der Werte der Tuningparameter, bis du den Datensatz bzw. dessen Dimensionen kennst. Merk dir, dass du, wenn du den Datensatz kennst, die Werte des Tuningparameter noch Ã¤ndern musst. Und tu das dann auch.â€ Dazu spÃ¤ter mehr.</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/ames-finalize_61bfb67be588c6eb66920c01377e8d8a">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_set</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">knn_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">ames_rec</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html">extract_parameter_set_dials</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">finalize</span><span class="op">(</span><span class="va">ames_train</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="modelle-mit-tuning-berechnen" class="level3" data-number="8.10.2"><h3 data-number="8.10.2" class="anchored" data-anchor-id="modelle-mit-tuning-berechnen">
<span class="header-section-number">8.10.2</span> Modelle mit Tuning berechnen</h3>
<p>Nachdem wir die Tuningwerte bestimmt haben, kÃ¶nnen wir jetzt das Modell berechnen: FÃ¼r jeden Wert des Tuningparameters wird ein Modell berechnet:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/ames-tune-grid_8241badcbf6002f022ad28ec3e461f20">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_grid_search</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tune.tidymodels.org/reference/tune_grid.html">tune_grid</a></span><span class="op">(</span></span>
<span>    <span class="va">ames_wflow</span>,</span>
<span>    resamples <span class="op">=</span> <span class="va">ames_folds</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">ames_grid_search</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["splits"],"name":[1],"type":["list"],"align":["right"]},{"label":["id"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".metrics"],"name":[3],"type":["list"],"align":["right"]},{"label":[".notes"],"name":[4],"type":["list"],"align":["right"]}],"data":[{"1":"<S3: vfold_split>","2":"Fold01","3":"<tibble[,5]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold02","3":"<tibble[,5]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold03","3":"<tibble[,5]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold04","3":"<tibble[,5]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold05","3":"<tibble[,5]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold06","3":"<tibble[,5]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold07","3":"<tibble[,5]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold08","3":"<tibble[,5]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold09","3":"<tibble[,5]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold10","3":"<tibble[,5]>","4":"<tibble[,3]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Im Default berechnet <code>tiymodels</code> 10 Kandidatenmodelle.</p>
<p>Die Spalte <code>.metrics</code> beinhaltet die ModellgÃ¼te fÃ¼r jedes Kandidatenmodell.</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-20_75ef926c582d59916c6ce940fb97e474">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_grid_search</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tune.tidymodels.org/reference/collect_predictions.html">collect_metrics</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["K"],"name":[1],"type":["int"],"align":["right"]},{"label":[".metric"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[3],"type":["chr"],"align":["left"]},{"label":["mean"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[5],"type":["int"],"align":["right"]},{"label":["std_err"],"name":[6],"type":["dbl"],"align":["right"]},{"label":[".config"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"2","2":"rmse","3":"standard","4":"0.10349535","5":"10","6":"0.002127888","7":"Preprocessor1_Model1"},{"1":"2","2":"rsq","3":"standard","4":"0.66158238","5":"10","6":"0.011179503","7":"Preprocessor1_Model1"},{"1":"4","2":"rmse","3":"standard","4":"0.09501120","5":"10","6":"0.001881864","7":"Preprocessor1_Model2"},{"1":"4","2":"rsq","3":"standard","4":"0.70841461","5":"10","6":"0.009163055","7":"Preprocessor1_Model2"},{"1":"6","2":"rmse","3":"standard","4":"0.09120649","5":"10","6":"0.001889243","7":"Preprocessor1_Model3"},{"1":"6","2":"rsq","3":"standard","4":"0.73187950","5":"10","6":"0.008416866","7":"Preprocessor1_Model3"},{"1":"7","2":"rmse","3":"standard","4":"0.08999211","5":"10","6":"0.001917548","7":"Preprocessor1_Model4"},{"1":"7","2":"rsq","3":"standard","4":"0.74006777","5":"10","6":"0.008293791","7":"Preprocessor1_Model4"},{"1":"9","2":"rmse","3":"standard","4":"0.08830447","5":"10","6":"0.002005757","7":"Preprocessor1_Model5"},{"1":"9","2":"rsq","3":"standard","4":"0.75232427","5":"10","6":"0.008270258","7":"Preprocessor1_Model5"},{"1":"11","2":"rmse","3":"standard","4":"0.08721929","5":"10","6":"0.002107469","7":"Preprocessor1_Model6"},{"1":"11","2":"rsq","3":"standard","4":"0.76098086","5":"10","6":"0.008451436","7":"Preprocessor1_Model6"},{"1":"13","2":"rmse","3":"standard","4":"0.08650671","5":"10","6":"0.002168429","7":"Preprocessor1_Model7"},{"1":"13","2":"rsq","3":"standard","4":"0.76732938","5":"10","6":"0.008484678","7":"Preprocessor1_Model7"},{"1":"15","2":"rmse","3":"standard","4":"0.08606349","5":"10","6":"0.002208369","7":"Preprocessor1_Model8"},{"1":"15","2":"rsq","3":"standard","4":"0.77201730","5":"10","6":"0.008497265","7":"Preprocessor1_Model8"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Das kÃ¶nnen wir uns einfach visualisieren lassen:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-21_ea3a0fad71379e98a40de14c09bac30d">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">ames_grid_search</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="080-Resampling-Tuning_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Auf Basis dieser Ergebnisse kÃ¶nnte es Sinn machen, noch grÃ¶ÃŸere Werte fÃ¼r <span class="math inline">\(K\)</span> zu Ã¼berprÃ¼fen.</p>
</section><section id="vorhersage-im-test-sample" class="level3" data-number="8.10.3"><h3 data-number="8.10.3" class="anchored" data-anchor-id="vorhersage-im-test-sample">
<span class="header-section-number">8.10.3</span> Vorhersage im Test-Sample</h3>
<p>Welches Modellkandidat war jetzt am besten?</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-22_c39767e38e0c16a8ad9a116918d8f11e">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tune.tidymodels.org/reference/show_best.html">show_best</a></span><span class="op">(</span><span class="va">ames_grid_search</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["K"],"name":[1],"type":["int"],"align":["right"]},{"label":[".metric"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[3],"type":["chr"],"align":["left"]},{"label":["mean"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[5],"type":["int"],"align":["right"]},{"label":["std_err"],"name":[6],"type":["dbl"],"align":["right"]},{"label":[".config"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"15","2":"rmse","3":"standard","4":"0.08606349","5":"10","6":"0.002208369","7":"Preprocessor1_Model8"},{"1":"13","2":"rmse","3":"standard","4":"0.08650671","5":"10","6":"0.002168429","7":"Preprocessor1_Model7"},{"1":"11","2":"rmse","3":"standard","4":"0.08721929","5":"10","6":"0.002107469","7":"Preprocessor1_Model6"},{"1":"9","2":"rmse","3":"standard","4":"0.08830447","5":"10","6":"0.002005757","7":"Preprocessor1_Model5"},{"1":"7","2":"rmse","3":"standard","4":"0.08999211","5":"10","6":"0.001917548","7":"Preprocessor1_Model4"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>WÃ¤hlen wir jetzt mal das beste Modell aus (im Sinne des Optimierungskriteriusms):</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-23_4feb34694c00cc666c4621aac376c7f8">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tune.tidymodels.org/reference/show_best.html">select_best</a></span><span class="op">(</span><span class="va">ames_grid_search</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["K"],"name":[1],"type":["int"],"align":["right"]},{"label":[".config"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"15","2":"Preprocessor1_Model8"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Ok, notieren wir uns die Kombination der Tuningparameterwerte im besten Kandiatenmodell. In diesem Fall hat das Modull nur einen Tuningparameter:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-24_d3889a3692d6f13d9f7276273abea0f5">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_knn_best_params</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>K <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unser Workflow weiÃŸ noch nicht, welche Tuningparameterwerte am besten sind:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-25_b182804b71ffc4fdde5e4f576959b788">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_wflow</span></span>
<span><span class="co">## â•â• Workflow â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span>
<span><span class="co">## Preprocessor: Recipe</span></span>
<span><span class="co">## Model: nearest_neighbor()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span>
<span><span class="co">## 4 Recipe Steps</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## â€¢ step_log()</span></span>
<span><span class="co">## â€¢ step_other()</span></span>
<span><span class="co">## â€¢ step_dummy()</span></span>
<span><span class="co">## â€¢ step_zv()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span>
<span><span class="co">## K-Nearest Neighbor Model Specification (regression)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Main Arguments:</span></span>
<span><span class="co">##   neighbors = tune("K")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Computational engine: kknn</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>neighbors = tune("K")</code> sagt uns, dass er diesen Parameter tunen will. Das haben wir jetzt ja erledigt. Wir wollen fÃ¼r das Test-Sample nur noch einen Wert, eben aus dem besten Kandidatenmodell, verwenden:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/ames-finalize-wf_f24636e56e4743e9863fbc45faed70c4">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_final_wflow</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ames_wflow</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tune.tidymodels.org/reference/finalize_model.html">finalize_workflow</a></span><span class="op">(</span><span class="va">ames_knn_best_params</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_final_wflow</span></span>
<span><span class="co">## â•â• Workflow â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span>
<span><span class="co">## Preprocessor: Recipe</span></span>
<span><span class="co">## Model: nearest_neighbor()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span>
<span><span class="co">## 4 Recipe Steps</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## â€¢ step_log()</span></span>
<span><span class="co">## â€¢ step_other()</span></span>
<span><span class="co">## â€¢ step_dummy()</span></span>
<span><span class="co">## â€¢ step_zv()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span>
<span><span class="co">## K-Nearest Neighbor Model Specification (regression)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Main Arguments:</span></span>
<span><span class="co">##   neighbors = 15</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Computational engine: kknn</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wie man sieht, steht im Workflow nichts mehr von Tuningparameter.</p>
<p>Wir kÃ¶nnen jetzt das <em>ganze Train-Sample</em> fitten, also das Modell auf das ganze Train-Sample anwenden - nicht nur auf ein Analysis-Sample. Und mit den dann resultierenden Modellkoeffizienten sagen wir das TestSample vorher:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/ames-last-fit_de86425d4b82a92d256c87cc03ae1007">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">final_ames_knn_fit</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tune.tidymodels.org/reference/last_fit.html">last_fit</a></span><span class="op">(</span><span class="va">ames_final_wflow</span>, <span class="va">data_split</span><span class="op">)</span></span>
<span></span>
<span><span class="va">final_ames_knn_fit</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["splits"],"name":[1],"type":["list"],"align":["right"]},{"label":["id"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".metrics"],"name":[3],"type":["list"],"align":["right"]},{"label":[".notes"],"name":[4],"type":["list"],"align":["right"]},{"label":[".predictions"],"name":[5],"type":["list"],"align":["right"]},{"label":[".workflow"],"name":[6],"type":["list"],"align":["right"]}],"data":[{"1":"<S3: initial_split>","2":"train/test split","3":"<tibble[,4]>","4":"<tibble[,3]>","5":"<tibble[,4]>","6":"<S3: workflow>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Holen wir uns die ModellgÃ¼te:</p>
<div class="cell" data-hash="080-Resampling-Tuning_cache/html/unnamed-chunk-26_f23fd97add67d3412762cc1ac61bba9d">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tune.tidymodels.org/reference/collect_predictions.html">collect_metrics</a></span><span class="op">(</span><span class="va">final_ames_knn_fit</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":[".config"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"rmse","2":"standard","3":"0.0951007","4":"Preprocessor1_Model1"},{"1":"rsq","2":"standard","3":"0.7356398","4":"Preprocessor1_Model1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<!-- ### Vorhersage von Hand -->
<!-- NatÃ¼rlich kÃ¶nnten wir auch "von Hand" vorhersagen: -->
<!-- ```{r ames-fit-von-hand} -->
<!-- final_ames_knn_fit <- -->
<!--   ames_final_wflow %>%  -->
<!--   fit(ames_train) -->
<!-- ``` -->
<!-- Man beachte, -->
<!-- dass die VorhersagegÃ¼te fÃ¼r das Train-Sample Ã¼beroptimistisch ist. -->
<!-- Und jetzt sagen wir auf dieser Basis das Test-Sample vorher: -->
<!-- ```{r error = TRUE} -->
<!-- ames_pred <- -->
<!--   predict(final_ames_knn_fit, new_data = ames_test) -->
<!-- ``` -->
<!-- Oh Nein! Es geht nicht, woran liegt das wohl? -->
<!-- Wir mÃ¼ssen noch die Transformationen des Rezept auf das Test-Sample anwenden.  -->
<!-- Puh, ganz schÃ¶n unkomfortabel. -->
<!-- Es ist nicht empfehlenswert, den folgenden Weg einzuschlagen, -->
<!-- viel einfacher ist es, mit `last_fit()` seine Ergebnisse zu bekommen. -->
<!-- Aber sei's drum, jetzt ziehen wir das halt mal durch. -->
<!-- Zuerst berechnen wir die Werte des *Rezepts*, z.B. -->
<!-- die MW- und SD-Werte fÃ¼r z-Transformationen oder die Anzahl -->
<!-- der PrÃ¤diktoren im Datensatz. -->
<!-- ```{r ames-prep} -->
<!-- ames_prep <- -->
<!--   prep(ames_rec, training = ames_train) -->
<!-- ames_prep -->
<!-- ``` -->
<!-- Mit `prep()` haben wir *nur* das Rezept berechnet, -->
<!-- noch kein Modell auf einen Datensatz gefittet! -->
<!-- Alternativ kÃ¶nnten wir uns das trainierte Rezept auch so holen: -->
<!-- ```{r} -->
<!-- extract_recipe(final_ames_knn_fit) -->
<!-- ``` -->
<!-- Jetzt wenden wir das Rezept auf den Test-Datensatz an: -->
<!-- ```{r ames-bake} -->
<!-- ames_test_baked <-  -->
<!--   bake(ames_prep, new_data = ames_test) -->
<!-- ``` -->
<!-- Das Ergebnis ist jetzt der "gebackene" Datensatz `ames_test_baked`, -->
<!-- in dem jetzt die Transformationen des Test-Samples angewendet sind. -->
<!-- Damit kÃ¶nnen wir jetzt die Vorhersagen im Test-Sample durchfÃ¼hren. -->
<!-- ```{r ames-pred-final-von-hand, error = TRUE} -->
<!-- ames_pred <- -->
<!--   predict(final_ames_knn_fit, new_data = ames_test) -->
<!-- ``` -->
<!-- Und damit haben wir unsere ModellgÃ¼te fÃ¼r das Test-Sample. -->
</section></section><section id="aufgaben" class="level2" data-number="8.11"><h2 data-number="8.11" class="anchored" data-anchor-id="aufgaben">
<span class="header-section-number">8.11</span> Aufgaben</h2>
<ul>
<li>Arbeiten Sie sich so gut als mÃ¶glich durch <a href="https://github.com/sebastiansauer/covid-icu">diese Analyse zum Verlauf von Covid-FÃ¤llen</a>
</li>
<li><a href="https://onezero.blog/modelling-binary-logistic-regression-using-tidymodels-library-in-r-part-1/">Fallstudie zur Modellierung einer logististischen Regression mit tidymodels</a></li>
<li><a href="https://juliasilge.com/blog/multinomial-volcano-eruptions/">Fallstudie zu VulkanausbrÃ¼chen</a></li>
<li><a href="https://juliasilge.com/blog/himalayan-climbing/">Fallstudie Himalaya</a></li>
</ul></section><section id="vertiefung" class="level2" data-number="8.12"><h2 data-number="8.12" class="anchored" data-anchor-id="vertiefung">
<span class="header-section-number">8.12</span> Vertiefung</h2>
<p><a href="https://xkcd.com/435/">Fields arranged by purity, xkcd 435</a></p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-islr" class="csl-entry" role="listitem">
James, Gareth, Daniela Witten, Trevor Hastie, und Robert Tibshirani. 2021. <em>An introduction to statistical learning: with applications in R</em>. Second edition. Springer texts in statistics. New York: Springer. <a href="https://link.springer.com/book/10.1007/978-1-0716-1418-1">https://link.springer.com/book/10.1007/978-1-0716-1418-1</a>.
</div>
<div id="ref-rhys" class="csl-entry" role="listitem">
Rhys, Hefin. 2020. <em>Machine Learning with R, the tidyverse, and mlr</em>. Shelter Island, <span>NY</span>: Manning publications.
</div>
<div id="ref-modar" class="csl-entry" role="listitem">
Sauer, Sebastian. 2019. <em>Moderne Datenanalyse mit R: Daten einlesen, aufbereiten, visualisieren und modellieren</em>. 1. Auflage 2019. <span>FOM</span>-Edition. Wiesbaden: Springer. <a href="https://www.springer.com/de/book/9783658215866">https://www.springer.com/de/book/9783658215866</a>.
</div>
<div id="ref-silge_tidy_2022" class="csl-entry" role="listitem">
Silge, Julia, und Max Kuhn. 2022. <em>Tidy <span>Modeling</span> with <span>R</span></em>. <a href="https://www.tmwr.org/">https://www.tmwr.org/</a>.
</div>
<div id="ref-fattails" class="csl-entry" role="listitem">
Taleb, Nassim Nicholas. 2019. <em>The statistical consequences of fat tails, papers and commentaries</em>. Monograph. <a href="https://nassimtaleb.org/2020/01/final-version-fat-tails/">https://nassimtaleb.org/2020/01/final-version-fat-tails/</a>.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Das klappt bei randlastigen Verteilungen nicht<a href="#fnref1" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn2"><p>In Windows gibt es andere Wege.<a href="#fnref2" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./070-knn.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">kNN</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./090-glm.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Logistische Regression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>