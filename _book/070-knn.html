<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.247">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Grundlagen der Prognosemodellierung üîÆüß∞ - 7&nbsp; kNN</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./080-Resampling-Tuning.html" rel="next">
<link href="./060-tidymodels.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Keine Treffer",
    "search-matching-documents-text": "Treffer",
    "search-copy-link-title": "Link in die Suche kopieren",
    "search-hide-matches-text": "Zus√§tzliche Treffer verbergen",
    "search-more-match-text": "weitere Treffer in diesem Dokument",
    "search-more-matches-text": "weitere Treffer in diesem Dokument",
    "search-clear-button-title": "Zur√ºcksetzen",
    "search-detached-cancel-button-title": "Abbrechen",
    "search-submit-button-title": "Abschicken"
  }
}</script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./070-knn.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">kNN</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Suchen" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Grundlagen der Prognosemodellierung üîÆüß∞</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Dunkelmodus umschalten"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Suchen"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Zu diesem Buch</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010-Hinweise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Hinweise</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./030-Pruefung.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Pr√ºfung</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./040-Statistisches-Lernen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Statistisches Lernen</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./050-R-Vertiefung.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">R, zweiter Blick</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./060-tidymodels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">tidymodels</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./070-knn.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">kNN</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./080-Resampling-Tuning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Resampling und Tuning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./090-glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Logistische Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./100-baeume.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Entscheidungsb√§ume</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./110-ensemble.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Ensemble Lerner</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./120-regularisierte-modelle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Regularisierte Modelle</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./125-feature-engineeering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Feature Engineering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./130-kaggle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Kaggle</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./140-faden.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Der rote Faden</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./150-fallstudien.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Fallstudien</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./160-e.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Staunen mit e</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Inhaltsverzeichnis</h2>
   
  <ul>
<li>
<a href="#lernsteuerung" id="toc-lernsteuerung" class="nav-link active" data-scroll-target="#lernsteuerung"><span class="header-section-number">7.1</span> Lernsteuerung</a>
  <ul class="collapse">
<li><a href="#%C3%BCberblick" id="toc-√ºberblick" class="nav-link" data-scroll-target="#%C3%BCberblick"><span class="header-section-number">7.1.1</span> √úberblick</a></li>
  <li><a href="#lernziele" id="toc-lernziele" class="nav-link" data-scroll-target="#lernziele"><span class="header-section-number">7.1.2</span> Lernziele</a></li>
  <li><a href="#literatur" id="toc-literatur" class="nav-link" data-scroll-target="#literatur"><span class="header-section-number">7.1.3</span> Literatur</a></li>
  </ul>
</li>
  <li><a href="#ben%C3%B6tigte-r-pakete" id="toc-ben√∂tigte-r-pakete" class="nav-link" data-scroll-target="#ben%C3%B6tigte-r-pakete"><span class="header-section-number">7.2</span> Ben√∂tigte R-Pakete</a></li>
  <li><a href="#intuitive-erkl%C3%A4rung" id="toc-intuitive-erkl√§rung" class="nav-link" data-scroll-target="#intuitive-erkl%C3%A4rung"><span class="header-section-number">7.3</span> Intuitive Erkl√§rung</a></li>
  <li><a href="#krebsdiagnostik-1" id="toc-krebsdiagnostik-1" class="nav-link" data-scroll-target="#krebsdiagnostik-1"><span class="header-section-number">7.4</span> Krebsdiagnostik 1</a></li>
  <li><a href="#berechnung-der-n%C3%A4he" id="toc-berechnung-der-n√§he" class="nav-link" data-scroll-target="#berechnung-der-n%C3%A4he"><span class="header-section-number">7.5</span> Berechnung der N√§he</a></li>
  <li>
<a href="#knn-mit-tidymodels" id="toc-knn-mit-tidymodels" class="nav-link" data-scroll-target="#knn-mit-tidymodels"><span class="header-section-number">7.6</span> kNN mit Tidymodels</a>
  <ul class="collapse">
<li><a href="#analog-zu-timbers-et-al." id="toc-analog-zu-timbers-et-al." class="nav-link" data-scroll-target="#analog-zu-timbers-et-al."><span class="header-section-number">7.6.1</span> Analog zu Timbers et al.</a></li>
  <li><a href="#rezept-definieren" id="toc-rezept-definieren" class="nav-link" data-scroll-target="#rezept-definieren"><span class="header-section-number">7.6.2</span> Rezept definieren</a></li>
  <li><a href="#modell-definieren" id="toc-modell-definieren" class="nav-link" data-scroll-target="#modell-definieren"><span class="header-section-number">7.6.3</span> Modell definieren</a></li>
  <li><a href="#workflow-definieren-und-fitten" id="toc-workflow-definieren-und-fitten" class="nav-link" data-scroll-target="#workflow-definieren-und-fitten"><span class="header-section-number">7.6.4</span> Workflow definieren und fitten</a></li>
  <li><a href="#vorhersagen" id="toc-vorhersagen" class="nav-link" data-scroll-target="#vorhersagen"><span class="header-section-number">7.6.5</span> Vorhersagen</a></li>
  </ul>
</li>
  <li>
<a href="#krebsdiagnostik-2" id="toc-krebsdiagnostik-2" class="nav-link" data-scroll-target="#krebsdiagnostik-2"><span class="header-section-number">7.7</span> Krebsdiagnostik 2</a>
  <ul class="collapse">
<li><a href="#rezept-definieren-1" id="toc-rezept-definieren-1" class="nav-link" data-scroll-target="#rezept-definieren-1"><span class="header-section-number">7.7.1</span> Rezept definieren</a></li>
  <li><a href="#modell-definieren-1" id="toc-modell-definieren-1" class="nav-link" data-scroll-target="#modell-definieren-1"><span class="header-section-number">7.7.2</span> Modell definieren</a></li>
  <li><a href="#workflow-definieren" id="toc-workflow-definieren" class="nav-link" data-scroll-target="#workflow-definieren"><span class="header-section-number">7.7.3</span> Workflow definieren</a></li>
  <li><a href="#vorhersagen-1" id="toc-vorhersagen-1" class="nav-link" data-scroll-target="#vorhersagen-1"><span class="header-section-number">7.7.4</span> Vorhersagen</a></li>
  <li><a href="#modellg%C3%BCte" id="toc-modellg√ºte" class="nav-link" data-scroll-target="#modellg%C3%BCte"><span class="header-section-number">7.7.5</span> Modellg√ºte</a></li>
  <li><a href="#schwellenwerte" id="toc-schwellenwerte" class="nav-link" data-scroll-target="#schwellenwerte"><span class="header-section-number">7.7.6</span> Schwellenwerte</a></li>
  <li><a href="#visualisierung" id="toc-visualisierung" class="nav-link" data-scroll-target="#visualisierung"><span class="header-section-number">7.7.7</span> Visualisierung</a></li>
  </ul>
</li>
  <li>
<a href="#klassifikationsg%C3%BCte" id="toc-klassifikationsg√ºte" class="nav-link" data-scroll-target="#klassifikationsg%C3%BCte"><span class="header-section-number">7.8</span> Klassifikationsg√ºte</a>
  <ul class="collapse">
<li><a href="#die-vier-m%C3%B6glichen-ergebnisse-eines-tests" id="toc-die-vier-m√∂glichen-ergebnisse-eines-tests" class="nav-link" data-scroll-target="#die-vier-m%C3%B6glichen-ergebnisse-eines-tests"><span class="header-section-number">7.8.1</span> Die vier m√∂glichen Ergebnisse eines Tests</a></li>
  <li><a href="#kennzahlen-der-klassfikation" id="toc-kennzahlen-der-klassfikation" class="nav-link" data-scroll-target="#kennzahlen-der-klassfikation"><span class="header-section-number">7.8.2</span> Kennzahlen der Klassfikation</a></li>
  <li><a href="#schwellenwerte-der-klassifiktion" id="toc-schwellenwerte-der-klassifiktion" class="nav-link" data-scroll-target="#schwellenwerte-der-klassifiktion"><span class="header-section-number">7.8.3</span> Schwellenwerte der Klassifiktion</a></li>
  <li><a href="#roc-kurve" id="toc-roc-kurve" class="nav-link" data-scroll-target="#roc-kurve"><span class="header-section-number">7.8.4</span> ROC-Kurve</a></li>
  <li><a href="#krebstest-beispiel" id="toc-krebstest-beispiel" class="nav-link" data-scroll-target="#krebstest-beispiel"><span class="header-section-number">7.8.5</span> Krebstest-Beispiel</a></li>
  </ul>
</li>
  <li><a href="#knn-als-regression" id="toc-knn-als-regression" class="nav-link" data-scroll-target="#knn-als-regression"><span class="header-section-number">7.9</span> kNN als Regression</a></li>
  <li><a href="#aufgaben" id="toc-aufgaben" class="nav-link" data-scroll-target="#aufgaben"><span class="header-section-number">7.10</span> Aufgaben</a></li>
  <li><a href="#fazit" id="toc-fazit" class="nav-link" data-scroll-target="#fazit"><span class="header-section-number">7.11</span> Fazit</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">7</span>&nbsp; <span class="chapter-title">kNN</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><section id="lernsteuerung" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="lernsteuerung">
<span class="header-section-number">7.1</span> Lernsteuerung</h2>
<section id="√ºberblick" class="level3" data-number="7.1.1"><h3 data-number="7.1.1" class="anchored" data-anchor-id="√ºberblick">
<span class="header-section-number">7.1.1</span> √úberblick</h3>
<p>In diesem Kapitel geht es um das Verfahren <em>KNN</em>, <em>K-N√§chste-Nachbarn</em> (<span class="math inline">\(k\)</span> nearest neighbors).</p>
</section><section id="lernziele" class="level3" data-number="7.1.2"><h3 data-number="7.1.2" class="anchored" data-anchor-id="lernziele">
<span class="header-section-number">7.1.2</span> Lernziele</h3>
<ul>
<li>Sie sind in der Lage, einfache Klassifikationsmodelle zu spezifizieren mit tidymodels</li>
<li>Sie k√∂nnen den knn-Algorithmus erl√§utern</li>
<li>Sie k√∂nnen den knn-Algorithmus in tidymodels anwenden</li>
<li>Sie k√∂nnen die G√ºtemetriken von Klassifikationsmodellen einsch√§tzen</li>
</ul></section><section id="literatur" class="level3" data-number="7.1.3"><h3 data-number="7.1.3" class="anchored" data-anchor-id="literatur">
<span class="header-section-number">7.1.3</span> Literatur</h3>
<ul>
<li>Rhys, Kap. 3</li>
<li><a href="https://datasciencebook.ca/classification.html#classification">Timbers et al., Kap. 5</a></li>
</ul></section></section><section id="ben√∂tigte-r-pakete" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="ben√∂tigte-r-pakete">
<span class="header-section-number">7.2</span> Ben√∂tigte R-Pakete</h2>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-1_43b57f6c3f9d9fee6de0866dc8310308">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="intuitive-erkl√§rung" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="intuitive-erkl√§rung">
<span class="header-section-number">7.3</span> Intuitive Erkl√§rung</h2>
<p><em>K-N√§chste-Nachbarn</em> (<span class="math inline">\(k\)</span> nearest neighbors, kNN) ist ein einfacher Algorithmus des maschinellen Lernens, der sowohl f√ºr Klassifikation als auch f√ºr numerische Vorhersage (Regression) genutzt werden kann. Wir werden kNN als Beispiel f√ºr eine Klassifikation betrachten.</p>
<p>Betrachen wir ein einf√ºhrendes Beispiel von <span class="citation" data-cites="rhys">Rhys (<a href="references.html#ref-rhys" role="doc-biblioref">2020</a>)</span>, f√ºr das es eine <a href="https://livebook.manning.com/book/machine-learning-for-mortals-mere-and-otherwise/chapter-3/22">Online-Quelle</a> gibt. Stellen Sie sich vor, wir laufen durch englische Landschaft, vielleicht die Grafschaft Kent, und sehen ein kleines Tier durch das Gras huschen. Eine Schlange?! In England gibt es (laut <span class="citation" data-cites="rhys">Rhys (<a href="references.html#ref-rhys" role="doc-biblioref">2020</a>)</span>) nur eine giftige Schlange, die Otter (Adder). Eine andere Schlange, die <em>Grass Snake</em> ist nicht giftig, und dann kommt noch der <em>Slow Worm</em> in Frage, der gar nicht zur Familie der Schlangen geh√∂rt. Prim√§r interessiert uns die Frage, haben wir jetzt eine Otter gesehen? Oder was f√ºr ein Tier war es?</p>
<p>Zum Gl√ºck wissen wir einiges √ºber Schlangen bzw. schlangen√§hnliche Tiere Englands. N√§mlich k√∂nnen wir die betreffenden Tierarten in Gr√∂√üe und Aggressivit√§t einsch√§tzen, das ist in Abbildung <a href="#fig-slang">Abbildung&nbsp;<span>7.1</span></a> dargestellt.</p>
<div class="cell" data-hash="070-knn_cache/html/fig-slang_f50eb9f651424a6e91117818cf31678c">
<div class="cell-output-display">
<div id="fig-slang" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="img/rhys-fig3-2.jpeg" class="img-fluid figure-img" width="216"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;7.1: Haben wir gerade eine Otter gesehen?</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Der Algorithmus von kNN sieht einfach gesagt vor, dass wir schauen, welcher Tierarten Tiere mit √§hnlicher Aggressivit√§t und Gr√∂√üe angeh√∂ren. Die Tierart die bei diesen ‚ÄúNachbarn‚Äù hinsichtlich √Ñhnlichkeit relevanter Merkmale am h√§ufigsten vertreten ist, ordnen wir die bisher unklassifizierte Beobachtung zu.</p>
<p>Etwas zugespitzt:</p>
<blockquote class="blockquote">
<p>Wenn es quakt wie eine Ente ü¶Ü, l√§uft wie eine Ente ü¶Üund aussieht wie eine Ente ü¶Ü, dann ist es eine Ente ü¶Ü.</p>
</blockquote>
<p>Die Anzahl <span class="math inline">\(k\)</span> der n√§chsten Nachbarn k√∂nnen wir frei w√§hlen; der Wert wird <em>nicht</em> vom Algorithmuss bestimmt. Solche vom Nutzi zu bestimmenden Gr√∂√üen nennt man auch <em>Tuningparameter</em>.</p>
</section><section id="krebsdiagnostik-1" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="krebsdiagnostik-1">
<span class="header-section-number">7.4</span> Krebsdiagnostik 1</h2>
<p>Betrachten wir ein Beispiel von <span class="citation" data-cites="timbers_data_2022">Timbers, Campbell, und Lee (<a href="references.html#ref-timbers_data_2022" role="doc-biblioref">2022</a>)</span>, das <a href="https://datasciencebook.ca/classification.html#classification-with-k-nearest-neighbors">hier</a> frei eingesehen werden kann.</p>
<p>Die Daten sind so zu beziehen:</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-3_76ee1fb8dc8a07ecbc31fe57ecc471ea">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_url</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/UBC-DSCI/introduction-to-datascience/master/data/wdbc.csv"</span></span>
<span><span class="va">cancer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="va">data_url</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In diesem Beispiel versuchen wir Tumore der Brust zu klassifizieren, ob sie einen schweren Verlauf (maligne, engl. malignant) oder einen weniger schweren Verlauf (benigne, engl. benign) erwarten lassen. Der Datensatz ist <a href="https://datasciencebook.ca/classification.html#describing-the-variables-in-the-cancer-data-set">hier</a> n√§her erl√§utert.</p>
<p>Wie in <a href="#fig-cancer1">Abbildung&nbsp;<span>7.2</span></a> ersichtlich, steht eine Tumordiagnose (malignant vs.&nbsp;benign) in Abh√§ngigkeit von Umfang (engl. perimeter) und <a href="https://de.wikipedia.org/wiki/Konvexe_und_konkave_Funktionen">Konkavit√§t</a>, die ‚ÄúGekr√ºmmtheit nach innen‚Äù.</p>
<div class="cell" data-hash="070-knn_cache/html/fig-cancer1_dee115976d16a486ff13b53305f580f0">
<div class="cell-output-display">
<div id="fig-cancer1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="070-knn_files/figure-html/fig-cancer1-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;7.2: Streudiagramm zur Einsch√§tzung von Tumordiagnosen</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>In diesem Code-Beispiel wird die seit R 4.1.0 verf√ºgbare R-native Pfeife verwendet. Wichtig ist vielleicht vor allem, dass diese Funktion nicht l√§uft auf R-Versionen vor 4.1.0. Einige Unterschiede zur seit l√§ngerem bekannten Magrittr-Pfeife sind <a href="https://stackoverflow.com/questions/67633022/what-are-the-differences-between-rs-new-native-pipe-and-the-magrittr-pipe">hier</a> erl√§utert.</p>
<p>Wichtig ist, dass die Merkmale standardisiert sind, also eine identische Skalierung aufweisen, da sonst das Merkmal mit kleinerer Skala weniger in die Berechnung der N√§he (bzw. Abstand) eingeht.</p>
<p>F√ºr einen neuen, bisher unklassifizierten Fall suchen nur nun nach einer Diagnose, also nach der am besten passenden Diagnose (maligne oder benigne), s. <a href="#fig-cancer2">Abbildung&nbsp;<span>7.3</span></a>, wieder aus <span class="citation" data-cites="timbers_data_2022">Timbers, Campbell, und Lee (<a href="references.html#ref-timbers_data_2022" role="doc-biblioref">2022</a>)</span>. Ihr Quellcode f√ºr dieses Diagramm (und das ganze Kapitel) findet sich <a href="https://github.com/UBC-DSCI/introduction-to-datascience/blob/master/classification1.Rmd">hier</a>.</p>
<div class="cell" data-hash="070-knn_cache/html/fig-cancer2_eb5da99c71f99f1f4f1eb5c6f0f75f58">
<div class="cell-output-display">
<div id="fig-cancer2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="070-knn_files/figure-html/fig-cancer2-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;7.3: Ein neuer Fall, bisher unklassifiziert</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Wir k√∂nnen zun√§chst den (im euklidischen Koordinatensystem) n√§chst gelegenen Fall (der ‚Äún√§chste Nachbar‚Äù) betrachten, und vereinbaren, dass wir dessen Klasse als Sch√§tzwert f√ºr den unklassiffizierten Fall √ºbernehmen, s. <a href="#fig-cancer3">Abbildung&nbsp;<span>7.4</span></a>.</p>
<div id="fig-cancer3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="img/cancer3.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;7.4: Ein n√§chster Nachbar</figcaption><p></p>
</figure>
</div>
<p>Betrachten wir einen anderen zu klassifizierenden Fall, s. <a href="#fig-cancer4">Abbildung&nbsp;<span>7.5</span></a>. Ob hier die Klassifikation von ‚Äúbenign‚Äù korrekt ist? Wom√∂glich nicht, denn viele andere Nachbarn, die etwas weiter weg gelegen sind, geh√∂ren zur anderen Diagnose, malign.</p>
<div class="cell" data-hash="070-knn_cache/html/fig-cancer4_44726798c67171e8dcadecb6e5364356">
<div class="cell-output-display">
<div id="fig-cancer4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="https://datasciencebook.ca/_main_files/figure-html/05-knn-4-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;7.5: Tr√ºgt der n√§chste Nachbar?</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Um die Vorhersage zu verbessern, k√∂nnen wir nicht nur den n√§chstgelegenen Nachbarn betrachten, sondern die <span class="math inline">\(k\)</span> n√§chstgelegenen, z.B. <span class="math inline">\(k=3\)</span>, s. Abb <a href="#fig-cancer5">Abbildung&nbsp;<span>7.6</span></a>.</p>
<div class="cell" data-hash="070-knn_cache/html/fig-cancer5_df1f029b9ef6ba903c1204b9b3be2d55">
<div class="cell-output-display">
<div id="fig-cancer5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="https://datasciencebook.ca/_main_files/figure-html/05-knn-5-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;7.6: kNN mit k=3</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Die Entscheidungsregel ist dann einfach eine Mehrheitsentscheidung: Wir klassifizieren den neuen Fall entsprechend der Mehrheit in den <span class="math inline">\(k\)</span> n√§chst gelegenen Nachbarn.</p>
</section><section id="berechnung-der-n√§he" class="level2" data-number="7.5"><h2 data-number="7.5" class="anchored" data-anchor-id="berechnung-der-n√§he">
<span class="header-section-number">7.5</span> Berechnung der N√§he</h2>
<p>Es gibt verschiedenen Algorithmen, um die N√§he bzw. Distanz der Nachbarn zum zu klassifizieren Fall zu berechnen.</p>
<p>Eine gebr√§uchliche Methode ist der <em>euklidische</em> Abstand, der mit Pythagoras berechnet werden kann, s. <a href="#fig-pyth1">Abbildung&nbsp;<span>7.7</span></a> aus <span class="citation" data-cites="modar">Sauer (<a href="references.html#ref-modar" role="doc-biblioref">2019</a>)</span>.</p>
<div class="cell" data-hash="070-knn_cache/html/fig-pyth1_2014ade9aebcbe9e5f03fa2a93af1d94">
<div class="cell-output-display">
<div id="fig-pyth1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="img/distanz_crop.png" class="img-fluid figure-img" width="391"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;7.7: Euklidischer Abstand wird mit der Regel von Pythagoras berechnet</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Wie war das noch mal?</p>
<p><span class="math display">\[c^2 = a^2 + b^2\]</span></p>
<p>Im Beispiel oben also:</p>
<p><span class="math inline">\(c^2 = 3^2 + 4^2 = 5^2\)</span></p>
<p>Damit gilt: <span class="math inline">\(c = \sqrt{c^2} = \sqrt{5^2}=5\)</span>.</p>
<p>Im 2D-Raum ist das so einfach, dass man das (fast) mit blo√üem Augenschein entscheiden kann. In mehr als 2 Dimensionen wird es aber schwierig f√ºr das Auge, wie ein <a href="https://datasciencebook.ca/classification1.html#more-than-two-explanatory-variables">Beispiel</a> aus <span class="citation" data-cites="timbers_data_2022">Timbers, Campbell, und Lee (<a href="references.html#ref-timbers_data_2022" role="doc-biblioref">2022</a>)</span> zeigt.</p>
<p>Allerdings kann man den guten alten Pythagoras auch auf Dreiecke mit mehr als zwei Dimensionen anwenden, s. <a href="#fig-pyth2">Abbildung&nbsp;<span>7.8</span></a> aus <span class="citation" data-cites="modar">Sauer (<a href="references.html#ref-modar" role="doc-biblioref">2019</a>)</span>, Kap. 21.1.2.</p>
<div id="fig-pyth2" class="quarto-layout-panel">
<figure class="figure"><div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-pyth2a" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="img/pythagoras-crop.png" class="img-fluid figure-img" data-ref-parent="fig-pyth2"></p>
<p></p><figcaption class="figure-caption">(a) Pythagoras mit mehr als zwei Dimensionen</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-pyth2b" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="img/pythagoras2-crop.png" class="img-fluid figure-img" data-ref-parent="fig-pyth2"></p>
<p></p><figcaption class="figure-caption">(b) Pythagoras mit mehr als zwei Dimensionen</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;7.8: Pythagoras in der Ebene (links) und in 3D (rechts)</figcaption><p></p>
</figure>
</div>
<p>Bleiben wir beim Beispiel von Anna und Berta und nehmen wir eine dritte Variable hinzu (Statistikliebe). Sagen wir, der Unterschied in dieser dritten Variable zwischen Anna und Berta betrage 2.</p>
<p>Es gilt:</p>
<p><span class="math display">\[
\begin{aligned}
e^2 &amp;= c^2 + d^2 \\
e^2 &amp;= 5^2 + 2^2 \\
e^2 &amp;= 25 + 4\\
e &amp;= \sqrt{29} \approx 5.4
\end{aligned}
\]</span></p>
</section><section id="knn-mit-tidymodels" class="level2" data-number="7.6"><h2 data-number="7.6" class="anchored" data-anchor-id="knn-mit-tidymodels">
<span class="header-section-number">7.6</span> kNN mit Tidymodels</h2>
<section id="analog-zu-timbers-et-al." class="level3" data-number="7.6.1"><h3 data-number="7.6.1" class="anchored" data-anchor-id="analog-zu-timbers-et-al.">
<span class="header-section-number">7.6.1</span> Analog zu Timbers et al.</h3>
<p>Eine Anwendung von kNN mit Tidymodels ist in <span class="citation" data-cites="timbers_data_2022">Timbers, Campbell, und Lee (<a href="references.html#ref-timbers_data_2022" role="doc-biblioref">2022</a>)</span>, Kap. 5.6, <a href="https://datasciencebook.ca/classification.html#k-nearest-neighbors-with-tidymodels">hier</a> beschrieben.</p>
<p>Die Daten aus <span class="citation" data-cites="timbers_data_2022">Timbers, Campbell, und Lee (<a href="references.html#ref-timbers_data_2022" role="doc-biblioref">2022</a>)</span> finden sich <a href="https://github.com/UBC-DSCI/introduction-to-datascience/tree/master/data">in diesem Github-Repo</a>-</p>
<p>Die (z-transformierten) Daten zur Tumorklassifikation k√∂nnen <a href="https://raw.githubusercontent.com/UBC-DSCI/data-science-a-first-intro-worksheets/main/worksheet_classification1/data/clean-wdbc-data.csv">hier</a> bezogen werden.</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-5_a9c8405ea94f131ac00afa09370e9168">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_url</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/UBC-DSCI/introduction-to-datascience/master/data/wdbc.csv"</span></span>
<span><span class="va">cancer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">data_url</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="citation" data-cites="timbers_data_2022">Timbers, Campbell, und Lee (<a href="references.html#ref-timbers_data_2022" role="doc-biblioref">2022</a>)</span> verwenden in Kap. 5 auch noch nicht standardisierte Daten, <code>unscales_wdbc.csv</code>, die <a href="https://raw.githubusercontent.com/UBC-DSCI/introduction-to-datascience/master/data/unscaled_wdbc.csv">hier</a> als CSV-Datei heruntergeladen werden k√∂nnen.</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-6_ae4da127360c477c58b18fb76487671e">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cancer_unscales_path</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/UBC-DSCI/introduction-to-datascience/master/data/unscaled_wdbc.csv"</span></span>
<span></span>
<span><span class="va">unscaled_cancer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">cancer_unscales_path</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Class <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="va">Class</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Class</span>, <span class="va">Area</span>, <span class="va">Smoothness</span><span class="op">)</span></span>
<span><span class="va">unscaled_cancer</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Class"],"name":[1],"type":["fct"],"align":["left"]},{"label":["Area"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Smoothness"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"M","2":"1001.0","3":"0.11840"},{"1":"M","2":"1326.0","3":"0.08474"},{"1":"M","2":"1203.0","3":"0.10960"},{"1":"M","2":"386.1","3":"0.14250"},{"1":"M","2":"1297.0","3":"0.10030"},{"1":"M","2":"477.1","3":"0.12780"},{"1":"M","2":"1040.0","3":"0.09463"},{"1":"M","2":"577.9","3":"0.11890"},{"1":"M","2":"519.8","3":"0.12730"},{"1":"M","2":"475.9","3":"0.11860"},{"1":"M","2":"797.8","3":"0.08206"},{"1":"M","2":"781.0","3":"0.09710"},{"1":"M","2":"1123.0","3":"0.09740"},{"1":"M","2":"782.7","3":"0.08401"},{"1":"M","2":"578.3","3":"0.11310"},{"1":"M","2":"658.8","3":"0.11390"},{"1":"M","2":"684.5","3":"0.09867"},{"1":"M","2":"798.8","3":"0.11700"},{"1":"M","2":"1260.0","3":"0.09831"},{"1":"B","2":"566.3","3":"0.09779"},{"1":"B","2":"520.0","3":"0.10750"},{"1":"B","2":"273.9","3":"0.10240"},{"1":"M","2":"704.4","3":"0.10730"},{"1":"M","2":"1404.0","3":"0.09428"},{"1":"M","2":"904.6","3":"0.11210"},{"1":"M","2":"912.7","3":"0.11860"},{"1":"M","2":"644.8","3":"0.10540"},{"1":"M","2":"1094.0","3":"0.09440"},{"1":"M","2":"732.4","3":"0.10820"},{"1":"M","2":"955.1","3":"0.09847"},{"1":"M","2":"1088.0","3":"0.10640"},{"1":"M","2":"440.6","3":"0.11090"},{"1":"M","2":"899.3","3":"0.11970"},{"1":"M","2":"1162.0","3":"0.09401"},{"1":"M","2":"807.2","3":"0.10400"},{"1":"M","2":"869.5","3":"0.09610"},{"1":"M","2":"633.0","3":"0.09823"},{"1":"B","2":"523.8","3":"0.08983"},{"1":"M","2":"698.8","3":"0.09387"},{"1":"M","2":"559.2","3":"0.10160"},{"1":"M","2":"563.0","3":"0.08162"},{"1":"M","2":"371.1","3":"0.12270"},{"1":"M","2":"1104.0","3":"0.09081"},{"1":"M","2":"545.2","3":"0.10410"},{"1":"M","2":"531.5","3":"0.09714"},{"1":"M","2":"1076.0","3":"0.10990"},{"1":"B","2":"201.9","3":"0.08600"},{"1":"M","2":"534.6","3":"0.11580"},{"1":"B","2":"449.3","3":"0.10310"},{"1":"B","2":"561.0","3":"0.08752"},{"1":"B","2":"427.9","3":"0.08637"},{"1":"B","2":"571.8","3":"0.07685"},{"1":"B","2":"437.6","3":"0.08261"},{"1":"M","2":"1033.0","3":"0.11480"},{"1":"M","2":"712.8","3":"0.09056"},{"1":"B","2":"409.0","3":"0.09524"},{"1":"M","2":"1152.0","3":"0.10530"},{"1":"M","2":"656.9","3":"0.11370"},{"1":"B","2":"527.2","3":"0.08060"},{"1":"B","2":"224.5","3":"0.09752"},{"1":"B","2":"311.9","3":"0.11340"},{"1":"B","2":"221.8","3":"0.12430"},{"1":"M","2":"645.7","3":"0.10490"},{"1":"B","2":"260.9","3":"0.07721"},{"1":"M","2":"499.0","3":"0.11220"},{"1":"M","2":"668.3","3":"0.11720"},{"1":"B","2":"269.4","3":"0.10440"},{"1":"B","2":"394.1","3":"0.08139"},{"1":"B","2":"250.5","3":"0.10660"},{"1":"B","2":"502.5","3":"0.09831"},{"1":"M","2":"1130.0","3":"0.09009"},{"1":"B","2":"244.0","3":"0.09783"},{"1":"M","2":"929.4","3":"0.10710"},{"1":"M","2":"584.1","3":"0.10070"},{"1":"B","2":"470.9","3":"0.09172"},{"1":"M","2":"817.7","3":"0.09168"},{"1":"B","2":"559.2","3":"0.12910"},{"1":"M","2":"1006.0","3":"0.10650"},{"1":"M","2":"1245.0","3":"0.12860"},{"1":"B","2":"506.3","3":"0.09934"},{"1":"B","2":"401.5","3":"0.11020"},{"1":"B","2":"520.0","3":"0.10780"},{"1":"M","2":"1878.0","3":"0.10630"},{"1":"M","2":"1132.0","3":"0.12150"},{"1":"B","2":"443.3","3":"0.09723"},{"1":"M","2":"1075.0","3":"0.09874"},{"1":"M","2":"648.2","3":"0.09444"},{"1":"M","2":"1076.0","3":"0.09029"},{"1":"B","2":"466.1","3":"0.08772"},{"1":"B","2":"651.9","3":"0.11320"},{"1":"B","2":"662.7","3":"0.08974"},{"1":"M","2":"728.2","3":"0.09200"},{"1":"B","2":"551.7","3":"0.07355"},{"1":"B","2":"555.1","3":"0.10220"},{"1":"M","2":"705.6","3":"0.10390"},{"1":"M","2":"1264.0","3":"0.09078"},{"1":"B","2":"451.1","3":"0.10450"},{"1":"B","2":"294.5","3":"0.10240"},{"1":"B","2":"412.6","3":"0.08983"},{"1":"M","2":"642.5","3":"0.09752"},{"1":"M","2":"582.7","3":"0.09488"},{"1":"B","2":"143.5","3":"0.11700"},{"1":"B","2":"458.7","3":"0.08013"},{"1":"B","2":"298.3","3":"0.10050"},{"1":"B","2":"336.1","3":"0.09989"},{"1":"M","2":"530.2","3":"0.13980"},{"1":"B","2":"412.5","3":"0.11420"},{"1":"B","2":"466.7","3":"0.08477"},{"1":"M","2":"1509.0","3":"0.13260"},{"1":"B","2":"396.5","3":"0.08759"},{"1":"B","2":"290.2","3":"0.10370"},{"1":"B","2":"480.4","3":"0.09933"},{"1":"B","2":"629.9","3":"0.07837"},{"1":"B","2":"334.2","3":"0.11220"},{"1":"B","2":"230.9","3":"0.11500"},{"1":"B","2":"438.6","3":"0.09768"},{"1":"B","2":"245.2","3":"0.09462"},{"1":"M","2":"682.5","3":"0.11620"},{"1":"M","2":"782.6","3":"0.11550"},{"1":"M","2":"982.0","3":"0.08402"},{"1":"B","2":"403.3","3":"0.09373"},{"1":"M","2":"1077.0","3":"0.10540"},{"1":"M","2":"1761.0","3":"0.14470"},{"1":"B","2":"640.7","3":"0.11010"},{"1":"B","2":"553.5","3":"0.07115"},{"1":"B","2":"588.7","3":"0.08785"},{"1":"M","2":"572.6","3":"0.09258"},{"1":"M","2":"1138.0","3":"0.08217"},{"1":"B","2":"674.5","3":"0.11500"},{"1":"M","2":"1192.0","3":"0.10150"},{"1":"B","2":"455.8","3":"0.10660"},{"1":"M","2":"748.9","3":"0.10920"},{"1":"M","2":"809.8","3":"0.10080"},{"1":"B","2":"761.7","3":"0.09462"},{"1":"M","2":"1075.0","3":"0.09430"},{"1":"M","2":"506.3","3":"0.09055"},{"1":"B","2":"423.6","3":"0.10510"},{"1":"B","2":"399.8","3":"0.09639"},{"1":"M","2":"678.1","3":"0.11670"},{"1":"B","2":"384.8","3":"0.11640"},{"1":"B","2":"288.5","3":"0.09250"},{"1":"M","2":"813.0","3":"0.09721"},{"1":"B","2":"398.0","3":"0.10920"},{"1":"B","2":"512.2","3":"0.08677"},{"1":"B","2":"355.3","3":"0.07793"},{"1":"B","2":"432.8","3":"0.11520"},{"1":"M","2":"432.0","3":"0.10910"},{"1":"B","2":"689.5","3":"0.08138"},{"1":"B","2":"640.1","3":"0.09970"},{"1":"B","2":"585.0","3":"0.07944"},{"1":"B","2":"519.4","3":"0.11350"},{"1":"B","2":"203.9","3":"0.09405"},{"1":"B","2":"300.2","3":"0.10720"},{"1":"B","2":"381.9","3":"0.09754"},{"1":"B","2":"538.9","3":"0.09384"},{"1":"B","2":"460.3","3":"0.08654"},{"1":"M","2":"963.7","3":"0.11150"},{"1":"B","2":"880.2","3":"0.07445"},{"1":"B","2":"448.6","3":"0.09311"},{"1":"B","2":"366.8","3":"0.07515"},{"1":"B","2":"419.8","3":"0.10890"},{"1":"M","2":"1157.0","3":"0.08694"},{"1":"M","2":"1214.0","3":"0.11200"},{"1":"B","2":"464.5","3":"0.10120"},{"1":"M","2":"1686.0","3":"0.08439"},{"1":"B","2":"690.2","3":"0.08421"},{"1":"B","2":"357.6","3":"0.09594"},{"1":"M","2":"886.3","3":"0.08865"},{"1":"M","2":"984.6","3":"0.10490"},{"1":"B","2":"685.9","3":"0.09855"},{"1":"B","2":"464.1","3":"0.10280"},{"1":"M","2":"565.4","3":"0.09048"},{"1":"M","2":"736.9","3":"0.12570"},{"1":"B","2":"372.7","3":"0.10060"},{"1":"B","2":"349.6","3":"0.08792"},{"1":"B","2":"227.2","3":"0.09138"},{"1":"B","2":"302.4","3":"0.09699"},{"1":"M","2":"832.9","3":"0.09831"},{"1":"B","2":"526.4","3":"0.06251"},{"1":"B","2":"508.8","3":"0.08739"},{"1":"M","2":"2250.0","3":"0.10940"},{"1":"M","2":"1311.0","3":"0.11410"},{"1":"M","2":"766.6","3":"0.09597"},{"1":"B","2":"402.0","3":"0.09059"},{"1":"M","2":"710.6","3":"0.09057"},{"1":"B","2":"317.5","3":"0.09267"},{"1":"M","2":"1041.0","3":"0.08588"},{"1":"B","2":"420.3","3":"0.09774"},{"1":"B","2":"428.9","3":"0.10070"},{"1":"B","2":"463.7","3":"0.08080"},{"1":"M","2":"609.9","3":"0.10750"},{"1":"B","2":"507.4","3":"0.08749"},{"1":"B","2":"288.1","3":"0.06950"},{"1":"M","2":"477.4","3":"0.10340"},{"1":"M","2":"671.4","3":"0.10440"},{"1":"B","2":"516.4","3":"0.07941"},{"1":"M","2":"588.9","3":"0.12000"},{"1":"M","2":"1024.0","3":"0.07371"},{"1":"M","2":"1148.0","3":"0.08523"},{"1":"M","2":"642.7","3":"0.09872"},{"1":"B","2":"461.0","3":"0.09586"},{"1":"M","2":"951.6","3":"0.08968"},{"1":"M","2":"1685.0","3":"0.11410"},{"1":"M","2":"597.8","3":"0.13230"},{"1":"B","2":"481.9","3":"0.09965"},{"1":"M","2":"716.6","3":"0.08876"},{"1":"B","2":"295.4","3":"0.10890"},{"1":"M","2":"904.3","3":"0.08772"},{"1":"B","2":"529.4","3":"0.10020"},{"1":"B","2":"725.5","3":"0.08182"},{"1":"M","2":"1290.0","3":"0.09090"},{"1":"B","2":"428.0","3":"0.08871"},{"1":"M","2":"2499.0","3":"0.11420"},{"1":"M","2":"948.0","3":"0.10060"},{"1":"M","2":"610.7","3":"0.09463"},{"1":"M","2":"578.9","3":"0.10260"},{"1":"B","2":"432.2","3":"0.09363"},{"1":"B","2":"321.2","3":"0.08054"},{"1":"M","2":"1230.0","3":"0.09383"},{"1":"M","2":"1223.0","3":"0.08420"},{"1":"B","2":"568.9","3":"0.09646"},{"1":"B","2":"561.3","3":"0.10510"},{"1":"B","2":"313.1","3":"0.10610"},{"1":"M","2":"761.3","3":"0.10250"},{"1":"B","2":"546.4","3":"0.08445"},{"1":"B","2":"641.2","3":"0.09906"},{"1":"B","2":"329.6","3":"0.10530"},{"1":"B","2":"684.5","3":"0.08371"},{"1":"B","2":"496.4","3":"0.07903"},{"1":"M","2":"503.2","3":"0.10880"},{"1":"M","2":"895.0","3":"0.11410"},{"1":"B","2":"395.7","3":"0.06883"},{"1":"B","2":"386.8","3":"0.07780"},{"1":"M","2":"1319.0","3":"0.09159"},{"1":"B","2":"279.6","3":"0.08464"},{"1":"B","2":"603.4","3":"0.09070"},{"1":"M","2":"1670.0","3":"0.09509"},{"1":"M","2":"1306.0","3":"0.08355"},{"1":"B","2":"623.9","3":"0.08223"},{"1":"M","2":"920.6","3":"0.09812"},{"1":"B","2":"575.3","3":"0.09423"},{"1":"B","2":"476.5","3":"0.07926"},{"1":"B","2":"389.4","3":"0.09592"},{"1":"B","2":"590.0","3":"0.08043"},{"1":"M","2":"1155.0","3":"0.10270"},{"1":"B","2":"337.7","3":"0.10700"},{"1":"B","2":"541.6","3":"0.07215"},{"1":"B","2":"512.2","3":"0.08760"},{"1":"B","2":"347.0","3":"0.09657"},{"1":"B","2":"406.3","3":"0.10130"},{"1":"M","2":"1364.0","3":"0.10070"},{"1":"B","2":"407.4","3":"0.09345"},{"1":"M","2":"1206.0","3":"0.10620"},{"1":"M","2":"928.2","3":"0.10080"},{"1":"M","2":"1169.0","3":"0.10350"},{"1":"M","2":"602.4","3":"0.10960"},{"1":"M","2":"1207.0","3":"0.09260"},{"1":"M","2":"713.3","3":"0.13350"},{"1":"M","2":"773.5","3":"0.11090"},{"1":"M","2":"744.9","3":"0.10630"},{"1":"M","2":"1288.0","3":"0.10000"},{"1":"M","2":"933.1","3":"0.08662"},{"1":"M","2":"947.8","3":"0.08999"},{"1":"M","2":"758.6","3":"0.07840"},{"1":"M","2":"928.3","3":"0.09726"},{"1":"M","2":"1419.0","3":"0.09469"},{"1":"B","2":"346.4","3":"0.09688"},{"1":"B","2":"561.0","3":"0.07956"},{"1":"B","2":"512.2","3":"0.09425"},{"1":"B","2":"344.9","3":"0.10820"},{"1":"B","2":"632.6","3":"0.06429"},{"1":"B","2":"388.0","3":"0.09834"},{"1":"M","2":"1491.0","3":"0.09401"},{"1":"B","2":"289.9","3":"0.09037"},{"1":"M","2":"998.9","3":"0.08855"},{"1":"B","2":"435.6","3":"0.12250"},{"1":"B","2":"396.6","3":"0.09379"},{"1":"M","2":"1102.0","3":"0.08923"},{"1":"B","2":"572.3","3":"0.07948"},{"1":"B","2":"587.4","3":"0.09516"},{"1":"M","2":"1138.0","3":"0.10200"},{"1":"B","2":"427.3","3":"0.07813"},{"1":"M","2":"1145.0","3":"0.10370"},{"1":"M","2":"805.1","3":"0.10660"},{"1":"B","2":"516.6","3":"0.07818"},{"1":"B","2":"489.0","3":"0.08393"},{"1":"B","2":"441.0","3":"0.08605"},{"1":"B","2":"515.9","3":"0.06955"},{"1":"B","2":"394.1","3":"0.08020"},{"1":"B","2":"396.0","3":"0.08713"},{"1":"B","2":"651.0","3":"0.08757"},{"1":"B","2":"687.3","3":"0.08992"},{"1":"B","2":"513.7","3":"0.10050"},{"1":"B","2":"432.7","3":"0.08372"},{"1":"B","2":"492.1","3":"0.09667"},{"1":"B","2":"582.7","3":"0.09198"},{"1":"B","2":"363.7","3":"0.08518"},{"1":"M","2":"431.1","3":"0.09968"},{"1":"B","2":"633.1","3":"0.06576"},{"1":"B","2":"334.2","3":"0.10150"},{"1":"M","2":"1217.0","3":"0.11500"},{"1":"B","2":"471.3","3":"0.08451"},{"1":"M","2":"1247.0","3":"0.10800"},{"1":"B","2":"334.3","3":"0.10680"},{"1":"B","2":"403.1","3":"0.08853"},{"1":"B","2":"417.2","3":"0.07474"},{"1":"B","2":"537.3","3":"0.08511"},{"1":"B","2":"246.3","3":"0.07005"},{"1":"B","2":"566.2","3":"0.07376"},{"1":"B","2":"530.6","3":"0.08352"},{"1":"B","2":"418.7","3":"0.08814"},{"1":"B","2":"664.9","3":"0.07618"},{"1":"B","2":"504.1","3":"0.08794"},{"1":"B","2":"409.1","3":"0.08597"},{"1":"B","2":"221.2","3":"0.10740"},{"1":"B","2":"481.6","3":"0.08511"},{"1":"B","2":"461.4","3":"0.07734"},{"1":"M","2":"1027.0","3":"0.09746"},{"1":"B","2":"244.5","3":"0.09968"},{"1":"B","2":"477.3","3":"0.07557"},{"1":"B","2":"324.2","3":"0.10610"},{"1":"M","2":"1274.0","3":"0.08020"},{"1":"B","2":"504.8","3":"0.11340"},{"1":"M","2":"1264.0","3":"0.11700"},{"1":"B","2":"457.9","3":"0.08673"},{"1":"B","2":"489.9","3":"0.10280"},{"1":"B","2":"616.5","3":"0.09309"},{"1":"B","2":"446.0","3":"0.07683"},{"1":"M","2":"813.7","3":"0.11690"},{"1":"M","2":"826.8","3":"0.11650"},{"1":"M","2":"793.2","3":"0.09491"},{"1":"B","2":"514.0","3":"0.09579"},{"1":"B","2":"387.3","3":"0.10540"},{"1":"B","2":"390.0","3":"0.08306"},{"1":"B","2":"464.4","3":"0.08313"},{"1":"M","2":"918.6","3":"0.11190"},{"1":"B","2":"514.3","3":"0.09462"},{"1":"M","2":"1092.0","3":"0.09116"},{"1":"B","2":"310.8","3":"0.10070"},{"1":"M","2":"1747.0","3":"0.10690"},{"1":"B","2":"641.2","3":"0.09751"},{"1":"B","2":"280.5","3":"0.08481"},{"1":"B","2":"373.9","3":"0.10330"},{"1":"M","2":"1194.0","3":"0.09797"},{"1":"B","2":"420.3","3":"0.11500"},{"1":"B","2":"321.6","3":"0.09882"},{"1":"B","2":"445.3","3":"0.08386"},{"1":"B","2":"668.7","3":"0.08875"},{"1":"B","2":"402.7","3":"0.09076"},{"1":"B","2":"426.7","3":"0.11580"},{"1":"B","2":"421.0","3":"0.07561"},{"1":"M","2":"758.6","3":"0.12430"},{"1":"M","2":"2010.0","3":"0.11490"},{"1":"M","2":"716.6","3":"0.10240"},{"1":"B","2":"384.6","3":"0.07274"},{"1":"B","2":"485.8","3":"0.08760"},{"1":"B","2":"512.0","3":"0.10820"},{"1":"B","2":"593.7","3":"0.08743"},{"1":"B","2":"241.0","3":"0.08293"},{"1":"B","2":"278.6","3":"0.10090"},{"1":"B","2":"491.9","3":"0.07436"},{"1":"B","2":"546.1","3":"0.08582"},{"1":"B","2":"496.6","3":"0.09676"},{"1":"B","2":"838.1","3":"0.09686"},{"1":"B","2":"552.4","3":"0.07937"},{"1":"M","2":"1293.0","3":"0.09150"},{"1":"M","2":"1234.0","3":"0.09905"},{"1":"B","2":"458.4","3":"0.09231"},{"1":"M","2":"1546.0","3":"0.09384"},{"1":"M","2":"1482.0","3":"0.10630"},{"1":"M","2":"840.4","3":"0.09742"},{"1":"B","2":"711.8","3":"0.07963"},{"1":"M","2":"1386.0","3":"0.10010"},{"1":"M","2":"1335.0","3":"0.09446"},{"1":"B","2":"579.1","3":"0.08302"},{"1":"B","2":"788.5","3":"0.09880"},{"1":"B","2":"338.3","3":"0.09073"},{"1":"B","2":"562.1","3":"0.07517"},{"1":"B","2":"580.6","3":"0.08268"},{"1":"M","2":"361.6","3":"0.12160"},{"1":"B","2":"386.3","3":"0.12370"},{"1":"B","2":"372.7","3":"0.07987"},{"1":"B","2":"447.8","3":"0.06935"},{"1":"B","2":"462.9","3":"0.10420"},{"1":"B","2":"541.8","3":"0.08363"},{"1":"M","2":"664.7","3":"0.08682"},{"1":"B","2":"462.0","3":"0.08108"},{"1":"B","2":"596.6","3":"0.07026"},{"1":"B","2":"392.0","3":"0.08365"},{"1":"M","2":"1174.0","3":"0.10100"},{"1":"B","2":"321.6","3":"0.09996"},{"1":"B","2":"234.3","3":"0.10390"},{"1":"M","2":"744.7","3":"0.11600"},{"1":"M","2":"1407.0","3":"0.11670"},{"1":"B","2":"446.2","3":"0.10290"},{"1":"B","2":"609.1","3":"0.08045"},{"1":"B","2":"558.1","3":"0.10590"},{"1":"B","2":"508.3","3":"0.08044"},{"1":"B","2":"378.2","3":"0.07741"},{"1":"B","2":"431.9","3":"0.09087"},{"1":"M","2":"994.0","3":"0.12300"},{"1":"B","2":"442.7","3":"0.08872"},{"1":"B","2":"525.2","3":"0.07351"},{"1":"B","2":"507.6","3":"0.09879"},{"1":"B","2":"469.1","3":"0.08682"},{"1":"B","2":"370.0","3":"0.10040"},{"1":"B","2":"800.0","3":"0.09495"},{"1":"B","2":"514.5","3":"0.07551"},{"1":"M","2":"991.7","3":"0.10360"},{"1":"B","2":"466.1","3":"0.08685"},{"1":"B","2":"399.8","3":"0.08858"},{"1":"B","2":"373.2","3":"0.10770"},{"1":"B","2":"268.8","3":"0.07969"},{"1":"B","2":"693.7","3":"0.08515"},{"1":"M","2":"719.5","3":"0.08320"},{"1":"B","2":"433.8","3":"0.09773"},{"1":"B","2":"271.2","3":"0.10440"},{"1":"M","2":"803.1","3":"0.11200"},{"1":"B","2":"495.0","3":"0.08785"},{"1":"B","2":"380.3","3":"0.10180"},{"1":"B","2":"409.7","3":"0.08546"},{"1":"B","2":"656.1","3":"0.10310"},{"1":"B","2":"408.2","3":"0.10880"},{"1":"B","2":"575.3","3":"0.09057"},{"1":"B","2":"289.7","3":"0.10750"},{"1":"B","2":"307.3","3":"0.08117"},{"1":"B","2":"333.6","3":"0.09816"},{"1":"B","2":"359.9","3":"0.08801"},{"1":"B","2":"381.1","3":"0.08151"},{"1":"B","2":"501.3","3":"0.07896"},{"1":"M","2":"685.0","3":"0.09947"},{"1":"B","2":"467.8","3":"0.10540"},{"1":"M","2":"1250.0","3":"0.11330"},{"1":"M","2":"1110.0","3":"0.10180"},{"1":"B","2":"673.7","3":"0.08924"},{"1":"M","2":"599.5","3":"0.10600"},{"1":"B","2":"509.2","3":"0.09136"},{"1":"B","2":"611.2","3":"0.08458"},{"1":"B","2":"592.6","3":"0.08684"},{"1":"B","2":"606.5","3":"0.07966"},{"1":"B","2":"371.5","3":"0.08915"},{"1":"M","2":"928.8","3":"0.08331"},{"1":"B","2":"585.9","3":"0.08817"},{"1":"B","2":"340.9","3":"0.08142"},{"1":"M","2":"990.0","3":"0.08947"},{"1":"B","2":"441.3","3":"0.10300"},{"1":"M","2":"981.6","3":"0.09997"},{"1":"B","2":"674.8","3":"0.09179"},{"1":"B","2":"659.7","3":"0.08388"},{"1":"M","2":"1384.0","3":"0.09684"},{"1":"B","2":"432.0","3":"0.06613"},{"1":"M","2":"1191.0","3":"0.10320"},{"1":"B","2":"442.5","3":"0.08437"},{"1":"B","2":"644.2","3":"0.10990"},{"1":"B","2":"492.9","3":"0.08583"},{"1":"B","2":"557.2","3":"0.09245"},{"1":"B","2":"415.1","3":"0.09357"},{"1":"B","2":"537.9","3":"0.08791"},{"1":"B","2":"520.2","3":"0.08369"},{"1":"B","2":"290.9","3":"0.07984"},{"1":"M","2":"930.9","3":"0.09898"},{"1":"M","2":"2501.0","3":"0.10840"},{"1":"B","2":"646.1","3":"0.06995"},{"1":"B","2":"412.7","3":"0.08508"},{"1":"B","2":"537.3","3":"0.07466"},{"1":"B","2":"542.9","3":"0.08284"},{"1":"B","2":"536.9","3":"0.08675"},{"1":"B","2":"286.3","3":"0.08311"},{"1":"M","2":"980.5","3":"0.09289"},{"1":"B","2":"408.8","3":"0.11750"},{"1":"B","2":"289.1","3":"0.08946"},{"1":"B","2":"449.9","3":"0.08752"},{"1":"B","2":"686.9","3":"0.08098"},{"1":"B","2":"465.4","3":"0.07699"},{"1":"B","2":"358.9","3":"0.10070"},{"1":"B","2":"506.9","3":"0.09040"},{"1":"B","2":"618.4","3":"0.08931"},{"1":"B","2":"599.4","3":"0.06828"},{"1":"B","2":"404.9","3":"0.10460"},{"1":"M","2":"815.8","3":"0.10260"},{"1":"B","2":"455.3","3":"0.09087"},{"1":"B","2":"602.9","3":"0.07991"},{"1":"B","2":"546.3","3":"0.10710"},{"1":"B","2":"571.1","3":"0.09950"},{"1":"B","2":"747.2","3":"0.10430"},{"1":"B","2":"476.7","3":"0.09514"},{"1":"B","2":"666.0","3":"0.08641"},{"1":"M","2":"1167.0","3":"0.10890"},{"1":"B","2":"420.5","3":"0.11280"},{"1":"M","2":"857.6","3":"0.07497"},{"1":"B","2":"466.5","3":"0.08192"},{"1":"B","2":"992.1","3":"0.07838"},{"1":"M","2":"1007.0","3":"0.10010"},{"1":"B","2":"477.3","3":"0.07372"},{"1":"B","2":"538.7","3":"0.07335"},{"1":"B","2":"680.9","3":"0.09587"},{"1":"B","2":"485.6","3":"0.10760"},{"1":"B","2":"480.1","3":"0.08928"},{"1":"M","2":"1068.0","3":"0.10120"},{"1":"M","2":"1320.0","3":"0.10850"},{"1":"B","2":"689.4","3":"0.09883"},{"1":"M","2":"595.9","3":"0.11620"},{"1":"B","2":"476.3","3":"0.11580"},{"1":"M","2":"1682.0","3":"0.09342"},{"1":"B","2":"248.7","3":"0.16340"},{"1":"B","2":"272.5","3":"0.12550"},{"1":"B","2":"453.1","3":"0.10960"},{"1":"B","2":"366.5","3":"0.11940"},{"1":"B","2":"819.8","3":"0.09427"},{"1":"M","2":"731.3","3":"0.11830"},{"1":"B","2":"426.0","3":"0.08099"},{"1":"B","2":"680.7","3":"0.08472"},{"1":"M","2":"556.7","3":"0.11060"},{"1":"B","2":"658.8","3":"0.09832"},{"1":"M","2":"701.9","3":"0.09215"},{"1":"B","2":"391.2","3":"0.10490"},{"1":"M","2":"1052.0","3":"0.10680"},{"1":"M","2":"1214.0","3":"0.10370"},{"1":"B","2":"493.1","3":"0.12180"},{"1":"B","2":"493.8","3":"0.11250"},{"1":"B","2":"257.8","3":"0.13710"},{"1":"M","2":"1841.0","3":"0.10300"},{"1":"B","2":"388.1","3":"0.08511"},{"1":"B","2":"571.0","3":"0.09916"},{"1":"B","2":"293.2","3":"0.09492"},{"1":"B","2":"221.3","3":"0.10360"},{"1":"B","2":"551.1","3":"0.10750"},{"1":"B","2":"468.5","3":"0.09003"},{"1":"B","2":"594.2","3":"0.12480"},{"1":"B","2":"445.2","3":"0.11000"},{"1":"B","2":"422.9","3":"0.10730"},{"1":"B","2":"416.2","3":"0.10160"},{"1":"B","2":"575.5","3":"0.09277"},{"1":"M","2":"1299.0","3":"0.09156"},{"1":"B","2":"365.6","3":"0.09687"},{"1":"M","2":"1308.0","3":"0.10460"},{"1":"M","2":"629.8","3":"0.10380"},{"1":"B","2":"406.4","3":"0.12360"},{"1":"B","2":"178.8","3":"0.08098"},{"1":"B","2":"170.4","3":"0.08668"},{"1":"B","2":"402.9","3":"0.09984"},{"1":"B","2":"656.4","3":"0.08837"},{"1":"B","2":"668.6","3":"0.08275"},{"1":"B","2":"538.4","3":"0.08671"},{"1":"B","2":"584.8","3":"0.09578"},{"1":"B","2":"573.2","3":"0.09246"},{"1":"B","2":"324.9","3":"0.09434"},{"1":"B","2":"320.8","3":"0.08877"},{"1":"B","2":"285.7","3":"0.08491"},{"1":"B","2":"361.6","3":"0.08192"},{"1":"B","2":"360.5","3":"0.07431"},{"1":"B","2":"378.4","3":"0.09566"},{"1":"B","2":"507.9","3":"0.08276"},{"1":"B","2":"264.0","3":"0.09240"},{"1":"B","2":"514.3","3":"0.08123"},{"1":"B","2":"321.4","3":"0.09030"},{"1":"B","2":"311.7","3":"0.10030"},{"1":"B","2":"271.3","3":"0.08123"},{"1":"B","2":"657.1","3":"0.08473"},{"1":"B","2":"403.5","3":"0.09261"},{"1":"B","2":"600.4","3":"0.09929"},{"1":"B","2":"386.0","3":"0.07449"},{"1":"M","2":"716.9","3":"0.10480"},{"1":"M","2":"1347.0","3":"0.10990"},{"1":"M","2":"1479.0","3":"0.11100"},{"1":"M","2":"1261.0","3":"0.09780"},{"1":"M","2":"858.1","3":"0.08455"},{"1":"M","2":"1265.0","3":"0.11780"},{"1":"B","2":"181.0","3":"0.05263"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="callout-important">
<p>Damit Tidymodels ein Modell als Klassifikation versteht, muss die AV als <code>factor</code> definiert sein. Man sollte diese Transformation <em>au√üerhalb</em> eines Rezepts druchf√ºhren.<span class="math inline">\(\square\)</span></p>
</div>
</section><section id="rezept-definieren" class="level3" data-number="7.6.2"><h3 data-number="7.6.2" class="anchored" data-anchor-id="rezept-definieren">
<span class="header-section-number">7.6.2</span> Rezept definieren</h3>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-7_0b79f5e40f3fcf294142a2c996dc312f">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">uc_recipe</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">unscaled_cancer</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">uc_recipe</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Und jetzt die z-Transformation:</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-8_76990b63e55b98275c272b631e063c88">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">uc_recipe</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">uc_recipe</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">step_scale</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">step_center</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Die Schritte <code>prep()</code> und <code>bake()</code> sparen wir uns, da <code>fit()</code> und <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> bzw. <code>last_fit()</code> das f√ºr uns besorgen.</p>
</section><section id="modell-definieren" class="level3" data-number="7.6.3"><h3 data-number="7.6.3" class="anchored" data-anchor-id="modell-definieren">
<span class="header-section-number">7.6.3</span> Modell definieren</h3>
<p>Tidymodels greift auf den Engine (das Paket) <a href="https://www.rdocumentation.org/packages/kknn/versions/1.3.1/topics/kknn"><code>kknn</code></a> zur√ºck, das im Standard die Euklidische Distanz aus Distanzma√ü berechnet. Daher muss die Engine nicht extra spezifiziert werden.</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-9_a2401f008e0c6c7f58abadbcd262642c">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">knn_spec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">nearest_neighbor</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span>
<span><span class="va">knn_spec</span></span>
<span><span class="co">## K-Nearest Neighbor Model Specification (classification)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Computational engine: kknn</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In der Voreinstellung wird <span class="math inline">\(k=5\)</span> gew√§hlt.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="math inline">\(k\)</span> ist ein Tuningparameter
</div>
</div>
<div class="callout-body-container callout-body">
<p>Der Parameter <span class="math inline">\(k\)</span> im knn-Algorithmus wird nicht √ºber die Daten bestimmt, sondern muss durch dis Nutzi ausgew√§hlt werden. Solche Parameter nennt man <em>Tuningparameter</em> (synonym: Hyperparameter), s. <a href="080-Resampling-Tuning.html"><span>Kapitel&nbsp;8</span></a>.<span class="math inline">\(\square\)</span></p>
</div>
</div>
<p>Das Paket <code>dials</code> (Teil von Tidymodels) schl√§gt Werte f√ºr <span class="math inline">\(k\)</span> vor, das ist praktisch. Mehr dazu in <a href="080-Resampling-Tuning.html"><span>Kapitel&nbsp;8</span></a>.</p>
</section><section id="workflow-definieren-und-fitten" class="level3" data-number="7.6.4"><h3 data-number="7.6.4" class="anchored" data-anchor-id="workflow-definieren-und-fitten">
<span class="header-section-number">7.6.4</span> Workflow definieren und fitten</h3>
<p>Unser Workflow ist die ‚ÄúSumme‚Äù von Rezept und Modell:</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-10_26f8275908aac706ef8f7e6fe2aa8cfc">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">knn_wf</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">uc_recipe</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">knn_spec</span><span class="op">)</span> </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Welche Variablen waren noch mal Teil des Rezepts? Mit <code>str(uc_recipe)</code> bekommt man eine Einblick in die <code>str</code>uktur eines Objekts. Dann ziehen wir uns das Objekt, das die Infos zu den Variablen im Rezept beheimatet:</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-11_d394526f5c73ab89d28511d75c0b470a">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">uc_recipe</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="st">"var_info"</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["variable"],"name":[1],"type":["chr"],"align":["left"]},{"label":["type"],"name":[2],"type":["list"],"align":["right"]},{"label":["role"],"name":[3],"type":["chr"],"align":["left"]},{"label":["source"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"Area","2":"<chr [2]>","3":"predictor","4":"original"},{"1":"Smoothness","2":"<chr [2]>","3":"predictor","4":"original"},{"1":"Class","2":"<chr [3]>","3":"outcome","4":"original"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Nat√ºrlich kann man auch einfach seinen Code anschauen. üòÅ</p>
<p>Den Workflow fitten wir dann:</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-12_b30e81936b35057053cc2151701c4e49">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">knn_fit</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">knn_wf</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">fit</span><span class="op">(</span>data <span class="op">=</span> <span class="va">unscaled_cancer</span><span class="op">)</span></span>
<span></span>
<span><span class="va">knn_fit</span></span>
<span><span class="co">## ‚ïê‚ïê Workflow [trained] ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê</span></span>
<span><span class="co">## Preprocessor: Recipe</span></span>
<span><span class="co">## Model: nearest_neighbor()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ‚îÄ‚îÄ Preprocessor ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span></span>
<span><span class="co">## 2 Recipe Steps</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ‚Ä¢ step_scale()</span></span>
<span><span class="co">## ‚Ä¢ step_center()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ‚îÄ‚îÄ Model ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## kknn::train.kknn(formula = ..y ~ ., data = data, ks = min_rows(5,     data, 5))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Type of response variable: nominal</span></span>
<span><span class="co">## Minimal misclassification: 0.1072056</span></span>
<span><span class="co">## Best kernel: optimal</span></span>
<span><span class="co">## Best k: 5</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="vorhersagen" class="level3" data-number="7.6.5"><h3 data-number="7.6.5" class="anchored" data-anchor-id="vorhersagen">
<span class="header-section-number">7.6.5</span> Vorhersagen</h3>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-13_447e4ad424dedac4e27420173b0db206">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">new_observation</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>    Area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1500</span><span class="op">)</span>, </span>
<span>    Smoothness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.075</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">knn_fit</span>, <span class="va">new_observation</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prediction</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".pred_class"],"name":[1],"type":["fct"],"align":["left"]}],"data":[{"1":"B"},{"1":"M"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section></section><section id="krebsdiagnostik-2" class="level2" data-number="7.7"><h2 data-number="7.7" class="anchored" data-anchor-id="krebsdiagnostik-2">
<span class="header-section-number">7.7</span> Krebsdiagnostik 2</h2>
<p>Im Kapitel 5 greifen <span class="citation" data-cites="timbers_data_2022">Timbers, Campbell, und Lee (<a href="references.html#ref-timbers_data_2022" role="doc-biblioref">2022</a>)</span> die Aufteilung in Train- vs.&nbsp;Test-Sample noch nicht auf (aber in Kapitel 6).</p>
<p>Da in diesem Kurs diese Aufteilung aber schon besprochen wurde, soll dies hier auch dargestellt werden.</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-14_331951cd8fd1c51f9683c47b2138dcc2">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cancer_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">cancer</span>, strata <span class="op">=</span> <span class="va">Class</span><span class="op">)</span></span>
<span><span class="va">cancer_train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">cancer_split</span><span class="op">)</span></span>
<span><span class="va">cancer_test</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">cancer_split</span><span class="op">)</span> </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="rezept-definieren-1" class="level3" data-number="7.7.1"><h3 data-number="7.7.1" class="anchored" data-anchor-id="rezept-definieren-1">
<span class="header-section-number">7.7.1</span> Rezept definieren</h3>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-15_0f72a5f9c561f25afb91c607416a24a3">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cancer_recipe</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span></span>
<span>  <span class="va">Class</span> <span class="op">~</span> <span class="va">Smoothness</span> <span class="op">+</span> <span class="va">Concavity</span>, data <span class="op">=</span> <span class="va">cancer_train</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">step_scale</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">step_center</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="modell-definieren-1" class="level3" data-number="7.7.2"><h3 data-number="7.7.2" class="anchored" data-anchor-id="modell-definieren-1">
<span class="header-section-number">7.7.2</span> Modell definieren</h3>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-16_51b0fdd23a0ee21b457f78ea7dae71de">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">knn_spec</span> <span class="op">&lt;-</span> <span class="fu">nearest_neighbor</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co">#set_engine("kknn") |&gt;</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="workflow-definieren" class="level3" data-number="7.7.3"><h3 data-number="7.7.3" class="anchored" data-anchor-id="workflow-definieren">
<span class="header-section-number">7.7.3</span> Workflow definieren</h3>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-17_0b620583f86ccfd1735afa007e4ee164">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">knn_wf</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">cancer_recipe</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">knn_spec</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">knn_wf</span></span>
<span><span class="co">## ‚ïê‚ïê Workflow ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê</span></span>
<span><span class="co">## Preprocessor: Recipe</span></span>
<span><span class="co">## Model: nearest_neighbor()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ‚îÄ‚îÄ Preprocessor ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span></span>
<span><span class="co">## 2 Recipe Steps</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ‚Ä¢ step_scale()</span></span>
<span><span class="co">## ‚Ä¢ step_center()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ‚îÄ‚îÄ Model ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span></span>
<span><span class="co">## K-Nearest Neighbor Model Specification (classification)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Computational engine: kknn</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="vorhersagen-1" class="level3" data-number="7.7.4"><h3 data-number="7.7.4" class="anchored" data-anchor-id="vorhersagen-1">
<span class="header-section-number">7.7.4</span> Vorhersagen</h3>
<p>Im Gegensatz zu <span class="citation" data-cites="timbers_data_2022">Timbers, Campbell, und Lee (<a href="references.html#ref-timbers_data_2022" role="doc-biblioref">2022</a>)</span> verwenden wir hier <code>last_fit()</code> und <code>collect_metrics()</code>, da wir dies bereits eingef√ºhrt haben und k√ºnftig darauf aufbauen werden.</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-18_62b9131eab0399f8985c460be0d2577d">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cancer_test_fit</span> <span class="op">&lt;-</span> <span class="fu">last_fit</span><span class="op">(</span><span class="va">knn_wf</span>, <span class="va">cancer_split</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cancer_test_fit</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["splits"],"name":[1],"type":["list"],"align":["right"]},{"label":["id"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".metrics"],"name":[3],"type":["list"],"align":["right"]},{"label":[".notes"],"name":[4],"type":["list"],"align":["right"]},{"label":[".predictions"],"name":[5],"type":["list"],"align":["right"]},{"label":[".workflow"],"name":[6],"type":["list"],"align":["right"]}],"data":[{"1":"<S3: initial_split>","2":"train/test split","3":"<tibble[,4]>","4":"<tibble[,3]>","5":"<tibble[,6]>","6":"<S3: workflow>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="modellg√ºte" class="level3" data-number="7.7.5"><h3 data-number="7.7.5" class="anchored" data-anchor-id="modellg√ºte">
<span class="header-section-number">7.7.5</span> Modellg√ºte</h3>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-19_1c734d3e132b7df721fd8e2cb366a977">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cancer_test_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">collect_metrics</span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":[".config"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"accuracy","2":"binary","3":"0.8531469","4":"Preprocessor1_Model1"},{"1":"roc_auc","2":"binary","3":"0.9036688","4":"Preprocessor1_Model1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Die eigentlichen Predictions stecken in der Listenspalte <code>.predictions</code> im Fit-Objekt.</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-20_4a21227f6aad231dc00e8f65c77326e3">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cancer_test_fit</span><span class="op">)</span></span>
<span><span class="co">## [1] "splits"       "id"           ".metrics"     ".notes"       ".predictions"</span></span>
<span><span class="co">## [6] ".workflow"</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Genau genommen ist <code>.predictions</code> eine Listenspalte, in der in jeder Zeile (und damit Zelle) eine Tabelle (Tibble) steht. Wir haben nur eine Zeile und wollen das erste Element dieser Spalte herausziehen, die Vorhersagen (Wahrscheinlichkeit) f√ºr benigne Struktur (<span class="math inline">\(\hat{y}\)</span>; die Spalte hei√üt √ºbrigens <code>.pred_B</code>). Au√üerdem brauchen wir die tats√§chlichen Diagnosen, <span class="math inline">\(y\)</span>, die ‚Äúwohnen‚Äù in der Spalte mit Namen <code>Class</code>. Das Element <code>.predictions</code> ist eine Liste(nspalte), die aus Tibbles besteht. Ziehen wir uns den ersten Tibble heraus mit <code><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck()</a></code>:</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-21_5ee6a6ec1173f79ccc33dcb0d5dcae28">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cancer_test_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="st">".predictions"</span>, <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## tibble [143 √ó 6] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##  $ .pred_B    : num [1:143] 0 0.36 0 0 0.84 0 1 0.04 0.2 0 ...</span></span>
<span><span class="co">##  $ .pred_M    : num [1:143] 1 0.64 1 1 0.16 1 0 0.96 0.8 1 ...</span></span>
<span><span class="co">##  $ .row       : int [1:143] 1 5 6 9 14 18 22 27 35 36 ...</span></span>
<span><span class="co">##  $ .pred_class: Factor w/ 2 levels "B","M": 2 2 2 2 1 2 1 2 2 2 ...</span></span>
<span><span class="co">##  $ Class      : Factor w/ 2 levels "B","M": 2 2 2 2 2 2 1 2 2 2 ...</span></span>
<span><span class="co">##  $ .config    : chr [1:143] "Preprocessor1_Model1" "Preprocessor1_Model1" "Preprocessor1_Model1" "Preprocessor1_Model1" ...</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nat√ºrlich kann man auch (einfacher) <code>collect_predictions</code> verwenden anstelle von <code>pluck</code>.</p>
<p>Hat man die Vorhersagen (und die wahren Werte) zur Hand, kann man die richtigen und falschen Werte gegen√ºberstellen lassen. So eine Tabelle nennt man auch eine <em>Konfusionsmatrix</em><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>:</p>
<div class="cell" data-hash="070-knn_cache/html/comp-conf_7bf2401cfb00dbdd70f20a003586eeb5">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cancer_test_predictions</span> <span class="op">&lt;-</span> </span>
<span><span class="va">cancer_test_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">collect_predictions</span><span class="op">(</span><span class="op">)</span>  <span class="co"># alternativ: pluck(".predictions", 1)</span></span>
<span></span>
<span><span class="va">confusion</span> <span class="op">&lt;-</span> <span class="va">cancer_test_predictions</span> <span class="op">|&gt;</span></span>
<span>             <span class="fu">conf_mat</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">Class</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span></span>
<span></span>
<span><span class="va">confusion</span></span>
<span><span class="co">##           Truth</span></span>
<span><span class="co">## Prediction  B  M</span></span>
<span><span class="co">##          B 75  6</span></span>
<span><span class="co">##          M 15 47</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="schwellenwerte" class="level3" data-number="7.7.6"><h3 data-number="7.7.6" class="anchored" data-anchor-id="schwellenwerte">
<span class="header-section-number">7.7.6</span> Schwellenwerte</h3>
<p>Im Standard wird eine Beobachtung der Klasse mit der h√∂chsten Wahrscheinlichkeit zugeordnet. M√∂chte man das √§ndern, hilft das <a href="https://probably.tidymodels.org/articles/where-to-use.html">R-Paket <code>probably</code></a>.</p>
</section><section id="visualisierung" class="level3" data-number="7.7.7"><h3 data-number="7.7.7" class="anchored" data-anchor-id="visualisierung">
<span class="header-section-number">7.7.7</span> Visualisierung</h3>
<p>Verbildlichen wir die Konfusionsmatrix, so dass wir sehen welche <code>B</code> als <code>B</code> klassifiziert wurden und welche <code>M</code> als <code>M</code> klassifiziert wurden (bzw. welche nicht), s. <span class="quarto-unresolved-ref">?fig-conf-bm</span>.</p>
<div class="cell" data-hash="070-knn_cache/html/fig-conf-bm_73decb942eb23fe93692cfaa49387c75">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># autoplot(confusion, type = "mosaic")</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="klassifikationsg√ºte" class="level2" data-number="7.8"><h2 data-number="7.8" class="anchored" data-anchor-id="klassifikationsg√ºte">
<span class="header-section-number">7.8</span> Klassifikationsg√ºte</h2>
<section id="die-vier-m√∂glichen-ergebnisse-eines-tests" class="level3" data-number="7.8.1"><h3 data-number="7.8.1" class="anchored" data-anchor-id="die-vier-m√∂glichen-ergebnisse-eines-tests">
<span class="header-section-number">7.8.1</span> Die vier m√∂glichen Ergebnisse eines Tests</h3>
<p>Ein Test kann vier verschiedenen Ergebnisse haben:</p>
<div class="cell" data-hash="070-knn_cache/html/class-stats_481fff3aa3a3dace079614e9d54a8e97">
<div class="cell-output-display">

<div id="jbntqnlumf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#jbntqnlumf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#jbntqnlumf thead, #jbntqnlumf tbody, #jbntqnlumf tfoot, #jbntqnlumf tr, #jbntqnlumf td, #jbntqnlumf th {
  border-style: none;
}

#jbntqnlumf p {
  margin: 0;
  padding: 0;
}

#jbntqnlumf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jbntqnlumf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#jbntqnlumf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jbntqnlumf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jbntqnlumf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jbntqnlumf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jbntqnlumf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jbntqnlumf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jbntqnlumf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jbntqnlumf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jbntqnlumf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jbntqnlumf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jbntqnlumf .gt_spanner_row {
  border-bottom-style: hidden;
}

#jbntqnlumf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#jbntqnlumf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jbntqnlumf .gt_from_md > :first-child {
  margin-top: 0;
}

#jbntqnlumf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jbntqnlumf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jbntqnlumf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#jbntqnlumf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#jbntqnlumf .gt_row_group_first td {
  border-top-width: 2px;
}

#jbntqnlumf .gt_row_group_first th {
  border-top-width: 2px;
}

#jbntqnlumf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jbntqnlumf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#jbntqnlumf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#jbntqnlumf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jbntqnlumf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jbntqnlumf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jbntqnlumf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#jbntqnlumf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jbntqnlumf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jbntqnlumf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jbntqnlumf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jbntqnlumf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jbntqnlumf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jbntqnlumf .gt_left {
  text-align: left;
}

#jbntqnlumf .gt_center {
  text-align: center;
}

#jbntqnlumf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jbntqnlumf .gt_font_normal {
  font-weight: normal;
}

#jbntqnlumf .gt_font_bold {
  font-weight: bold;
}

#jbntqnlumf .gt_font_italic {
  font-style: italic;
}

#jbntqnlumf .gt_super {
  font-size: 65%;
}

#jbntqnlumf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#jbntqnlumf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#jbntqnlumf .gt_indent_1 {
  text-indent: 5px;
}

#jbntqnlumf .gt_indent_2 {
  text-indent: 10px;
}

#jbntqnlumf .gt_indent_3 {
  text-indent: 15px;
}

#jbntqnlumf .gt_indent_4 {
  text-indent: 20px;
}

#jbntqnlumf .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<caption>Vier Arten von Ergebnissen von Klassifikationen</caption>
  <thead><tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Wahrheit">Wahrheit</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Als negativ (-) vorhergesagt">Als negativ (-) vorhergesagt</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Als positiv (+) vorhergesagt">Als positiv (+) vorhergesagt</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Summe">Summe</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td headers="Wahrheit" class="gt_row gt_left">In Wahrheit negativ (-)</td>
<td headers="Als negativ (-) vorhergesagt" class="gt_row gt_left">Richtig negativ (RN)</td>
<td headers="Als positiv (+) vorhergesagt" class="gt_row gt_left">Falsch positiv (FP)</td>
<td headers="Summe" class="gt_row gt_left">N</td>
</tr>
<tr>
<td headers="Wahrheit" class="gt_row gt_left">In Wahrheit positiv (+)</td>
<td headers="Als negativ (-) vorhergesagt" class="gt_row gt_left">Falsch negativ (FN)</td>
<td headers="Als positiv (+) vorhergesagt" class="gt_row gt_left">Richtig positiv (RN)</td>
<td headers="Summe" class="gt_row gt_left">P</td>
</tr>
<tr>
<td headers="Wahrheit" class="gt_row gt_left">Summe</td>
<td headers="Als negativ (-) vorhergesagt" class="gt_row gt_left">N*</td>
<td headers="Als positiv (+) vorhergesagt" class="gt_row gt_left">P*</td>
<td headers="Summe" class="gt_row gt_left">N+P</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Von den vier m√∂glichen Ergebnissen sind zwei falsch (und zwei richtig). Ein Test kann also zwei Arten von Fehlern machen, s. <a href="#fig-4arten">Abbildung&nbsp;<span>7.9</span></a>. Dort kann man die Punkte im roten Hintergrund als <em>kranke</em> Menschen verstehen (links des schr√§gen Strichs); auf der anderen Seite sind man gesunde Menschen (gr√ºner Hintergrund). Die Punkte in der Ellipse zeigen die Klassifikationsergebnisse bzw. -fehler.</p>
<ol type="1">
<li>Fehler erster Art: Gesunde als krank klassifizieren (‚ÄúFehlalarm‚Äù)</li>
<li>Fehler zweiter Art: Kranke als gesund klassifizieren (‚Äú√úbersehfehler‚Äù)</li>
</ol>
<div id="fig-4arten" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="img/Binary-classification-measures.svg (2).png" class="img-fluid figure-img" style="width:50.0%"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;7.9: Zwei Fehlerarten einer Klassifikation</figcaption><p></p>
</figure>
</div>
<p><a href="https://commons.wikimedia.org/w/index.php?curid=3494986">Quelle: Von Nichtich - Eigenes Werk, Gemeinfrei</a></p>
<p>Bei <a href="https://de.wikipedia.org/wiki/Beurteilung_eines_bin%C3%A4ren_Klassifikators">Wikipedia</a> findet sich eine n√ºtzliche Erl√§uterung der Kennzahlen der Klassifikationsg√ºte, vgl. <a href="#fig-sens-fn">Abbildung&nbsp;<span>7.10</span></a> und <a href="#fig-spec-fp">Abbildung&nbsp;<span>7.11</span></a>.</p>
<div id="fig-sens-fn" class="quarto-layout-panel">
<figure class="figure"><div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-sens" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="img/sens-440px-Binary-classification-file_sensitivity.svg.png" class="img-fluid figure-img" data-ref-parent="fig-sens-fn"></p>
<p></p><figcaption class="figure-caption">(a) Sensitivit√§t</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fn-rante" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="img/fn-rate-Binary-classification-file_false_negative_rate.svg.png" class="img-fluid figure-img" data-ref-parent="fig-sens-fn"></p>
<p></p><figcaption class="figure-caption">(b) FN-Rate</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;7.10: Sensitivit√§t und Falsch-Negativrate addieren sich zu 1.</figcaption><p></p>
</figure>
</div>
<div id="fig-spec-fp" class="quarto-layout-panel">
<figure class="figure"><div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-spec" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="img/spec-Binary-classification-file_specifity.svg.png" class="img-fluid figure-img" data-ref-parent="fig-spec-fp"></p>
<p></p><figcaption class="figure-caption">(a) Spezifit√§t</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fp-rate" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="img/fp-rate-Binary-classification-file_fallout.svg.png" class="img-fluid figure-img" data-ref-parent="fig-spec-fp"></p>
<p></p><figcaption class="figure-caption">(b) FP-Rate</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;7.11: Spezifit√§t und FP-Rate addieren sich zu 1.</figcaption><p></p>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hinweis
</div>
</div>
<div class="callout-body-container callout-body">
<p>Es ist einfach, in nur einem der beiden Fehlerarten gut abzuschneiden. So k√∂nnte ein Test alle Personen als <em>krank</em> klassifizieren. Damit h√§tte er auomatisch keine √úbersehfehler. Leider w√§ren aber potenziell viele Fehlalarme dabei. Die H√∂he des √úbersehfehler und die H√∂he der Fehlalarme m√ºssen daher nicht gleich sein. Man muss daher beide Fehlerarten ber√ºcksichtigen, um die G√ºte eines Tests einzusch√§tzen. Welcher Fehler schwerer wiegt, der Fehlalarm oder der √úbersehfehler, h√§ngt vom Sachgegenstand ab und ist keine Frage der Statistik.<span class="math inline">\(\square\)</span></p>
</div>
</div>
</section><section id="kennzahlen-der-klassfikation" class="level3" data-number="7.8.2"><h3 data-number="7.8.2" class="anchored" data-anchor-id="kennzahlen-der-klassfikation">
<span class="header-section-number">7.8.2</span> Kennzahlen der Klassfikation</h3>
<p>Es gibt eine (verwirrende) Vielfalt von Kennzahlen, um die G√ºte einer Klassifikation einzusch√§tzen. In <a href="#tbl-diag-stats">Tabelle&nbsp;<span>7.1</span></a> sind einige davon aufgef√ºhrt.</p>
<div class="cell" data-hash="070-knn_cache/html/tbl-diag-stats_1634b605727fe7281b0d74d2a9f87db5">
<div class="cell-output-display">
<div id="tbl-diag-stats" class="anchored">
<table class="table table-sm table-striped">
<caption>Tabelle&nbsp;7.1: Gel√§ufige Kennwerte der Klassifikation. F: Falsch. R: Richtig. P: Positiv. N: Negativ</caption>
<colgroup>
<col style="width: 22%">
<col style="width: 20%">
<col style="width: 57%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Definition</th>
<th style="text-align: left;">Synonyme</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">FP-Rate</td>
<td style="text-align: left;">FP/N</td>
<td style="text-align: left;">Alphafehler, Typ-1-Fehler, 1-Spezifit√§t, Fehlalarm</td>
</tr>
<tr class="even">
<td style="text-align: left;">RP-Rate</td>
<td style="text-align: left;">RP/N</td>
<td style="text-align: left;">Power, Sensitivit√§t, 1-Betafehler, Recall</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FN-Rate</td>
<td style="text-align: left;">FN/N</td>
<td style="text-align: left;">Fehlender Alarm, Befafehler</td>
</tr>
<tr class="even">
<td style="text-align: left;">RN-Rate</td>
<td style="text-align: left;">RN/N</td>
<td style="text-align: left;">Spezifit√§t, 1-Alphafehler</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pos. Vorhersagewert</td>
<td style="text-align: left;">RP/P*</td>
<td style="text-align: left;">Pr√§zision, Relevanz</td>
</tr>
<tr class="even">
<td style="text-align: left;">Neg. Vorhersagewert</td>
<td style="text-align: left;">RN/N*</td>
<td style="text-align: left;">Segreganz</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Richtigkeit</td>
<td style="text-align: left;">(RP+RN)/(N+P)</td>
<td style="text-align: left;">Korrektklassifikationsrate, Gesamtgenauigkeit</td>
</tr>
<tr class="even">
<td style="text-align: left;">Youden-Index</td>
<td style="text-align: left;">RN-Rate+RP-Rate-1</td>
<td style="text-align: left;">Durchschnitt von Sensitivit√§t und Spezifit√§t</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>In <span class="citation" data-cites="modar">Sauer (<a href="references.html#ref-modar" role="doc-biblioref">2019</a>)</span>, Kap. 19.6, findet sich einige Erkl√§rung zu Kennzahlen der Klassifikationsg√ºte.</p>
<p>Auf der <a href="https://yardstick.tidymodels.org/reference/index.html">Seite des R-Pakets <code>yardstick</code></a> finden Sie eine √úbersicht an unterst√ºtzter Kennzahlen.</p>
</section><section id="schwellenwerte-der-klassifiktion" class="level3" data-number="7.8.3"><h3 data-number="7.8.3" class="anchored" data-anchor-id="schwellenwerte-der-klassifiktion">
<span class="header-section-number">7.8.3</span> Schwellenwerte der Klassifiktion</h3>
<p>Im Standard wird ein Fall der Klasse zugeordnet, die die h√∂chste Wahrscheinlichkeit hat. Mit dem R-Paket <a href="https://probably.tidymodels.org/articles/where-to-use.html"><code>probably</code></a> kann man (als Teil eines Post-Processing des Modellierens) diese Schwellenwerte<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> √§ndern.</p>
<div id="exm-thresholds" class="theorem example">
<p><span class="theorem-title"><strong>Beispiel 7.1 </strong></span>Da eine √Ñrztin auf keinen Fall einen Krebsfall √ºbersehen m√∂chte - da Sie den √úbersehfehler als deutlich schlimmer einsch√§tzt als den Fehlalarm - setzt sie die Schwelle f√ºr die Klasse ‚ÄúGesund‚Äù auf 95%.<span class="math inline">\(\square\)</span></p>
</div>
</section><section id="roc-kurve" class="level3" data-number="7.8.4"><h3 data-number="7.8.4" class="anchored" data-anchor-id="roc-kurve">
<span class="header-section-number">7.8.4</span> ROC-Kurve</h3>
<p>Eine ROC-Kurve<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> ist ein Graph, der die Modellg√ºte eines Klassfikationsmodells <em>zu allen Schwellenwerten</em> aufzeigt. Eine ROC-Kurve ist eine n√ºtzliche und gebr√§uchliche Methode zur Bestimmung der insgesamten Klassifikationsg√ºte eines Modells.</p>
<p>Die Kurve hat zwei Parameter:</p>
<ul>
<li>TP-Rate (Y-Achse)</li>
<li>FP-Rate (X-Achse)</li>
</ul>
<p>Praktisch w√ºrde man f√ºr die vorhergesagten Wahrscheinlichkeiten eines Klassifikationsmodells viele Schwellenwerte anlegen, z.B. von 0%, 1%, ‚Ä¶, 100%. F√ºr jeden Schwellenwert berechnet man die vorhergesagte Klasse. In <code>tidymodels</code> besorgt <a href="https://yardstick.tidymodels.org/reference/roc_curve.html"><code>roc_curve</code></a> diesen Job:</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-23_4a8cd65f48e1b160beace890cda022e2">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cancer_roc</span> <span class="op">&lt;-</span> </span>
<span><span class="va">cancer_test_predictions</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">roc_curve</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">Class</span>, <span class="va">.pred_B</span><span class="op">)</span></span>
<span><span class="va">cancer_roc</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".threshold"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["specificity"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sensitivity"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"-Inf","2":"0.0000000","3":"1.0000000"},{"1":"0.00","2":"0.0000000","3":"1.0000000"},{"1":"0.04","2":"0.6415094","3":"0.9000000"},{"1":"0.12","2":"0.6981132","3":"0.8888889"},{"1":"0.16","2":"0.7169811","3":"0.8888889"},{"1":"0.20","2":"0.7358491","3":"0.8888889"},{"1":"0.32","2":"0.8113208","3":"0.8777778"},{"1":"0.36","2":"0.8301887","3":"0.8666667"},{"1":"0.40","2":"0.8490566","3":"0.8555556"},{"1":"0.48","2":"0.8490566","3":"0.8444444"},{"1":"0.48","2":"0.8867925","3":"0.8444444"},{"1":"0.60","2":"0.8867925","3":"0.8333333"},{"1":"0.64","2":"0.8867925","3":"0.8222222"},{"1":"0.68","2":"0.9056604","3":"0.8222222"},{"1":"0.72","2":"0.9056604","3":"0.8000000"},{"1":"0.76","2":"0.9433962","3":"0.7777778"},{"1":"0.80","2":"0.9433962","3":"0.7555556"},{"1":"0.84","2":"0.9433962","3":"0.7222222"},{"1":"0.88","2":"0.9811321","3":"0.7111111"},{"1":"0.96","2":"0.9811321","3":"0.7000000"},{"1":"1.00","2":"0.9811321","3":"0.6888889"},{"1":"Inf","2":"1.0000000","3":"0.0000000"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Mit <code>autoplot</code> kann man dann die ROC-Kurve zeichnen, s. <a href="#fig-roc1">Abbildung&nbsp;<span>7.12</span></a>.</p>
<div class="cell" data-hash="070-knn_cache/html/fig-roc1_544322a7fab955a57e569c969052296a">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cancer_test_predictions</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">roc_curve</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">Class</span>, <span class="va">.pred_B</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-roc1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="070-knn_files/figure-html/fig-roc1-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;7.12: ROC-Kurve f√ºr das Fallbeispiel der Krebsdiagnostik</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Die <em>Fl√§che unter der Kurve</em> (area under curve, AUC), bezogen auf die ROC-Kurve, ist ein Ma√ü f√ºr die G√ºte der Klassifikation. <a href="#fig-example-rocs">Abbildung&nbsp;<span>7.13</span></a> aus <span class="citation" data-cites="modar">Sauer (<a href="references.html#ref-modar" role="doc-biblioref">2019</a>)</span> stellt drei Beispiele von Klassifikationsg√ºten dar: sehr gute (A), gute (B) und schlechte (C). Ein hohe Klassifikationsg√ºte zeigt sich daran, dass eine hohe Richtig-Positiv-Rate mit einer geringen Fehlalarmquote einhergeht: Wir finden alle Kranken, aber nur die Kranken. Die ROC-Kurve ‚Äúh√§ngt oben links an der Decke‚Äù; der AUC-Wert geht gegen 1. Ein schlechter Klassifikator trifft so gut wie ein M√ºnzwurf: Ist das Ereignis selten, hat er eine hohe Falsch-Positiv-Rate und eine geringe Falsch-Negativ-Rate. Ist das Ereignis hingegen h√§ufig, liegen die Fehlerh√∂hen genau umgekehrt: Eine hohe Richtig-Positiv-Rate geht dann mit einer hohen Falsch-Positiv-Rate einher.</p>
<div class="cell" data-fig.asp="0.3" data-hash="070-knn_cache/html/fig-example-rocs_d88f9b073c4f0d45dcd99627cce6565a">
<div class="cell-output-display">
<div id="fig-example-rocs" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="070-knn_files/figure-html/fig-example-rocs-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;7.13: Beispiel f√ºr eine sehr gute (A), gute (B) und schlechte (C) Klassifikation</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section><section id="krebstest-beispiel" class="level3" data-number="7.8.5"><h3 data-number="7.8.5" class="anchored" data-anchor-id="krebstest-beispiel">
<span class="header-section-number">7.8.5</span> Krebstest-Beispiel</h3>
<p>Betrachten wir <a href="https://raw.githubusercontent.com/sebastiansauer/datascience1/main/data/Krebstest.csv">diese Daten</a> eines fiktiven Krebstest, aber mit realistischen Werte, s. <a href="#fig-krebstest">Abbildung&nbsp;<span>7.14</span></a>.</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-25_ef871e20925ef06ceae03bbb8d9cf2e3">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">krebstest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/krebstest.csv"</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="070-knn_cache/html/fig-krebstest_ba790c2d4d8db3d80bad97831decfb43">
<pre><code>## # A tibble: 1 √ó 7
##   format width height colorspace matte filesize density
##   &lt;chr&gt;  &lt;int&gt;  &lt;int&gt; &lt;chr&gt;      &lt;lgl&gt;    &lt;int&gt; &lt;chr&gt;  
## 1 PNG      500    429 sRGB       TRUE     40643 72x72</code></pre>
<div class="cell-output-display">
<div id="fig-krebstest" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="070-knn_files/figure-html/fig-krebstest-1.png" class="img-fluid figure-img" width="250"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;7.14: Kennwerte zu tats√§chlichem und laut Test Krebs-Status</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Wie gut ist dieser Test? Berechnen wir einige Kennzahlen.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p>Da die Funktionen zur Klassifikation stets einen Faktor wollen, wandeln wir die relevanten Spalten zuerst in einen Faktor um (aktuell sind es numerische Spalten).</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-28_3f0a2328c3fad9bc2de9410f8688240d">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">krebstest</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">krebstest</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Krebs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Krebs</span><span class="op">)</span>,</span>
<span>         Test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Test</span><span class="op">)</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Die Konfusionsmatrix ist in <a href="#fig-krebs-cm">Abbildung&nbsp;<span>7.15</span></a> gezeigt.</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-29_5550f945fdae0ef00d9a9ca96241e3b2">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cm_krebs</span> <span class="op">&lt;-</span> <span class="fu">conf_mat</span><span class="op">(</span><span class="va">krebstest</span>, truth <span class="op">=</span> <span class="va">Krebs</span>, estimate <span class="op">=</span> <span class="va">Test</span><span class="op">)</span></span>
<span><span class="va">cm_krebs</span></span>
<span><span class="co">##           Truth</span></span>
<span><span class="co">## Prediction  0  1</span></span>
<span><span class="co">##          0 84  2</span></span>
<span><span class="co">##          1 11  3</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="070-knn_cache/html/fig-krebs-cm_7f8637542b4804a323d33d169630488d">
<div class="cell-output-display">
<div id="fig-krebs-cm" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="070-knn_files/figure-html/fig-krebs-cm-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;7.15: Konfusionsmatrix f√ºr das Krebs-Beispiel</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Gesamtgenauigkeit:</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-31_eaedf0fa86319f1071eb0eb365f23ce3">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">accuracy</span><span class="op">(</span><span class="va">krebstest</span>, truth <span class="op">=</span> <span class="va">Krebs</span>, estimate <span class="op">=</span> <span class="va">Test</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"accuracy","2":"binary","3":"0.87"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Wichtig
</div>
</div>
<div class="callout-body-container callout-body">
<p>Die Kennzahl der Gesamtgenauigkeit z√§hlt nur den Anteil richtiger Klassifikation. Sind z.B. 95% der Menschen gesund, und wir klassifizieren alle Menschen als gesund, erreichen wir auf einfachem Weg eine Gesamtgenauigkeit von 95%. Trotz dieses scheinbar hohen Werts haben wir alle kranken Menschen fehlklassifiziert. In dem Fall, wie die Klassen (krank vs.&nbsp;gesund) ungleich gro√ü sind, sinkt die N√ºtzlichkeit dieser Kennzahl. Aber sie kann als Referenzwert herhalten, an dem sich andere Modelle messen lassen m√ºssen. N√ºtzliche Alternativen sind dann z.B. Cohens Kappa oder ROC-AUC. Oder man schaut sich mehrere Kennwerte an, was meist der richtige Weg ist. <span class="math inline">\(\square\)</span></p>
</div>
</div>
<p>Sensitivit√§t:</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-32_36127cd1f0f2096d47abf7414200957d">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">sens</span><span class="op">(</span><span class="va">krebstest</span>, truth <span class="op">=</span> <span class="va">Krebs</span>, estimate <span class="op">=</span> <span class="va">Test</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"sens","2":"binary","3":"0.8842105"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Spezifit√§t:</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-33_f71a454832a126d1f0dcc2c936b5430e">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">yardstick</span><span class="fu">::</span><span class="fu"><a href="https://yardstick.tidymodels.org/reference/spec.html">spec</a></span><span class="op">(</span><span class="va">krebstest</span>, truth <span class="op">=</span> <span class="va">Krebs</span>, estimate <span class="op">=</span> <span class="va">Test</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"spec","2":"binary","3":"0.6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><a href="https://de.wikipedia.org/wiki/Cohens_Kappa">Cohens Kappa</a>:</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-34_63e82aa7c2827b4fecfb22968c452f4b">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">yardstick</span><span class="fu">::</span><span class="fu"><a href="https://yardstick.tidymodels.org/reference/kap.html">kap</a></span><span class="op">(</span><span class="va">krebstest</span>, truth <span class="op">=</span> <span class="va">Krebs</span>, estimate <span class="op">=</span> <span class="va">Test</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"kap","2":"binary","3":"0.2613636"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Ein Wert von 0 zeigt eine Klassifikation an, die von einer Zufallzuordnung nicht zu unterscheiden ist. Ein Wert von 1 zeigt eine perfekte Klassifikation an. Damit ist Kappa eine Kennzahl der Gesamtgenauigkeit einer Klassifikation, die das Problem ungleicher Klassengr√∂√üen, worunter die Kennzahl Gesamtgenauigkeit leider, umgeht.</p>
<p>Positiver Vorhersagewert:</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-35_f3a68fc419a6a4a8db4f8c6756b212d9">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ppv</span><span class="op">(</span><span class="va">krebstest</span>, truth <span class="op">=</span> <span class="va">Krebs</span>, estimate <span class="op">=</span> <span class="va">Test</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"ppv","2":"binary","3":"0.9767442"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Negativer Vorhersagewert:</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-36_96675c6b6687490d9c8e14f8ec149383">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">npv</span><span class="op">(</span><span class="va">krebstest</span>, truth <span class="op">=</span> <span class="va">Krebs</span>, estimate <span class="op">=</span> <span class="va">Test</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"npv","2":"binary","3":"0.2142857"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>W√§hrend Sensitivit√§t und Spezitivit√§t sehr hoch sind, ist die der negative Vorhersagewert sehr gering:</p>
<p>Wenn man einen positiven Test erh√§lt, ist die Wahrscheinlichkeit, in Wahrheit krank zu sein gering, zum Gl√ºck!</p>
<p>Mit <code>metrics</code> kann man sich eine Auswahl von Metriken (der Modellg√ºte) anzeigen lassen:</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-37_aa8ae1493c528a83308612f0992be0d1">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">metrics</span><span class="op">(</span><span class="va">krebstest</span>, truth <span class="op">=</span> <span class="va">Krebs</span>, estimate <span class="op">=</span> <span class="va">Test</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"accuracy","2":"binary","3":"0.8700000"},{"1":"kap","2":"binary","3":"0.2613636"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Man kann sich auch eine ‚Äúeigene‚Äù Funktion <code>metrics</code> erstellen, bzw. <code>metrics</code> √§ndern:</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-38_ca6feca109c1f803f948b594b794aa98">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">my_metrics</span> <span class="op">&lt;-</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">accuracy</span>, <span class="va">ppv</span>, <span class="va">sensitivity</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Diese Funktion ruft man dann genauso auf wie <code>metrics</code>:</p>
<div class="cell" data-hash="070-knn_cache/html/unnamed-chunk-39_d63d6fecb11ed6a4e4bdf2ffce046a0f">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">my_metrics</span><span class="op">(</span><span class="va">krebstest</span>, truth <span class="op">=</span> <span class="va">Krebs</span>, estimate <span class="op">=</span> <span class="va">Test</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"accuracy","2":"binary","3":"0.8700000"},{"1":"ppv","2":"binary","3":"0.9767442"},{"1":"sensitivity","2":"binary","3":"0.8842105"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section></section><section id="knn-als-regression" class="level2" data-number="7.9"><h2 data-number="7.9" class="anchored" data-anchor-id="knn-als-regression">
<span class="header-section-number">7.9</span> kNN als Regression</h2>
<p>Der kNN-Algorithmus kann nicht nur zur Klassifikation, sondern auch zur Regression (numerische Vorhersage) verwendet werden.</p>
<p>Die Vorhersage ist dann nicht der <em>Modus</em> der Nachbarn, sondern der <em>Mittelwert</em> der Nachbarn.</p>
</section><section id="aufgaben" class="level2" data-number="7.10"><h2 data-number="7.10" class="anchored" data-anchor-id="aufgaben">
<span class="header-section-number">7.10</span> Aufgaben</h2>
<ul>
<li>Arbeiten Sie sich so gut als m√∂glich durch <a href="https://github.com/sebastiansauer/covid-icu">diese Analyse zum Verlauf von Covid-F√§llen</a>
</li>
<li><a href="https://onezero.blog/modelling-binary-logistic-regression-using-tidymodels-library-in-r-part-1/">Fallstudie zur Modellierung einer logististischen Regression mit tidymodels</a></li>
<li><a href="https://juliasilge.com/blog/multinomial-volcano-eruptions/">Fallstudie zu Vulkanausbr√ºchen</a></li>
<li><a href="https://juliasilge.com/blog/himalayan-climbing/">Fallstudie Himalaya</a></li>
<li>
<a href="https://www.kirenz.com/post/2021-02-17-r-classification-tidymodels/">Fallstudie Immobilienpreise von Jan Kirzenz</a>; diese Fallstudie beinhaltet mehrere Lernalgorithmen, die Sie vielleicht noch nicht kennen.</li>
</ul>
<p>Falls Sie in einer Fallstudie auf Inhalte treffen, die Sie noch nicht kennen: Im Zweifel einfach ignorieren.</p>
</section><section id="fazit" class="level2" data-number="7.11"><h2 data-number="7.11" class="anchored" data-anchor-id="fazit">
<span class="header-section-number">7.11</span> Fazit</h2>
<p><em>Keep kalm and proceed</em> üòé</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-rhys" class="csl-entry" role="listitem">
Rhys, Hefin. 2020. <em>Machine Learning with R, the tidyverse, and mlr</em>. Shelter Island, <span>NY</span>: Manning publications.
</div>
<div id="ref-modar" class="csl-entry" role="listitem">
Sauer, Sebastian. 2019. <em>Moderne Datenanalyse mit R: Daten einlesen, aufbereiten, visualisieren und modellieren</em>. 1. Auflage 2019. <span>FOM</span>-Edition. Wiesbaden: Springer. <a href="https://www.springer.com/de/book/9783658215866">https://www.springer.com/de/book/9783658215866</a>.
</div>
<div id="ref-timbers_data_2022" class="csl-entry" role="listitem">
Timbers, Tiffany-Anne, Trevor Campbell, und Melissa Lee. 2022. <em>Data science: an introduction</em>. First edition. Statistics. Boca Raton: <span>CRC</span> Press.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>seltener ‚ÄúWahrheitsmatrix‚Äù<a href="#fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn2"><p>engl. thresholds, cutoffs<a href="#fnref2" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn3"><p>Receiver Operating Characteristic Curve<a href="#fnref3" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn4"><p>aus dem Paket <a href="https://github.com/tidymodels/yardstick">yardstick</a>, das Teil von Tidymodels ist. <a href="https://yardstick.tidymodels.org/">Hier</a> ist die Hilfeseite zum Paket.<a href="#fnref4" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./060-tidymodels.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">tidymodels</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./080-Resampling-Tuning.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Resampling und Tuning</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>